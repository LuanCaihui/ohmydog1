<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å®¡æ ¸å‘˜åå° - Oh my dogï¼</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #3d8b7e;
            --secondary-color: #5ba898;
            --accent-color: #7bc5b7;
            --background-color: #edf6f5;
            --card-background: #ffffff;
            --border-color: #d4ede9;
            --text-primary: #2a4f49;
            --text-secondary: #3e6b61;
            --blue-accent: #6fa5c3;
            --blue-light: #a8c8da;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('/petblog/images/auditor.png') no-repeat center center fixed;
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            z-index: -1;
            pointer-events: none;
        }
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--blue-accent) 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(74, 155, 142, 0.2);
        }
        .nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 60px;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-decoration: none;
            letter-spacing: 1px;
        }
        .nav-links {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            border-radius: 20px;
            padding: 8px 16px;
            transition: background 0.2s, color 0.2s;
            white-space: nowrap;
        }
        .nav-links a:hover, .nav-links a.active {
            background: rgba(255,255,255,0.12);
            color: #fff;
        }
        .nav-dropdown {
            position: relative;
            display: inline-block;
        }
        .nav-dropdown-btn {
            cursor: pointer;
        }
        .nav-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border-radius: 8px;
            z-index: 1000;
            margin-top: 5px;
            overflow: hidden;
        }
        .nav-dropdown-content a {
            color: var(--text-primary);
            padding: 12px 20px;
            display: block;
            margin: 0;
            border-radius: 0;
            transition: background 0.2s;
        }
        .nav-dropdown-content a:hover {
            background: var(--background-color);
            color: var(--primary-color);
        }
        .nav-dropdown:hover .nav-dropdown-content {
            display: block;
        }
        .hero-banner {
            width: 100%;
            height: 220px;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }
        .hero-image {
            width: 100%;
            height: 100%;
            position: relative;
        }
        .hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top;
            transform: scale(1.1);
        }
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg,rgba(74,155,142,0.3) 0%,rgba(107,183,168,0.25) 50%,rgba(133,193,184,0.2) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hero-text {
            text-align: center;
            color: white;
            z-index: 2;
            animation: heroFadeIn 1.5s ease-out;
        }
        .hero-title {
            font-size: 2.5rem;
            font-weight: 900;
            margin: 0 0 10px 0;
            letter-spacing: 2px;
            color: #ffffff;
        }
        .hero-subtitle {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 10px 0;
            opacity: 1;
            letter-spacing: 1px;
            color: #ffffff;
        }
        .hero-decorations {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        .paw-print {
            font-size: 1.5rem;
            animation: pawBounce 2s ease-in-out infinite;
        }
        @keyframes heroFadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pawBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }
        .main-content {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0 40px 40px 40px;
            display: flex;
            gap: 30px;
            box-sizing: border-box;
        }
        .main-content.reports-layout {
            margin: 0 auto;
        }
        .content-left {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        .main-content.reports-layout .content-left {
            align-items: center;
            max-width: 900px;
            margin: 0 auto;
        }
        .main-content.reports-layout .content-left .card {
            max-width: 100%;
            width: 100%;
        }
        .content-left .card {
            width: 100%;
            max-width: 100%;
        }
        table {
            width: 100%;
            table-layout: fixed;
            min-width: 1200px;
        }
        table td, table th {
            white-space: nowrap;
            padding: 12px 15px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        table td:nth-child(2) {
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        /* è¡¨æ ¼å®¹å™¨å…è®¸æ¨ªå‘æ»šåŠ¨ */
        .table-wrapper {
            overflow-x: auto;
            width: 100%;
            -webkit-overflow-scrolling: touch;
        }
        .content-right {
            flex: 0 0 350px;
            max-width: 350px;
        }
        .content-right:not(.reports-section) {
            display: none;
        }
        .card {
            background: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(74, 155, 142, 0.1);
            border: 1px solid var(--border-color);
            padding: 28px 24px 18px 24px;
            margin-bottom: 24px;
        }
        .analytics-card {
            padding: 35px 30px;
            box-shadow: 0 8px 30px rgba(74, 155, 142, 0.15);
        }
        .stat-card {
            text-align: center;
            padding: 30px 20px;
            color: white;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transition: transform 0.5s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        }
        .stat-card:hover::before {
            transform: rotate(45deg);
        }
        .stat-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        .stat-value {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .stat-label {
            font-size: 16px;
            font-weight: 600;
            opacity: 0.95;
            letter-spacing: 1px;
        }
        .section-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 12px;
            font-weight: 600;
        }
        .logout-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 28px;
            font-size: 1rem;
            cursor: pointer;
            float: right;
            margin-top: -10px;
        }
        .logout-btn:hover { background: #217dbb; }
        .list-placeholder { color: #888; font-size: 1rem; padding: 18px 0; text-align: center; background: #f4f8fb; border-radius: 8px; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .btn { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: var(--secondary-color); }

        /* ä¸¾æŠ¥è¯¦æƒ…å¼¹çª—æ ·å¼ */
        .report-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .report-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .report-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .report-modal-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        .report-modal-close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .report-modal-close:hover {
            color: var(--primary-color);
        }

        .report-detail-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .report-detail-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .report-detail-content {
            color: var(--text-color);
            line-height: 1.6;
        }

        .report-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .report-action-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-action-btn.ban-user {
            background: #e74c3c;
            color: white;
        }

        .report-action-btn.ban-blog {
            background: #f39c12;
            color: white;
        }

        .report-action-btn.reject {
            background: #95a5a6;
            color: white;
        }

        .report-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* ä¸¾æŠ¥å¡ç‰‡æ‚¬åœæ•ˆæœ */
        .report-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .report-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(74, 155, 142, 0.2) !important;
            border-color: var(--accent-color) !important;
        }

        .report-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(74, 155, 142, 0.05) 0%, rgba(74, 155, 142, 0.02) 100%);
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .report-card:hover::before {
            opacity: 1;
        }

        .report-card:hover::after {
            content: 'ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…';
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, rgba(74, 155, 142, 0.95) 0%, rgba(74, 155, 142, 0.85) 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            opacity: 0;
            animation: fadeInUp 0.3s ease forwards;
            box-shadow: 0 2px 8px rgba(74, 155, 142, 0.3);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å·²å¤„ç†ä¸¾æŠ¥åŒºåŸŸæ ·å¼ */
        #handled-report-list .report-card {
            background: #f8f9fa !important;
            border-left: 4px solid #27ae60 !important;
            opacity: 0.9;
        }

        #handled-report-list .report-card:hover {
            opacity: 1;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.12) !important;
        }

        /* çŠ¶æ€æ ‡ç­¾æ ·å¼ */
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .status-pending {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .status-user-banned {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .status-blog-banned {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .status-rejected {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
                gap: 20px;
            }
            .content-right {
                flex: 1;
                max-width: 100%;
            }
        }
        
        table {
            width: 100%;
            table-layout: auto;
        }
        
        th, td {
            white-space: nowrap;
            padding: 12px 8px;
        }
        
        th:nth-child(2), td:nth-child(2) {
            white-space: normal;
            max-width: 200px;
        }
        
        /* å¼¹çª—æ ·å¼ - ç¾åŒ–ç‰ˆ */
        .modal-overlay {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(74, 155, 142, 0.25);
            backdrop-filter: blur(10px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f0f8f7 100%);
            border: 2px solid var(--primary-color);
            border-radius: 24px;
            min-width: 500px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(74, 155, 142, 0.35), 0 0 0 1px rgba(74, 155, 142, 0.1);
            padding: 0;
            position: relative;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 24px 24px 0 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .modal-close {
            font-size: 32px;
            font-weight: bold;
            color: #ffffff;
            cursor: pointer;
            line-height: 1;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 32px;
            background: #ffffff;
        }
        
        .history-item {
            padding: 18px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 12px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px rgba(74, 155, 142, 0.1);
            transition: all 0.3s;
        }
        
        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(74, 155, 142, 0.2);
        }
        
        .history-item-title {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .history-item-content {
            color: #555;
            font-size: 14px;
            line-height: 1.8;
        }
        
        .blog-detail-content {
            line-height: 1.8;
            color: #333;
            font-size: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 12px;
            border: 1px solid rgba(74, 155, 142, 0.2);
        }
        
        .blog-detail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f0f8f7 0%, #e8f5f3 100%);
            border-radius: 12px;
            font-size: 14px;
            color: #555;
            border: 1px solid rgba(74, 155, 142, 0.2);
        }
        
        .blog-detail-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            font-weight: 500;
        }
    </style>
</head>
<body>
<header>
    <div class="nav">
        <a href="/" class="logo">Oh my dogï¼</a>
        <div class="nav-links">
            <a href="javascript:void(0)" onclick="showSection('reports')" class="active" id="nav-reports">ä¸¾æŠ¥ç®¡ç†</a>
            <div class="nav-dropdown">
                <a href="javascript:void(0)" class="nav-dropdown-btn">å†…å®¹ç®¡ç† â–¼</a>
                <div class="nav-dropdown-content">
                    <a href="javascript:void(0)" onclick="showSection('blogs')" id="nav-blogs">åšå®¢ç®¡ç†</a>
                    <a href="javascript:void(0)" onclick="showSection('replies')" id="nav-replies">è¯„è®ºç®¡ç†</a>
                    <a href="javascript:void(0)" onclick="showSection('votes')" id="nav-votes">æŠ•ç¥¨ç®¡ç†</a>
                </div>
            </div>
            <div class="nav-dropdown">
                <a href="javascript:void(0)" class="nav-dropdown-btn">ç”¨æˆ·ç®¡ç† â–¼</a>
                <div class="nav-dropdown-content">
                    <a href="javascript:void(0)" onclick="showSection('users')" id="nav-users">ç”¨æˆ·åˆ—è¡¨</a>
                    <a href="javascript:void(0)" onclick="showSection('consultations')" id="nav-consultations">é—®è¯Šç®¡ç†</a>
                </div>
            </div>
            <div class="nav-dropdown">
                <a href="javascript:void(0)" class="nav-dropdown-btn">æ•°æ®åˆ†æ â–¼</a>
                <div class="nav-dropdown-content">
                    <a href="javascript:void(0)" onclick="showSection('recommendations')" id="nav-recommendations">å†…å®¹æ¨è</a>
                    <a href="javascript:void(0)" onclick="showSection('analytics')" id="nav-analytics">æ•°æ®å¤§å±</a>
                </div>
            </div>
            <a href="/petblog/auditor_login.html">é€€å‡ºç™»å½•</a>
        </div>
    </div>
</header>
<div class="hero-banner">
    <div class="hero-image">
        <img src="/petblog/images/index1.png" alt="OH MY DOG Banner" />
        <div class="hero-overlay">
            <div class="hero-text">
                <h1 class="hero-title">ç®¡ç†å‘˜åå°</h1>
                <p class="hero-subtitle">å…¨é¢ç®¡ç†ï¼Œå®ˆæŠ¤ç¤¾åŒºå¥åº·å‘å±•</p>
                <div class="hero-decorations">
                    <span class="paw-print">ğŸ¾</span>
                    <span class="paw-print">ğŸ¾</span>
                    <span class="paw-print">ğŸ¾</span>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="main-content reports-layout" id="main-content">
    <div class="content-left">
        <!-- ä¸¾æŠ¥ç®¡ç†éƒ¨åˆ† -->
        <div id="reports-section" class="content-section active">
        <!-- ä¸¾æŠ¥ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="card" style="margin-bottom: 20px;">
            <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
                <span>ä¸¾æŠ¥ç»Ÿè®¡</span>
                <button onclick="showTipsModal()" style="padding: 8px 16px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; box-shadow: 0 2px 8px rgba(74, 155, 142, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(74, 155, 142, 0.4)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(74, 155, 142, 0.3)';">
                    ğŸ“‹ å®¡æ ¸å°è´´å£«
                </button>
            </div>
            <div id="report-stats" style="display: flex; gap: 20px; padding: 15px 0;">
                <div style="text-align: center; flex: 1;">
                    <div style="font-size: 24px; font-weight: bold; color: #e74c3c;" id="pending-count">0</div>
                    <div style="color: #666; font-size: 14px;">å¾…å¤„ç†</div>
                </div>
                <div style="text-align: center; flex: 1;">
                    <div style="font-size: 24px; font-weight: bold; color: #27ae60;" id="handled-count">0</div>
                    <div style="color: #666; font-size: 14px;">å·²å¤„ç†</div>
                </div>
                <div style="text-align: center; flex: 1;">
                    <div style="font-size: 24px; font-weight: bold; color: #3498db;" id="total-count">0</div>
                    <div style="color: #666; font-size: 14px;">æ€»è®¡</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-title">å¾…å¤„ç†ä¸¾æŠ¥</div>
            <div id="report-list" class="list-placeholder">æš‚æ— ä¸¾æŠ¥</div>
        </div>
        <div class="card">
            <div class="section-title">å·²å¤„ç†ä¸¾æŠ¥</div>
            <div id="handled-report-list" class="list-placeholder">æš‚æ— å·²å¤„ç†ä¸¾æŠ¥</div>
        </div>
    </div>

        <!-- ç”¨æˆ·ç®¡ç†éƒ¨åˆ† -->
        <div id="users-section" class="content-section" style="display: none;">
        <div class="card">
                <div class="section-title">
                    <span>ç”¨æˆ·åˆ—è¡¨</span>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <input type="text" id="user-search" placeholder="æœç´¢ç”¨æˆ·åæˆ–é‚®ç®±..." 
                               style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px;"
                               onkeyup="if(event.key==='Enter') searchUsers()">
                        <button class="btn btn-primary" onclick="searchUsers()" style="padding: 8px 16px;">æœç´¢</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--background-color);">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ID</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ç”¨æˆ·å</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ç­‰çº§</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">æ´»è·ƒåº¦</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">é‚®ç®±</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">æ³¨å†Œæ—¥æœŸ</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">çŠ¶æ€</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <tr><td colspan="6" class="list-placeholder">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="users-pagination" style="margin-top: 15px; text-align: center;"></div>
            </div>
        </div>

        <!-- åšå®¢ç®¡ç†éƒ¨åˆ† -->
        <div id="blogs-section" class="content-section" style="display: none;">
            <div class="card">
                <div class="section-title">åšå®¢åˆ—è¡¨</div>
                <div class="table-wrapper">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--background-color);">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ID</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color); min-width: 200px;">æ ‡é¢˜</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ä½œè€…</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">å‘å¸ƒæ—¶é—´</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ç‚¹èµ</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">è¯„è®º</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">æ”¶è—</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">çŠ¶æ€</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="blogs-tbody">
                            <tr><td colspan="9" class="list-placeholder">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="blogs-pagination" style="margin-top: 15px; text-align: center;"></div>
            </div>
        </div>

        <!-- è¯„è®ºç®¡ç†éƒ¨åˆ† -->
        <div id="replies-section" class="content-section" style="display: none;">
            <div class="card">
                <div class="section-title">è¯„è®ºåˆ—è¡¨</div>
                <div class="table-wrapper">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--background-color);">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ID</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">å†…å®¹</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ç”¨æˆ·</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">åšå®¢ID</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">çŠ¶æ€</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="replies-tbody">
                            <tr><td colspan="6" class="list-placeholder">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="replies-pagination" style="margin-top: 15px; text-align: center;"></div>
            </div>
        </div>

        <!-- é—®è¯Šç®¡ç†éƒ¨åˆ† -->
        <div id="consultations-section" class="content-section" style="display: none;">
            <div class="card">
                <div class="section-title">é—®è¯Šè®°å½•</div>
                <div class="table-wrapper">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--background-color);">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ID</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ç”¨æˆ·ID</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ç—‡çŠ¶</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">è¯Šæ–­ç–¾ç—…</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">ç½®ä¿¡åº¦</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border-color);">åˆ›å»ºæ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody id="consultations-tbody">
                            <tr><td colspan="6" class="list-placeholder">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="consultations-pagination" style="margin-top: 15px; text-align: center;"></div>
            </div>
        </div>

        <!-- æŠ•ç¥¨ç®¡ç†éƒ¨åˆ† -->
        <div id="votes-section" class="content-section" style="display: none;">
            <div class="card">
                <div class="section-title">è·èƒœç‹—ç‹—</div>
                <div id="winners-container" class="list-placeholder">åŠ è½½ä¸­...</div>
            </div>
            <div class="card">
                <div class="section-title">æŠ•ç¥¨ç»Ÿè®¡</div>
                <div id="vote-stats-container" class="list-placeholder">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- å†…å®¹æ¨èç®¡ç†éƒ¨åˆ† -->
        <div id="recommendations-section" class="content-section" style="display: none;">
            <div class="card">
                <div class="section-title">æ¨èåšå®¢ç®¡ç†</div>
                <div style="margin-bottom: 15px;">
                    <label>æ¨èè§„åˆ™ï¼š</label>
                    <select id="recommend-rule" onchange="loadRecommendedBlogs()" style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); margin-left: 10px;">
                        <option value="weight">ç»¼åˆæƒé‡</option>
                        <option value="likes">æŒ‰ç‚¹èµæ•°</option>
                        <option value="comments">æŒ‰è¯„è®ºæ•°</option>
                        <option value="recent">æŒ‰å‘å¸ƒæ—¶é—´</option>
                    </select>
                </div>
                <div id="recommended-blogs-container" class="list-placeholder">åŠ è½½ä¸­...</div>
            </div>
            <div class="card">
                <div class="section-title">çƒ­é—¨è¯é¢˜</div>
                <div id="hot-topics-container" class="list-placeholder">åŠ è½½ä¸­...</div>
            </div>
            <div class="card">
                <div class="section-title">ä¼˜è´¨ä½œè€…</div>
                <div id="top-authors-container" class="list-placeholder">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- æ•°æ®å¯è§†åŒ–å¤§å±éƒ¨åˆ† -->
        <div id="analytics-section" class="content-section" style="display: none;">
            <!-- å¹³å°æ€»ä½“ç»Ÿè®¡ -->
            <div class="card analytics-card">
                <div class="section-title" style="font-size: 1.5rem; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 3px solid var(--primary-color);">
                    ğŸ“Š å¹³å°æ€»ä½“ç»Ÿè®¡
                </div>
                <div id="platform-stats-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; padding: 20px 0;">
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-value" id="stat-total-users">-</div>
                        <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="stat-icon">ğŸ“</div>
                        <div class="stat-value" id="stat-total-blogs">-</div>
                        <div class="stat-label">æ€»åšå®¢æ•°</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="stat-icon">âœ¨</div>
                        <div class="stat-value" id="stat-today-users">-</div>
                        <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <div class="stat-icon">ğŸ”¥</div>
                        <div class="stat-value" id="stat-active-users">-</div>
                        <div class="stat-label">æ´»è·ƒç”¨æˆ·</div>
                    </div>
                </div>
            </div>
            
            <!-- åšå®¢çƒ­åº¦è¶‹åŠ¿ -->
            <div class="card analytics-card">
                <div class="section-title" style="font-size: 1.5rem; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid var(--primary-color);">
                    ğŸ“ˆ åšå®¢çƒ­åº¦è¶‹åŠ¿
                </div>
                <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
                    <label style="font-weight: 600; color: var(--text-primary);">æ—¶é—´èŒƒå›´ï¼š</label>
                    <select id="blog-trend-days" onchange="loadBlogTrend()" style="padding: 10px 15px; border-radius: 8px; border: 2px solid var(--border-color); background: white; font-size: 14px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--primary-color)'" onmouseout="this.style.borderColor='var(--border-color)'">
                        <option value="7">æœ€è¿‘7å¤©</option>
                        <option value="30" selected>æœ€è¿‘30å¤©</option>
                        <option value="90">æœ€è¿‘90å¤©</option>
                    </select>
                </div>
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                    <canvas id="blog-trend-chart" style="max-height: 450px;"></canvas>
                </div>
            </div>
            
            <!-- ç”¨æˆ·å¢é•¿è¶‹åŠ¿ -->
            <div class="card analytics-card">
                <div class="section-title" style="font-size: 1.5rem; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid var(--primary-color);">
                    ğŸ“Š ç”¨æˆ·å¢é•¿è¶‹åŠ¿
                </div>
                <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
                    <label style="font-weight: 600; color: var(--text-primary);">æ—¶é—´èŒƒå›´ï¼š</label>
                    <select id="user-growth-days" onchange="loadUserGrowth()" style="padding: 10px 15px; border-radius: 8px; border: 2px solid var(--border-color); background: white; font-size: 14px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--primary-color)'" onmouseout="this.style.borderColor='var(--border-color)'">
                        <option value="7">æœ€è¿‘7å¤©</option>
                        <option value="30" selected>æœ€è¿‘30å¤©</option>
                        <option value="90">æœ€è¿‘90å¤©</option>
                    </select>
                </div>
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                    <canvas id="user-growth-chart" style="max-height: 450px;"></canvas>
                </div>
            </div>
            
            <!-- é—®è¯Šç—‡çŠ¶é¢‘ç‡ç»Ÿè®¡ -->
            <div class="card analytics-card">
                <div class="section-title" style="font-size: 1.5rem; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid var(--primary-color);">
                    ğŸ¥ é—®è¯Šç—‡çŠ¶é¢‘ç‡ç»Ÿè®¡
                </div>
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                    <canvas id="symptom-chart" style="max-height: 450px;"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç”¨æˆ·å†å²æŸ¥çœ‹å¼¹çª— -->
    <div id="userHistoryModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç”¨æˆ·å†å²è®°å½•</h2>
                <button class="modal-close" onclick="closeUserHistoryModal()">&times;</button>
            </div>
            <div class="modal-body" id="userHistoryContent">
                <div style="text-align: center; color: #666; padding: 40px;">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>
    
    <!-- åšå®¢è¯¦æƒ…æŸ¥çœ‹å¼¹çª— -->
    <div id="blogDetailModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>åšå®¢è¯¦æƒ…</h2>
                <button class="modal-close" onclick="closeBlogDetailModal()">&times;</button>
            </div>
            <div class="modal-body" id="blogDetailContent">
                <div style="text-align: center; color: #666; padding: 40px;">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>
    
    <!-- å®¡æ ¸å°è´´å£«å¼¹çª— -->
    <div id="tipsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>ğŸ“‹ å®¡æ ¸å°è´´å£«</h2>
                <button class="modal-close" onclick="closeTipsModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 32px; background: #ffffff;">
                <div style="color:#3e6b61;line-height:1.8;font-size:15px;">
                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: 700; font-size: 18px; color: var(--primary-color); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color);">
                            ğŸ“Œ ä¸€ã€è¯æ®æ ¸å®
                        </div>
                        <ul style="padding-left: 20px; margin: 0;">
                            <li style="margin-bottom: 8px;">åŒè¯æŸ¥éªŒ</li>
                            <li style="margin-bottom: 8px;">åŒæ—¶æŸ¥çœ‹ä¸¾æŠ¥å†…å®¹ + åŸå§‹åšå®¢ï¼Œé¿å…æ–­ç« å–ä¹‰</li>
                            <li style="margin-bottom: 8px;">é‡ç‚¹æ£€æŸ¥ï¼šæ•æ„Ÿè¯è§¦å‘ä½ç½®ã€åšå®¢é™„ä»¶æ˜¯å¦å«è¿è§„å…ƒç´ ï¼ˆè¡€è…¥ / è‰²æƒ… / ä¾µæƒï¼‰</li>
                            <li style="margin-bottom: 8px;">æ¶‰åŠç‰ˆæƒä¾µæƒï¼šç”¨ç™¾åº¦å›¾ç‰‡åå‘æœç´¢æ ¸å®åŸå›¾æ¥æº</li>
                            <li style="margin-bottom: 8px;">æ¶‰åŠå® ç‰©è™å¾…ï¼šè”ç³» "å¥åº·åŒ»ç–—" æ¿å—ç‰ˆä¸»ååŠ©åˆ¤æ–­å†…å®¹çœŸå®æ€§</li>
                        </ul>
                    </div>
                    
                    <div>
                        <div style="font-weight: 700; font-size: 18px; color: var(--primary-color); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color);">
                            âš™ï¸ äºŒã€æƒé™æ“ä½œ
                        </div>
                        <ul style="padding-left: 20px; margin: 0;">
                            <li style="margin-bottom: 12px;">
                                <strong>å°ç¦ç”¨æˆ·</strong><br>
                                éœ€æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼š
                                <ul style="margin-top: 6px; margin-bottom: 6px; padding-left: 20px;">
                                    <li style="margin-bottom: 4px;">å‘å¸ƒè¿æ³•å†…å®¹</li>
                                    <li style="margin-bottom: 4px;">æ¶æ„ä¸¾æŠ¥â‰¥5 æ¬¡</li>
                                    <li style="margin-bottom: 4px;">éªšæ‰°å…¶ä»–ç”¨æˆ·è¶… 3 æ¬¡</li>
                    </ul>
                </li>
                            <li style="margin-bottom: 8px;">
                                <strong>é©³å›ä¸¾æŠ¥</strong><br>
                                å¿…é¡»å¡«å†™é©³å›ç†ç”±ï¼Œè‡ªåŠ¨å‘é€é€šçŸ¥ç»™ä¸¾æŠ¥è€…
                            </li>
            </ul>
        </div>
    </div>
            </div>
        </div>
    </div>
    
    <script>
        // åŠ è½½ä¸¾æŠ¥ç»Ÿè®¡ä¿¡æ¯
        async function loadReportStats() {
            try {
                const response = await fetch('/petblog/api/reports/stats');
                const result = await response.json();

                if (result.success) {
                    const stats = result.stats;
                    document.getElementById('pending-count').textContent = stats.pending;
                    document.getElementById('handled-count').textContent = stats.handled;
                    document.getElementById('total-count').textContent = stats.total;
                } else {
                    console.error('è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', result.message);
                    // å¦‚æœç»Ÿè®¡APIå¤±è´¥ï¼Œè®¾ç½®ä¸º0
                    document.getElementById('pending-count').textContent = '0';
                    document.getElementById('handled-count').textContent = '0';
                    document.getElementById('total-count').textContent = '0';
                }
            } catch (error) {
                console.error('è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
                // å¦‚æœç»Ÿè®¡APIå¤±è´¥ï¼Œè®¾ç½®ä¸º0
                document.getElementById('pending-count').textContent = '0';
                document.getElementById('handled-count').textContent = '0';
                document.getElementById('total-count').textContent = '0';
            }
        }

        async function loadReports() {
            console.log('å¼€å§‹è°ƒç”¨ loadReports å‡½æ•°');
            try {
                console.log('æ­£åœ¨è¯·æ±‚ /petblog/api/reports/all');
                const res = await fetch('/petblog/api/reports/all');
                console.log('å“åº”çŠ¶æ€:', res.status, res.statusText);
                
                if (!res.ok) {
                    console.error('è·å–ä¸¾æŠ¥åˆ—è¡¨å¤±è´¥ï¼ŒçŠ¶æ€ç :', res.status);
                    const errorText = await res.text();
                    console.error('é”™è¯¯å“åº”å†…å®¹:', errorText);
                    document.getElementById('report-list').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯• (çŠ¶æ€ç : ' + res.status + ')</div>';
                    document.getElementById('handled-report-list').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
                    loadReportStats();
                    return;
                }
                
                const data = await res.json();
                console.log('è·å–åˆ°çš„å®Œæ•´å“åº”æ•°æ®:', JSON.stringify(data, null, 2));
                console.log('data.success:', data.success);
                console.log('data.reports æ˜¯å¦å­˜åœ¨:', data.reports !== undefined);
                console.log('data.reports æ˜¯å¦ä¸ºæ•°ç»„:', Array.isArray(data.reports));
                if (data.reports) {
                    console.log('data.reports é•¿åº¦:', data.reports.length);
                }
                
                const pendingList = document.getElementById('report-list');
                const handledList = document.getElementById('handled-report-list');

                // æ£€æŸ¥æ•°æ®æ ¼å¼
                if (!data) {
                    console.error('è¿”å›æ•°æ®ä¸ºç©º');
                    pendingList.innerHTML = '<div class="list-placeholder">æš‚æ— ä¸¾æŠ¥</div>';
                    handledList.innerHTML = '<div class="list-placeholder">æš‚æ— å·²å¤„ç†ä¸¾æŠ¥</div>';
                    loadReportStats();
                    return;
                }

                // å…¼å®¹ä¸åŒçš„æ•°æ®æ ¼å¼
                let reports = [];
                if (data.reports && Array.isArray(data.reports)) {
                    reports = data.reports;
                } else if (Array.isArray(data)) {
                    reports = data;
                } else if (data.success === false) {
                    console.error('APIè¿”å›é”™è¯¯:', data.error);
                    pendingList.innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                    handledList.innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥</div>';
                    loadReportStats();
                    return;
                }

                if (reports.length === 0) {
                    pendingList.innerHTML = '<div class="list-placeholder">æš‚æ— ä¸¾æŠ¥</div>';
                    handledList.innerHTML = '<div class="list-placeholder">æš‚æ— å·²å¤„ç†ä¸¾æŠ¥</div>';
                    loadReportStats();
                    return;
                }

                // è°ƒè¯•ï¼šæ‰“å°ç¬¬ä¸€ä¸ªæŠ¥å‘Šå¯¹è±¡ï¼ŒæŸ¥çœ‹å­—æ®µå
                if (reports.length > 0) {
                    console.log('ç¬¬ä¸€ä¸ªæŠ¥å‘Šå¯¹è±¡:', reports[0]);
                    console.log('reportId:', reports[0].reportId, 'report_id:', reports[0].report_id);
                    console.log('reportStatus:', reports[0].reportStatus, 'report_status:', reports[0].report_status);
                }

                // åˆ†ç»„ - å…¼å®¹ä¸¤ç§å­—æ®µåæ ¼å¼
                console.log('å¼€å§‹è¿‡æ»¤ä¸¾æŠ¥ï¼Œæ€»æ•°:', reports.length);
                const pending = reports.filter(r => {
                    const status = r.reportStatus !== undefined ? r.reportStatus : (r.report_status !== undefined ? r.report_status : null);
                    const isPending = status == 0 || status === 0;
                    if (reports.length <= 5) { // åªåœ¨å‰å‡ æ¡è®°å½•æ—¶æ‰“å°è¯¦ç»†æ—¥å¿—
                        console.log('ä¸¾æŠ¥è®°å½•:', {
                            report_id: r.report_id || r.reportId,
                            status: status,
                            statusType: typeof status,
                            isPending: isPending
                        });
                    }
                    return isPending;
                });
                const handled = reports.filter(r => {
                    const status = r.reportStatus !== undefined ? r.reportStatus : (r.report_status !== undefined ? r.report_status : null);
                    const isHandled = status != 0 && status !== 0 && status !== null;
                    return isHandled;
                });
                
                console.log('=== è¿‡æ»¤ç»“æœ ===');
                console.log('å¾…å¤„ç†ä¸¾æŠ¥æ•°é‡:', pending.length);
                console.log('å·²å¤„ç†ä¸¾æŠ¥æ•°é‡:', handled.length);
                console.log('å¾…å¤„ç†ä¸¾æŠ¥åˆ—è¡¨:', pending);
                console.log('å·²å¤„ç†ä¸¾æŠ¥åˆ—è¡¨:', handled);

                // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
                loadReportStats();

                // æ¸²æŸ“å¾…å¤„ç†ä¸¾æŠ¥
                console.log('å¼€å§‹æ¸²æŸ“å¾…å¤„ç†ä¸¾æŠ¥ï¼Œæ•°é‡:', pending.length);
                if (pending.length > 0) {
                    const pendingHtml = pending.filter(r => {
                        const id = r.reportId !== undefined ? r.reportId : r.report_id;
                        return id != null && id !== undefined;
                    }).map(r => {
                    // å…¼å®¹ä¸¤ç§å­—æ®µåæ ¼å¼
                    const reportId = r.reportId !== undefined ? r.reportId : r.report_id;
                    const userId = r.userId !== undefined ? r.userId : r.user_id;
                    const blogId = r.blogId !== undefined ? r.blogId : r.blog_id;
                    const reportCreatedTime = r.reportCreatedTime !== undefined ? r.reportCreatedTime : r.report_createdtime;
                    const userName = r.userName !== undefined ? r.userName : r.user_name;
                    const blogTitle = r.blogTitle !== undefined ? r.blogTitle : r.blog_title;

                        return `
                    <div class="report-card" style="background:linear-gradient(135deg, #fff 0%, #f8f9fa 100%);border-radius:16px;box-shadow:0 4px 20px rgba(74,155,142,0.1);border:2px solid #e8f5e8;padding:24px;margin-bottom:20px;transition:all 0.3s ease;cursor:pointer;position:relative;overflow:hidden;" onclick="showReportDetail(${reportId})">
                    <div style="position:absolute;top:0;left:0;width:4px;height:100%;background:linear-gradient(180deg, #e74c3c 0%, #c0392b 100%);"></div>
                    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;">
                        <div style="flex:1;">
                            <div style="font-size:13px;color:#7f8c8d;display:flex;align-items:center;gap:8px;">
                                <span>ğŸ“… ${new Date(reportCreatedTime).toLocaleString()}</span>
                            </div>
                        </div>
                        <span class="status-badge status-pending" style="margin-left:12px;">å¾…å¤„ç†</span>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
                        <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #ecf0f1;">
                            <div style="font-weight:600;color:#34495e;margin-bottom:4px;">ğŸ‘¤ ä¸¾æŠ¥äºº</div>
                            <div style="color:#7f8c8d;font-size:14px;">${userName || userId}</div>
                        </div>
                        <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #ecf0f1;">
                            <div style="font-weight:600;color:#34495e;margin-bottom:4px;">ğŸ“ ä¸¾æŠ¥ç†ç”±</div>
                            <div style="color:#e67e22;font-size:14px;font-weight:500;">${r.reason}</div>
                        </div>
                    </div>
                    <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #ecf0f1;margin-bottom:20px;">
                        <div style="font-weight:600;color:#34495e;margin-bottom:4px;">ğŸ“„ åšå®¢æ ‡é¢˜</div>
                        <div style="color:#2c3e50;font-size:14px;font-weight:500;">${blogTitle || 'åšå®¢ID:' + blogId}</div>
                    </div>
                    <div style="display:flex;gap:10px;justify-content:flex-end;" onclick="event.stopPropagation();">
                        <button class="action-btn" style="background:linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);color:#fff;border:none;border-radius:10px;padding:10px 20px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(231,76,60,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(231,76,60,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 2px 8px rgba(231,76,60,0.3)'" onclick="banUser(${userId}, ${reportId})">ğŸš« å°ç¦ç”¨æˆ·</button>
                        <button class="action-btn" style="background:linear-gradient(135deg, #f39c12 0%, #e67e22 100%);color:#fff;border:none;border-radius:10px;padding:10px 20px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(243,156,18,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(243,156,18,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 2px 8px rgba(243,156,18,0.3)'" onclick="banBlog(${blogId}, ${reportId})">ğŸš« å°ç¦åšå®¢</button>
                        <button class="action-btn" style="background:linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);color:#fff;border:none;border-radius:10px;padding:10px 20px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(149,165,166,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(149,165,166,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 2px 8px rgba(149,165,166,0.3)'" onclick="rejectReport(${reportId}, ${userId})">âŒ é©³å›ä¸¾æŠ¥</button>
                        </div>
                    </div>
                `;
                    }).join('');
                    console.log('å¾…å¤„ç†ä¸¾æŠ¥HTMLé•¿åº¦:', pendingHtml.length);
                    pendingList.innerHTML = pendingHtml;
                    console.log('å¾…å¤„ç†ä¸¾æŠ¥å·²æ¸²æŸ“åˆ°é¡µé¢');
            } else {
                console.log('æ²¡æœ‰å¾…å¤„ç†ä¸¾æŠ¥');
                pendingList.innerHTML = '<div class="list-placeholder">æš‚æ— å¾…å¤„ç†ä¸¾æŠ¥</div>';
            }

            // æ¸²æŸ“å·²å¤„ç†ä¸¾æŠ¥
            console.log('å¼€å§‹æ¸²æŸ“å·²å¤„ç†ä¸¾æŠ¥ï¼Œæ•°é‡:', handled.length);
            if (handled.length > 0) {
                const handledHtml = handled.filter(r => {
                    const id = r.reportId !== undefined ? r.reportId : r.report_id;
                    return id != null && id !== undefined;
                }).map(r => {
                    // å…¼å®¹ä¸¤ç§å­—æ®µåæ ¼å¼
                    const reportId = r.reportId !== undefined ? r.reportId : r.report_id;
                    const userId = r.userId !== undefined ? r.userId : r.user_id;
                    const blogId = r.blogId !== undefined ? r.blogId : r.blog_id;
                    const reportCreatedTime = r.reportCreatedTime !== undefined ? r.reportCreatedTime : r.report_createdtime;
                    const userName = r.userName !== undefined ? r.userName : r.user_name;
                    const blogTitle = r.blogTitle !== undefined ? r.blogTitle : r.blog_title;
                    const reportStatus = r.reportStatus !== undefined ? r.reportStatus : (r.report_status !== undefined ? r.report_status : null);
                    const userIsBan = r.userIsBan !== undefined ? r.userIsBan : (r.user_is_ban !== undefined ? r.user_is_ban : (r.is_ban !== undefined ? r.is_ban : 0));
                    const blogIsShielded = r.blogIsShielded !== undefined ? r.blogIsShielded : (r.blog_is_shielded !== undefined ? r.blog_is_shielded : (r.is_shielded !== undefined ? r.is_shielded : 0));

                    let statusText = 'å·²å¤„ç†';
                    let statusClass = 'status-pending';
                    let statusColor = '#95a5a6';
                    // ä¼˜å…ˆåˆ¤æ–­ç”¨æˆ·å°ç¦ï¼Œå…¶æ¬¡åšå®¢å°ç¦ï¼Œå†åˆ¤æ–­report_status
                    if (userIsBan == 1) {
                        statusText = 'ç”¨æˆ·å·²å°ç¦';
                        statusClass = 'status-user-banned';
                        statusColor = '#e74c3c';
                    } else if (blogIsShielded == 1) {
                        statusText = 'åšå®¢å·²å°ç¦';
                        statusClass = 'status-blog-banned';
                        statusColor = '#f39c12';
                    } else if (reportStatus == 1) {
                        statusText = 'ç”¨æˆ·å·²å°ç¦';
                        statusClass = 'status-user-banned';
                        statusColor = '#e74c3c';
                    } else if (reportStatus == 2) {
                        statusText = 'åšå®¢å·²å°ç¦';
                        statusClass = 'status-blog-banned';
                        statusColor = '#f39c12';
                    } else if (reportStatus == 3) {
                        statusText = 'ä¸¾æŠ¥å·²é©³å›';
                        statusClass = 'status-rejected';
                        statusColor = '#95a5a6';
                    }
                    return `
                    <div class="report-card" style="background:linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);border-radius:16px;box-shadow:0 3px 15px rgba(39,174,96,0.08);border:2px solid #d4edda;padding:24px;margin-bottom:18px;opacity:0.95;cursor:pointer;position:relative;overflow:hidden;" onclick="showReportDetail(${reportId})">
                        <div style="position:absolute;top:0;left:0;width:4px;height:100%;background:linear-gradient(180deg, ${statusColor} 0%, ${statusColor}dd 100%);"></div>
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;">
                            <div style="flex:1;">
                                <div style="font-size:13px;color:#6c757d;display:flex;align-items:center;gap:8px;">
                                    <span>ğŸ“… ${new Date(reportCreatedTime).toLocaleString()}</span>
                                </div>
                            </div>
                            <span class="status-badge ${statusClass}" style="margin-left:12px;background:${statusColor};">${statusText}</span>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
                            <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #dee2e6;">
                                <div style="font-weight:600;color:#495057;margin-bottom:4px;">ğŸ‘¤ ä¸¾æŠ¥äºº</div>
                                <div style="color:#6c757d;font-size:14px;">${userName || userId}</div>
                            </div>
                            <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #dee2e6;">
                                <div style="font-weight:600;color:#495057;margin-bottom:4px;">ğŸ“ ä¸¾æŠ¥ç†ç”±</div>
                                <div style="color:#e67e22;font-size:14px;font-weight:500;">${r.reason}</div>
                            </div>
                        </div>
                        <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #dee2e6;margin-bottom:0;">
                            <div style="font-weight:600;color:#495057;margin-bottom:4px;">ğŸ“„ åšå®¢æ ‡é¢˜</div>
                            <div style="color:#495057;font-size:14px;font-weight:500;">${blogTitle || 'åšå®¢ID:' + blogId}</div>
                        </div>
                    </div>
                `;
                }).join('');
                console.log('å·²å¤„ç†ä¸¾æŠ¥HTMLé•¿åº¦:', handledHtml.length);
                handledList.innerHTML = handledHtml;
                console.log('å·²å¤„ç†ä¸¾æŠ¥å·²æ¸²æŸ“åˆ°é¡µé¢');
            } else {
                console.log('æ²¡æœ‰å·²å¤„ç†ä¸¾æŠ¥');
                handledList.innerHTML = '<div class="list-placeholder">æš‚æ— å·²å¤„ç†ä¸¾æŠ¥</div>';
            }
            } catch (error) {
                console.error('loadReports å‡½æ•°æ‰§è¡Œå‡ºé”™:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
                document.getElementById('report-list').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥: ' + error.message + '</div>';
                document.getElementById('handled-report-list').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥</div>';
                loadReportStats();
            }
        }

        // æ˜¾ç¤ºä¸¾æŠ¥è¯¦æƒ…
        async function showReportDetail(reportId) {
            // éªŒè¯å‚æ•°
            if (!reportId || reportId === 'undefined' || reportId === 'null') {
                console.error('æ— æ•ˆçš„ä¸¾æŠ¥ID:', reportId);
                alert('æ— æ•ˆçš„ä¸¾æŠ¥IDï¼Œæ— æ³•åŠ è½½è¯¦æƒ…');
                return;
            }

            try {
                const response = await fetch(`/petblog/api/reports/${reportId}/detail`);
                const result = await response.json();

                if (result.success) {
                    const report = result.report;
                    const blog = result.blog;
                    const reporter = result.reporter;
                    const blogAuthor = result.blogAuthor;

                    // å…¼å®¹ä¸¤ç§å­—æ®µåæ ¼å¼
                    const reportId = report.reportId !== undefined ? report.reportId : report.report_id;
                    const reportCreatedTime = report.reportCreatedTime !== undefined ? report.reportCreatedTime : report.report_createdtime;
                    const reportStatus = report.reportStatus !== undefined ? report.reportStatus : report.report_status;
                    const reportHandledTime = report.reportHandledTime !== undefined ? report.reportHandledTime : report.report_handled_time;

                    const reporterUserId = reporter ? (reporter.userId !== undefined ? reporter.userId : reporter.user_id) : null;
                    const reporterUserName = reporter ? (reporter.userName !== undefined ? reporter.userName : reporter.user_name) : null;
                    const reporterEmail = reporter ? (reporter.email !== undefined ? reporter.email : reporter.user_email) : null;

                    const blogId = blog ? (blog.blogId !== undefined ? blog.blogId : blog.blog_id) : null;
                    const blogTitle = blog ? (blog.blogTitle !== undefined ? blog.blogTitle : blog.blog_title) : null;
                    const blogContent = blog ? (blog.blogContent !== undefined ? blog.blogContent : blog.blog_content) : null;
                    const blogCreateTime = blog ? (blog.blogCreateTime !== undefined ? blog.blogCreateTime : blog.blog_create_time) : null;
                    const likeCount = blog ? (blog.likeCount !== undefined ? blog.likeCount : blog.like_count) : 0;
                    const favoriteCount = blog ? (blog.favoriteCount !== undefined ? blog.favoriteCount : blog.favorite_count) : 0;
                    const commentCount = blog ? (blog.commentCount !== undefined ? blog.commentCount : blog.comment_count) : 0;

                    const blogAuthorUserId = blogAuthor ? (blogAuthor.userId !== undefined ? blogAuthor.userId : blogAuthor.user_id) : null;
                    const blogAuthorUserName = blogAuthor ? (blogAuthor.userName !== undefined ? blogAuthor.userName : blogAuthor.user_name) : null;
                    const blogAuthorEmail = blogAuthor ? (blogAuthor.email !== undefined ? blogAuthor.email : blogAuthor.user_email) : null;
                    const blogAuthorCreatedTime = blogAuthor ? (blogAuthor.userCreatedTime !== undefined ? blogAuthor.userCreatedTime : blogAuthor.user_createdtime) : null;

                    const detailContent = `
                    <div class="report-detail-section">
                        <div class="report-detail-title">ä¸¾æŠ¥ä¿¡æ¯</div>
                        <div class="report-detail-content">
                            <p><strong>ä¸¾æŠ¥IDï¼š</strong>${reportId}</p>
                            <p><strong>ä¸¾æŠ¥æ—¶é—´ï¼š</strong>${new Date(reportCreatedTime).toLocaleString()}</p>
                            <p><strong>ä¸¾æŠ¥çŠ¶æ€ï¼š</strong>${reportStatus == 0 ? '<span style="color:#e74c3c;">å¾…å¤„ç†</span>' : '<span style="color:#27ae60;">å·²å¤„ç†</span>'}</p>
                            ${reportHandledTime ? `<p><strong>å¤„ç†æ—¶é—´ï¼š</strong>${new Date(reportHandledTime).toLocaleString()}</p>` : ''}
                        </div>
                    </div>
                    
                    <div class="report-detail-section">
                        <div class="report-detail-title">ä¸¾æŠ¥äººä¿¡æ¯</div>
                        <div class="report-detail-content">
                            <p><strong>ç”¨æˆ·IDï¼š</strong>${reporterUserId || 'æœªçŸ¥'}</p>
                            <p><strong>ç”¨æˆ·åï¼š</strong>${reporterUserName || 'æœªçŸ¥'}</p>
                            <p><strong>é‚®ç®±ï¼š</strong>${reporterEmail || 'æœªçŸ¥'}</p>
                        </div>
                    </div>
                    
                    <div class="report-detail-section">
                        <div class="report-detail-title">ä¸¾æŠ¥ç†ç”±</div>
                        <div class="report-detail-content">
                            <p style="color:#e67e22;font-weight:500;">${report.reason || 'æ— '}</p>
                        </div>
                    </div>
                    
                    <div class="report-detail-section">
                        <div class="report-detail-title">è¢«ä¸¾æŠ¥åšå®¢ä¿¡æ¯</div>
                        <div class="report-detail-content">
                            <p><strong>åšå®¢IDï¼š</strong>${blogId || 'æœªçŸ¥'}</p>
                            <p><strong>åšå®¢æ ‡é¢˜ï¼š</strong>${blogTitle || 'æ— æ ‡é¢˜'}</p>
                            <p><strong>åšå®¢å†…å®¹ï¼š</strong></p>
                            <div style="background:#f1f1f1;padding:10px;border-radius:5px;margin:5px 0;max-height:200px;overflow-y:auto;">
                                ${blogContent || 'æ— å†…å®¹'}
                            </div>
                            <p><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>${blogCreateTime ? new Date(blogCreateTime).toLocaleString() : 'æœªçŸ¥'}</p>
                            <p><strong>ç‚¹èµæ•°ï¼š</strong>${likeCount || 0}</p>
                            <p><strong>æ”¶è—æ•°ï¼š</strong>${favoriteCount || 0}</p>
                            <p><strong>è¯„è®ºæ•°ï¼š</strong>${commentCount || 0}</p>
                        </div>
                    </div>
                    
                    <div class="report-detail-section">
                        <div class="report-detail-title">åšå®¢ä½œè€…ä¿¡æ¯</div>
                        <div class="report-detail-content">
                            <p><strong>ç”¨æˆ·IDï¼š</strong>${blogAuthorUserId || 'æœªçŸ¥'}</p>
                            <p><strong>ç”¨æˆ·åï¼š</strong>${blogAuthorUserName || 'æœªçŸ¥'}</p>
                            <p><strong>é‚®ç®±ï¼š</strong>${blogAuthorEmail || 'æœªçŸ¥'}</p>
                            <p><strong>æ³¨å†Œæ—¶é—´ï¼š</strong>${blogAuthorCreatedTime ? new Date(blogAuthorCreatedTime).toLocaleString() : 'æœªçŸ¥'}</p>
                        </div>
                    </div>
                    
                    ${reportStatus == 0 ? `
                        <div class="report-actions">
                            <button class="report-action-btn ban-user" onclick="banUserFromDetail(${blogAuthorUserId}, ${reportId})">
                                ğŸš« å°ç¦ç”¨æˆ·
                            </button>
                            <button class="report-action-btn ban-blog" onclick="banBlogFromDetail(${blogId}, ${reportId})">
                                ğŸš« å°ç¦åšå®¢
                            </button>
                            <button class="report-action-btn reject" onclick="rejectReportFromDetail(${reportId}, ${reporterUserId})">
                                âŒ é©³å›ä¸¾æŠ¥
                            </button>
                </div>
                    ` : ''}
                `;

                    document.getElementById('reportDetailContent').innerHTML = detailContent;
                    document.getElementById('reportDetailModal').style.display = 'block';
                } else {
                    alert('è·å–ä¸¾æŠ¥è¯¦æƒ…å¤±è´¥ï¼š' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('è·å–ä¸¾æŠ¥è¯¦æƒ…å¤±è´¥:', error);
                alert('è·å–ä¸¾æŠ¥è¯¦æƒ…å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // å…³é—­ä¸¾æŠ¥è¯¦æƒ…å¼¹çª—
        function closeReportModal() {
            document.getElementById('reportDetailModal').style.display = 'none';
        }

        // ä»è¯¦æƒ…å¼¹çª—å°ç¦ç”¨æˆ·
        function banUserFromDetail(userId, reportId) {
            if (!confirm('ç¡®å®šè¦å°ç¦è¯¥ç”¨æˆ·å—ï¼Ÿ')) return;
            fetch('/petblog/api/reports/banUser', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: userId, report_id: reportId })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    // å‘é€é€šçŸ¥ç»™è¢«å°ç¦çš„ç”¨æˆ·
                    sendUserNotification(userId, 'error', 'æ‚¨çš„è´¦æˆ·å› è¿åç¤¾åŒºè§„å®šå·²è¢«å°ç¦ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚');
                    alert('ç”¨æˆ·å°ç¦æˆåŠŸï¼');
                    closeReportModal();
                    loadReports();
                } else {
                    alert(data.message || 'æ“ä½œå¤±è´¥');
                }
            });
        }

        // ä»è¯¦æƒ…å¼¹çª—å°ç¦åšå®¢
        function banBlogFromDetail(blogId, reportId) {
            if (!confirm('ç¡®å®šè¦å°ç¦è¯¥åšå®¢å—ï¼Ÿ')) return;
            fetch('/petblog/api/reports/banBlog', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ blog_id: blogId, report_id: reportId })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    // è·å–åšå®¢ä½œè€…IDå¹¶å‘é€é€šçŸ¥
                    getBlogAuthorId(blogId).then(authorId => {
                        if (authorId) {
                            sendUserNotification(authorId, 'warning', 'æ‚¨å‘å¸ƒçš„åšå®¢å› è¿åç¤¾åŒºè§„å®šå·²è¢«å°ç¦ã€‚è¯·éµå®ˆç¤¾åŒºè§„åˆ™ã€‚');
                        }
                    });
                    alert('åšå®¢å°ç¦æˆåŠŸï¼');
                    closeReportModal();
                    loadReports();
                } else {
                    alert(data.message || 'æ“ä½œå¤±è´¥');
                }
            });
        }

        // ä»è¯¦æƒ…å¼¹çª—é©³å›ä¸¾æŠ¥
        function rejectReportFromDetail(reportId, userId) {
            const reason = prompt('è¯·è¾“å…¥é©³å›ç†ç”±ï¼ˆå¯é€‰ï¼‰ï¼š');
            fetch('/petblog/api/reports/reject', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ report_id: reportId, user_id: userId, reason })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    // é€šçŸ¥å·²é€šè¿‡åç«¯APIè‡ªåŠ¨å‘é€
                    alert('ä¸¾æŠ¥é©³å›æˆåŠŸï¼');
                    closeReportModal();
                    loadReports();
                } else {
                    alert(data.message || 'æ“ä½œå¤±è´¥');
                }
            });
        }

        function banUser(userId, reportId) {
            if (!confirm('ç¡®å®šè¦å°ç¦è¯¥ç”¨æˆ·å—ï¼Ÿ')) return;
            fetch('/petblog/api/reports/banUser', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: userId, report_id: reportId })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    alert('ç”¨æˆ·å°ç¦æˆåŠŸï¼è¯¥ç”¨æˆ·çš„æ‰€æœ‰åšå®¢å°†ä¸å†æ˜¾ç¤ºã€‚');
                    // å‘é€é€šçŸ¥ç»™è¢«å°ç¦çš„ç”¨æˆ·
                    sendUserNotification(userId, 'error', 'æ‚¨çš„è´¦æˆ·å› è¿åç¤¾åŒºè§„å®šå·²è¢«å°ç¦ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚');
                    loadReports();
                } else {
                    alert(data.error || data.message || 'æ“ä½œå¤±è´¥');
                }
            }).catch(error => {
                console.error('å°ç¦ç”¨æˆ·å¤±è´¥:', error);
                alert('å°ç¦ç”¨æˆ·å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            });
        }
        function banBlog(blogId, reportId) {
            if (!confirm('ç¡®å®šè¦å°ç¦è¯¥åšå®¢å—ï¼Ÿ')) return;
            fetch('/petblog/api/reports/banBlog', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ blog_id: blogId, report_id: reportId })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    alert('åšå®¢å°ç¦æˆåŠŸï¼è¯¥åšå®¢å°†ä¸å†æ˜¾ç¤ºã€‚');
                    // è·å–åšå®¢ä½œè€…IDå¹¶å‘é€é€šçŸ¥
                    getBlogAuthorId(blogId).then(authorId => {
                        if (authorId) {
                            sendUserNotification(authorId, 'warning', 'æ‚¨å‘å¸ƒçš„åšå®¢å› è¿åç¤¾åŒºè§„å®šå·²è¢«å°ç¦ã€‚è¯·éµå®ˆç¤¾åŒºè§„åˆ™ã€‚');
                        }
                    });
                    loadReports();
                } else {
                    alert(data.error || data.message || 'æ“ä½œå¤±è´¥');
                }
            }).catch(error => {
                console.error('å°ç¦åšå®¢å¤±è´¥:', error);
                alert('å°ç¦åšå®¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            });
        }
        function rejectReport(reportId, userId) {
            const reason = prompt('è¯·è¾“å…¥é©³å›ç†ç”±ï¼ˆå¯é€‰ï¼‰ï¼š');
            if (reason === null) {
                return; // ç”¨æˆ·å–æ¶ˆäº†è¾“å…¥
            }
            fetch('/petblog/api/reports/reject', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ report_id: reportId, user_id: userId, reason: reason || 'ç†ç”±ä¸å……åˆ†' })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    alert('ä¸¾æŠ¥é©³å›æˆåŠŸï¼è¯¥ä¸¾æŠ¥å·²ç§»è‡³å·²å¤„ç†åˆ—è¡¨ã€‚');
                    loadReports();
                } else {
                    alert(data.error || data.message || 'æ“ä½œå¤±è´¥');
                }
            }).catch(error => {
                console.error('é©³å›ä¸¾æŠ¥å¤±è´¥:', error);
                alert('é©³å›ä¸¾æŠ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            });
        }

        // è·å–åšå®¢ä½œè€…ID
        async function getBlogAuthorId(blogId) {
            try {
                const response = await fetch(`/petblog/api/blogs/${blogId}`);
                const result = await response.json();
                if (result.success && result.blog) {
                    return result.blog.user_id;
                }
            } catch (error) {
                console.error('è·å–åšå®¢ä½œè€…IDå¤±è´¥:', error);
            }
            return null;
        }

        // å‘é€ç”¨æˆ·é€šçŸ¥
        async function sendUserNotification(userId, type, content) {
            try {
                await fetch('/api/notifications/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        inform_type: type,
                        inform_content: content
                    })
                });
            } catch (error) {
                console.error('å‘é€é€šçŸ¥å¤±è´¥:', error);
            }
        }

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('reportDetailModal');
            if (event.target === modal) {
                closeReportModal();
            }
        }

        // ==================== é¡µé¢åˆ‡æ¢åŠŸèƒ½ ====================
        function showSection(section) {
            // å…³é—­æ‰€æœ‰å¼¹çª—
            closeUserHistoryModal();
            closeBlogDetailModal();
            closeTipsModal();
            
            // éšè—æ‰€æœ‰éƒ¨åˆ†
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = 'none';
            });
            
            // ç§»é™¤æ‰€æœ‰å¯¼èˆªçš„activeç±»
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            
            // åˆ‡æ¢å¸ƒå±€ï¼šä¸¾æŠ¥ç®¡ç†ç•Œé¢ä¸å†éœ€è¦å³ä¾§æ 
            const mainContent = document.getElementById('main-content');
            if (section === 'reports') {
                mainContent.classList.add('reports-layout');
            } else {
                mainContent.classList.remove('reports-layout');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„éƒ¨åˆ†
            const sectionEl = document.getElementById(section + '-section');
            if (sectionEl) {
                sectionEl.style.display = 'block';
            }
            
            // æ¿€æ´»å¯¹åº”çš„å¯¼èˆª
            const navEl = document.getElementById('nav-' + section);
            if (navEl) {
                navEl.classList.add('active');
            }
            
            // åŠ è½½å¯¹åº”éƒ¨åˆ†çš„æ•°æ®
            loadSectionData(section);
        }
        
        function loadSectionData(section) {
            switch(section) {
                case 'reports':
                    loadReports();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'blogs':
                    loadBlogs();
                    break;
                case 'replies':
                    loadReplies();
                    break;
                case 'consultations':
                    loadConsultations();
                    break;
                case 'votes':
                    loadVoteStats();
                    loadWinners();
                    break;
                case 'recommendations':
                    loadRecommendedBlogs();
                    loadHotTopics();
                    loadTopAuthors();
                    break;
                case 'analytics':
                    loadPlatformStats();
                    loadBlogTrend();
                    loadUserGrowth();
                    loadSymptomStats();
                    break;
            }
        }
        
        // ==================== ç”¨æˆ·ç®¡ç†åŠŸèƒ½ ====================
        let currentPage = { users: 1, blogs: 1, replies: 1, consultations: 1 };
        const pageSize = 10;
        
        async function loadUsers(page = 1) {
            currentPage.users = page;
            const keyword = document.getElementById('user-search')?.value || '';
            const url = keyword 
                ? `/petblog/api/admin/users?pageNum=${page}&pageSize=${pageSize}&keyword=${encodeURIComponent(keyword)}`
                : `/petblog/api/admin/users?pageNum=${page}&pageSize=${pageSize}`;
            
            try {
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success && result.data) {
                    const users = result.data.users || [];
                    const total = result.data.total || 0;
                    renderUsersTable(users);
                    renderPagination('users-pagination', page, Math.ceil(total / pageSize), loadUsers);
                } else {
                    document.getElementById('users-tbody').innerHTML = '<tr><td colspan="8" class="list-placeholder">åŠ è½½å¤±è´¥</td></tr>';
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥:', error);
                document.getElementById('users-tbody').innerHTML = '<tr><td colspan="8" class="list-placeholder">åŠ è½½å¤±è´¥</td></tr>';
            }
        }
        
        function renderUsersTable(users) {
            const tbody = document.getElementById('users-tbody');
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="list-placeholder">æš‚æ— ç”¨æˆ·</td></tr>';
                return;
            }
            
            tbody.innerHTML = users.map(user => {
                const status = user.isBan === 1 ? '<span style="background:#f8d7da;color:#721c24;padding:4px 8px;border-radius:4px;font-size:12px;">å·²å°ç¦</span>' : 
                              '<span style="background:#d4edda;color:#155724;padding:4px 8px;border-radius:4px;font-size:12px;">æ­£å¸¸</span>';
                
                // ç­‰çº§ä¿¡æ¯
                const level = user.level || 1;
                const levelName = user.levelName || 'å°å¥¶æ±ª';
                const levelIcon = user.levelIcon || 'ğŸ¶';
                const xp = user.xp || 0;
                const nextLevelXp = user.nextLevelXp;
                
                // ç­‰çº§æ˜¾ç¤º - æ”¹è¿›å›¾æ ‡æ ·å¼
                const levelColors = {
                    1: '#FFB6C1', 2: '#FFD700', 3: '#87CEEB', 4: '#98FB98', 5: '#DDA0DD',
                    6: '#F0E68C', 7: '#FFA07A', 8: '#FF6347', 9: '#9370DB', 10: '#FFD700'
                };
                const levelBgColor = levelColors[level] || '#E0E0E0';
                const levelDisplay = `
                    <div style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; background: linear-gradient(135deg, ${levelBgColor}15, ${levelBgColor}25); border-radius: 12px; border: 2px solid ${levelBgColor}40;">
                        <span style="font-size: 24px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">${levelIcon}</span>
                        <div>
                            <div style="font-weight: 700; color: var(--primary-color); font-size: 13px; line-height: 1.2;">${levelName}</div>
                            <div style="font-size: 10px; color: #888; font-weight: 500;">Lv.${level}</div>
                        </div>
                    </div>
                `;
                
                // æ´»è·ƒåº¦æ˜¾ç¤ºï¼ˆXPè¿›åº¦ï¼‰
                let xpDisplay = `<div style="font-size: 12px; color: #666;">${xp} XP</div>`;
                if (nextLevelXp && nextLevelXp > 0) {
                    const currentLevelXp = user.currentLevelXp || 0;
                    const progress = Math.min(100, ((xp - currentLevelXp) / (nextLevelXp - currentLevelXp)) * 100);
                    xpDisplay = `
                        <div style="font-size: 12px; color: #666; margin-bottom: 4px;">${xp} / ${nextLevelXp} XP</div>
                        <div style="width: 100px; height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden;">
                            <div style="width: ${progress}%; height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--accent-color)); transition: width 0.3s;"></div>
                        </div>
                    `;
                }
                
                return `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${user.userId}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${user.userName}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${levelDisplay}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${xpDisplay}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${user.email || '-'}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${formatDate(user.registrationDate)}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${status}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">
                            <button onclick="viewUserHistory(${user.userId})" style="padding: 6px 12px; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">æŸ¥çœ‹å†å²</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function searchUsers() {
            loadUsers(1);
        }
        
        async function viewUserHistory(userId) {
            // æ£€æŸ¥æ˜¯å¦åœ¨ç”¨æˆ·ç®¡ç†ç•Œé¢
            const usersSection = document.getElementById('users-section');
            if (!usersSection || usersSection.style.display === 'none') {
                alert('è¯·åœ¨ç”¨æˆ·ç®¡ç†ç•Œé¢æŸ¥çœ‹ç”¨æˆ·å†å²');
                return;
            }
            
            const userHistoryModal = document.getElementById('userHistoryModal');
            const userHistoryContent = document.getElementById('userHistoryContent');
            
            if (!userHistoryModal || !userHistoryContent) {
                alert('å¼¹çª—å…ƒç´ æœªæ‰¾åˆ°ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                return;
            }
            
            try {
                userHistoryContent.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">åŠ è½½ä¸­...</div>';
                userHistoryModal.classList.add('active');
                
                const response = await fetch(`/petblog/api/admin/users/${userId}/history`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                if (result.success && result.data) {
                    const data = result.data;
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
                    if (data.error) {
                        userHistoryContent.innerHTML = 
                            `<div style="text-align: center; color: #e74c3c; padding: 40px;">${data.error}</div>`;
                        return;
                    }
                    
                    const user = data.user;
                    if (!user) {
                        userHistoryContent.innerHTML = 
                            '<div style="text-align: center; color: #e74c3c; padding: 40px;">ç”¨æˆ·ä¸å­˜åœ¨</div>';
                        return;
                    }
                    
                    const blogs = data.blogs || [];
                    const consultations = data.consultations || [];
                    const replies = data.replies || [];
                    
                    let content = `
                        <div style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); border-radius: 16px; box-shadow: 0 4px 15px rgba(74, 155, 142, 0.3);">
                            <div style="font-size: 20px; font-weight: 700; color: #ffffff; margin-bottom: 12px; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">ğŸ‘¤ ${user.userName || 'ç”¨æˆ·' + userId}</div>
                            <div style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 6px;">ğŸ“§ é‚®ç®±: ${user.email || 'æœªè®¾ç½®'}</div>
                            <div style="color: rgba(255,255,255,0.9); font-size: 14px;">ğŸ“… æ³¨å†Œæ—¶é—´: ${formatDate(user.registrationDate)}</div>
                        </div>
                        
                        <div style="margin-bottom: 24px;">
                            <div style="font-weight: 700; color: var(--primary-color); margin-bottom: 12px; font-size: 18px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color);">ğŸ“ å‘å¸ƒçš„åšå®¢ (${blogs.length})</div>
                            ${blogs.length > 0 ? blogs.map(blog => `
                                <div class="history-item">
                                    <div class="history-item-title">${blog.blogTitle || 'æ— æ ‡é¢˜'}</div>
                                    <div class="history-item-content">
                                        ${(blog.blogContent || '').substring(0, 100)}${blog.blogContent && blog.blogContent.length > 100 ? '...' : ''}
                                    </div>
                                    <div style="margin-top: 8px; font-size: 12px; color: #999;">${formatDate(blog.blogCreateTime)}</div>
                                </div>
                            `).join('') : '<div style="color: #999; padding: 10px;">æš‚æ— åšå®¢</div>'}
                        </div>
                        
                        <div style="margin-bottom: 24px;">
                            <div style="font-weight: 700; color: var(--primary-color); margin-bottom: 12px; font-size: 18px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color);">ğŸ¥ é—®è¯Šè®°å½• (${consultations.length})</div>
                            ${consultations.length > 0 ? consultations.map(consultation => `
                                <div class="history-item">
                                    <div class="history-item-title">ç—‡çŠ¶: ${consultation.selectedSymptoms || 'æœªè®°å½•'}</div>
                                    <div class="history-item-content">
                                        è¯Šæ–­ç–¾ç—…ID: ${consultation.resultDiseaseId || 'æœªè¯Šæ–­'}<br>
                                        ç½®ä¿¡åº¦: ${consultation.probability ? (consultation.probability * 100).toFixed(1) + '%' : 'æœªè®¡ç®—'}
                                    </div>
                                    <div style="margin-top: 8px; font-size: 12px; color: #999;">${formatDate(consultation.createdAt)}</div>
                                </div>
                            `).join('') : '<div style="color: #999; padding: 10px;">æš‚æ— é—®è¯Šè®°å½•</div>'}
                        </div>
                        
                        <div>
                            <div style="font-weight: 700; color: var(--primary-color); margin-bottom: 12px; font-size: 18px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color);">ğŸ’¬ è¯„è®ºè®°å½• (${replies.length})</div>
                            ${replies.length > 0 ? replies.map(reply => `
                                <div class="history-item">
                                    <div class="history-item-content">
                                        ${reply.replyContent || 'æ— å†…å®¹'}
                                    </div>
                                    <div style="margin-top: 8px; font-size: 12px; color: #999;">
                                        åšå®¢ID: ${reply.blogId} | ${formatDate(reply.replyCreatedtime)}
                                    </div>
                                </div>
                            `).join('') : '<div style="color: #999; padding: 10px;">æš‚æ— è¯„è®º</div>'}
                        </div>
                    `;
                    
                    if (userHistoryContent) {
                        userHistoryContent.innerHTML = content;
                    }
                } else {
                    if (userHistoryContent) {
                        userHistoryContent.innerHTML = 
                            `<div style="text-align: center; color: #e74c3c; padding: 40px;">åŠ è½½å¤±è´¥ï¼š${result.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·å†å²å¤±è´¥:', error);
                if (userHistoryContent) {
                    userHistoryContent.innerHTML = 
                        `<div style="text-align: center; color: #e74c3c; padding: 40px;">åŠ è½½å¤±è´¥ï¼š${error.message || 'ç½‘ç»œé”™è¯¯'}</div>`;
                }
            }
        }
        
        function closeUserHistoryModal() {
            document.getElementById('userHistoryModal').classList.remove('active');
        }
        
        
        // ==================== åšå®¢ç®¡ç†åŠŸèƒ½ ====================
        async function loadBlogs(page = 1) {
            currentPage.blogs = page;
            try {
                const response = await fetch(`/petblog/api/admin/blogs?pageNum=${page}&pageSize=${pageSize}`);
                const result = await response.json();
                if (result.success && result.data) {
                    const blogs = result.data.blogs || [];
                    const total = result.data.total || 0;
                    renderBlogsTable(blogs);
                    renderPagination('blogs-pagination', page, Math.ceil(total / pageSize), loadBlogs);
                } else {
                    document.getElementById('blogs-tbody').innerHTML = '<tr><td colspan="9" class="list-placeholder">åŠ è½½å¤±è´¥</td></tr>';
                }
            } catch (error) {
                console.error('åŠ è½½åšå®¢å¤±è´¥:', error);
                document.getElementById('blogs-tbody').innerHTML = '<tr><td colspan="9" class="list-placeholder">åŠ è½½å¤±è´¥</td></tr>';
            }
        }
        
        function renderBlogsTable(blogs) {
            const tbody = document.getElementById('blogs-tbody');
            if (blogs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="list-placeholder">æš‚æ— åšå®¢</td></tr>';
                return;
            }
            
            tbody.innerHTML = blogs.map(blog => {
                const status = blog.isShielded === 1 
                    ? '<span style="background:#f8d7da;color:#721c24;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600;">ğŸš« å·²è¢«å°ç¦</span>' 
                    : '<span style="background:#d4edda;color:#155724;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600;">âœ“ æ­£å¸¸</span>';
                
                const title = blog.blogTitle || 'æ— æ ‡é¢˜';
                const shortTitle = title.length > 40 ? title.substring(0, 40) + '...' : title;
                
                return `
                    <tr style="${blog.isShielded === 1 ? 'opacity: 0.7; background: #f8f9fa;' : ''}">
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${blog.blogId}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color); white-space: normal; max-width: 200px;" title="${title}">${shortTitle}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${blog.userName || blog.userId}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${formatDate(blog.blogCreateTime)}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${blog.likeCount || 0}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${blog.commentCount || 0}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${blog.favoriteCount || 0}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${status}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">
                            <button onclick="viewBlogDetail(${blog.blogId})" 
                                    style="padding: 6px 12px; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer; margin-right: 5px; font-size: 12px;">
                                ğŸ“– æŸ¥çœ‹è¯¦æƒ…
                            </button>
                            <button onclick="toggleBlogStatus(${blog.blogId}, ${blog.isShielded === 1 ? 0 : 1})" 
                                    style="padding: 6px 12px; background: ${blog.isShielded === 1 ? '#27ae60' : '#e74c3c'}; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                ${blog.isShielded === 1 ? 'âœ“ è§£å°' : 'ğŸš« å°ç¦'}
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // æŸ¥çœ‹åšå®¢è¯¦æƒ…
        async function viewBlogDetail(blogId) {
            // æ£€æŸ¥æ˜¯å¦åœ¨åšå®¢ç®¡ç†ç•Œé¢
            const blogsSection = document.getElementById('blogs-section');
            if (!blogsSection || blogsSection.style.display === 'none') {
                alert('è¯·åœ¨åšå®¢ç®¡ç†ç•Œé¢æŸ¥çœ‹åšå®¢è¯¦æƒ…');
                return;
            }
            
            const blogDetailModal = document.getElementById('blogDetailModal');
            const blogDetailContent = document.getElementById('blogDetailContent');
            
            if (!blogDetailModal || !blogDetailContent) {
                alert('å¼¹çª—å…ƒç´ æœªæ‰¾åˆ°ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                return;
            }
            
            try {
                blogDetailContent.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">åŠ è½½ä¸­...</div>';
                blogDetailModal.classList.add('active');
                
                // ç›´æ¥æŸ¥è¯¢æ•°æ®åº“è·å–åšå®¢è¯¦æƒ…ï¼ˆåŒ…æ‹¬å·²å°ç¦çš„ï¼‰
                const response = await fetch(`/petblog/api/admin/blogs/${blogId}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    const blog = result.data;
                    
                    let content = `
                        <div style="margin-bottom: 24px;">
                            <div style="font-size: 26px; font-weight: 700; color: var(--primary-color); margin-bottom: 18px; line-height: 1.4; padding-bottom: 12px; border-bottom: 3px solid var(--primary-color);">
                                ${blog.blogTitle || 'æ— æ ‡é¢˜'}
                            </div>
                            <div class="blog-detail-meta">
                                <span>ğŸ‘¤ ä½œè€…: ${blog.userName || blog.userId}</span>
                                <span>ğŸ“… å‘å¸ƒæ—¶é—´: ${formatDate(blog.blogCreateTime)}</span>
                                <span>ğŸ‘ ç‚¹èµ: ${blog.likeCount || 0}</span>
                                <span>ğŸ’¬ è¯„è®º: ${blog.commentCount || 0}</span>
                                <span>â­ æ”¶è—: ${blog.favoriteCount || 0}</span>
                                <span style="color: ${blog.isShielded === 1 ? '#e74c3c' : '#27ae60'}; font-weight: 600; background: ${blog.isShielded === 1 ? 'rgba(231, 76, 60, 0.1)' : 'rgba(39, 174, 96, 0.1)'} !important;">
                                    ${blog.isShielded === 1 ? 'ğŸš« å·²è¢«å°ç¦' : 'âœ“ æ­£å¸¸'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="blog-detail-content">
                            ${(blog.blogContent || '').replace(/\n/g, '<br>')}
                        </div>
                    `;
                    
                    if (blogDetailContent) {
                        blogDetailContent.innerHTML = content;
                    }
                } else {
                    if (blogDetailContent) {
                        blogDetailContent.innerHTML = 
                            `<div style="text-align: center; color: #e74c3c; padding: 40px;">åŠ è½½å¤±è´¥ï¼š${result.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½åšå®¢è¯¦æƒ…å¤±è´¥:', error);
                if (blogDetailContent) {
                    blogDetailContent.innerHTML = 
                        `<div style="text-align: center; color: #e74c3c; padding: 40px;">åŠ è½½å¤±è´¥ï¼š${error.message || 'ç½‘ç»œé”™è¯¯'}</div>`;
                }
            }
        }
        
        function closeBlogDetailModal() {
            document.getElementById('blogDetailModal').classList.remove('active');
        }
        
        // ==================== å®¡æ ¸å°è´´å£«å¼¹çª— ====================
        function showTipsModal() {
            const tipsModal = document.getElementById('tipsModal');
            if (tipsModal) {
                tipsModal.classList.add('active');
            }
        }
        
        function closeTipsModal() {
            const tipsModal = document.getElementById('tipsModal');
            if (tipsModal) tipsModal.classList.remove('active');
        }
        
        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        document.getElementById('userHistoryModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeUserHistoryModal();
            }
        });
        
        document.getElementById('blogDetailModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeBlogDetailModal();
            }
        });
        
        document.getElementById('tipsModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeTipsModal();
            }
        });
        
        async function toggleBlogStatus(blogId, status) {
            if (!confirm(`ç¡®å®šè¦${status === 1 ? 'å°ç¦' : 'è§£å°'}è¯¥åšå®¢å—ï¼Ÿ`)) return;
            try {
                const response = await fetch('/petblog/api/admin/blogs/update-status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ blogId: blogId, status: status })
                });
                const result = await response.json();
                if (result.success) {
                    alert('æ“ä½œæˆåŠŸ');
                    loadBlogs(currentPage.blogs);
                } else {
                    alert('æ“ä½œå¤±è´¥');
                }
            } catch (error) {
                console.error('æ›´æ–°åšå®¢çŠ¶æ€å¤±è´¥:', error);
                alert('æ“ä½œå¤±è´¥');
            }
        }
        
        // ==================== è¯„è®ºç®¡ç†åŠŸèƒ½ ====================
        async function loadReplies(page = 1) {
            currentPage.replies = page;
            try {
                const response = await fetch(`/petblog/api/admin/replies?pageNum=${page}&pageSize=${pageSize}`);
                const result = await response.json();
                if (result.success && result.data) {
                    const replies = result.data.replies || [];
                    const total = result.data.total || 0;
                    renderRepliesTable(replies);
                    renderPagination('replies-pagination', page, Math.ceil(total / pageSize), loadReplies);
                } else {
                    document.getElementById('replies-tbody').innerHTML = '<tr><td colspan="6" class="list-placeholder">åŠ è½½å¤±è´¥</td></tr>';
                }
            } catch (error) {
                console.error('åŠ è½½è¯„è®ºå¤±è´¥:', error);
                document.getElementById('replies-tbody').innerHTML = '<tr><td colspan="6" class="list-placeholder">åŠ è½½å¤±è´¥</td></tr>';
            }
        }
        
        function renderRepliesTable(replies) {
            const tbody = document.getElementById('replies-tbody');
            if (replies.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="list-placeholder">æš‚æ— è¯„è®º</td></tr>';
                return;
            }
            
            tbody.innerHTML = replies.map(reply => {
                const status = reply.isVisible === 1 
                    ? '<span style="background:#d4edda;color:#155724;padding:4px 8px;border-radius:4px;font-size:12px;">å¯è§</span>' 
                    : '<span style="background:#f8d7da;color:#721c24;padding:4px 8px;border-radius:4px;font-size:12px;">å·²éšè—</span>';
                
                const content = reply.replyContent || '-';
                const shortContent = content.length > 30 ? content.substring(0, 30) + '...' : content;
                
                return `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${reply.replyId}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);" title="${content}">${shortContent}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${reply.userId}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${reply.blogId}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${status}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">
                            <button onclick="toggleReplyStatus(${reply.replyId}, ${reply.isVisible === 1 ? 0 : 1})" 
                                    style="padding: 6px 12px; background: ${reply.isVisible === 1 ? '#e74c3c' : '#27ae60'}; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                ${reply.isVisible === 1 ? 'éšè—' : 'æ˜¾ç¤º'}
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        async function toggleReplyStatus(replyId, status) {
            try {
                const response = await fetch('/petblog/api/admin/replies/update-status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ replyId: replyId, status: status })
                });
                const result = await response.json();
                if (result.success) {
                    alert('æ“ä½œæˆåŠŸ');
                    loadReplies(currentPage.replies);
                } else {
                    alert('æ“ä½œå¤±è´¥');
                }
            } catch (error) {
                console.error('æ›´æ–°è¯„è®ºçŠ¶æ€å¤±è´¥:', error);
                alert('æ“ä½œå¤±è´¥');
            }
        }
        
        // ==================== é—®è¯Šç®¡ç†åŠŸèƒ½ ====================
        async function loadConsultations(page = 1) {
            currentPage.consultations = page;
            try {
                const response = await fetch(`/petblog/api/admin/consultations?pageNum=${page}&pageSize=${pageSize}`);
                const result = await response.json();
                if (result.success && result.data) {
                    const consultations = result.data.consultations || [];
                    const total = result.data.total || 0;
                    renderConsultationsTable(consultations);
                    renderPagination('consultations-pagination', page, Math.ceil(total / pageSize), loadConsultations);
                } else {
                    document.getElementById('consultations-tbody').innerHTML = '<tr><td colspan="6" class="list-placeholder">åŠ è½½å¤±è´¥</td></tr>';
                }
            } catch (error) {
                console.error('åŠ è½½é—®è¯Šè®°å½•å¤±è´¥:', error);
                document.getElementById('consultations-tbody').innerHTML = '<tr><td colspan="6" class="list-placeholder">åŠ è½½å¤±è´¥</td></tr>';
            }
        }
        
        function renderConsultationsTable(consultations) {
            const tbody = document.getElementById('consultations-tbody');
            if (consultations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="list-placeholder">æš‚æ— é—®è¯Šè®°å½•</td></tr>';
                return;
            }
            
            tbody.innerHTML = consultations.map(consultation => {
                return `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${consultation.id}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${consultation.userId}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${(consultation.selectedSymptoms || '-').substring(0, 30)}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${consultation.resultDiseaseId || '-'}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${consultation.probability ? (consultation.probability * 100).toFixed(1) + '%' : '-'}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">${formatDate(consultation.createdAt)}</td>
                    </tr>
                `;
            }).join('');
        }
        
        // ==================== æŠ•ç¥¨ç®¡ç†åŠŸèƒ½ ====================
        async function loadVoteStats() {
            try {
                const response = await fetch('/petblog/api/admin/votes/stats');
                const result = await response.json();
                if (result.success && result.data) {
                    document.getElementById('vote-stats-container').innerHTML = `<p style="padding: 10px;">æ€»æŠ•ç¥¨æ•°: ${result.data.totalVotes || 0}</p>`;
                }
            } catch (error) {
                console.error('åŠ è½½æŠ•ç¥¨ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        async function loadWinners() {
            try {
                const response = await fetch('/petblog/api/admin/votes/winners?limit=10');
                const result = await response.json();
                if (result.success && result.data) {
                    const container = document.getElementById('winners-container');
                    if (result.data.length === 0) {
                        container.innerHTML = '<div class="list-placeholder">æš‚æ— æŠ•ç¥¨æ•°æ®</div>';
                    } else {
                        container.innerHTML = result.data.map((item, index) => `
                            <div style="padding: 12px; margin-bottom: 8px; background: var(--background-color); border-radius: 8px;">
                                <strong>#${index + 1}</strong> ${item.blogTitle || 'åšå®¢ID: ' + item.blogId} 
                                <span style="float: right;">æŠ•ç¥¨æ•°: ${item.voteCount || 0}</span>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è·èƒœç‹—ç‹—å¤±è´¥:', error);
            }
        }
        
        // ==================== å·¥å…·å‡½æ•° ====================
        function renderPagination(containerId, currentPage, totalPages, callback) {
            const container = document.getElementById(containerId);
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            if (currentPage > 1) {
                html += `<button onclick="${callback.name}(${currentPage - 1})" style="padding: 6px 12px; margin: 0 3px; border: 1px solid var(--border-color); background: white; border-radius: 6px; cursor: pointer;">ä¸Šä¸€é¡µ</button>`;
            }
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<button style="padding: 6px 12px; margin: 0 3px; border: 1px solid var(--primary-color); background: var(--primary-color); color: white; border-radius: 6px; cursor: pointer;">${i}</button>`;
                } else if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `<button onclick="${callback.name}(${i})" style="padding: 6px 12px; margin: 0 3px; border: 1px solid var(--border-color); background: white; border-radius: 6px; cursor: pointer;">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += `<button disabled style="padding: 6px 12px; margin: 0 3px; border: none; background: transparent;">...</button>`;
                }
            }
            
            if (currentPage < totalPages) {
                html += `<button onclick="${callback.name}(${currentPage + 1})" style="padding: 6px 12px; margin: 0 3px; border: 1px solid var(--border-color); background: white; border-radius: 6px; cursor: pointer;">ä¸‹ä¸€é¡µ</button>`;
            }
            
            container.innerHTML = html;
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const date = new Date(dateStr);
                return date.toLocaleString('zh-CN');
            } catch (e) {
                return dateStr;
            }
        }

        // ==================== å†…å®¹æ¨èç®¡ç†åŠŸèƒ½ ====================
        let blogTrendChart = null;
        let userGrowthChart = null;
        let symptomChart = null;
        
        async function loadRecommendedBlogs() {
            const rule = document.getElementById('recommend-rule').value;
            try {
                const response = await fetch(`/petblog/api/admin/recommendations/blogs?rule=${rule}&limit=20`);
                const result = await response.json();
                if (result.success && result.data) {
                    const blogs = result.data.blogs || [];
                    const container = document.getElementById('recommended-blogs-container');
                    if (blogs.length === 0) {
                        container.innerHTML = '<div class="list-placeholder">æš‚æ— æ¨èåšå®¢</div>';
                        return;
                    }
                    container.innerHTML = blogs.map(blog => `
                        <div style="padding: 15px; border-bottom: 1px solid var(--border-color);">
                            <div style="font-weight: 600; color: var(--primary-color); margin-bottom: 8px;">${blog.blogTitle || 'æ— æ ‡é¢˜'}</div>
                            <div style="color: #666; font-size: 14px; margin-bottom: 8px;">ä½œè€…: ${blog.userName || blog.userId}</div>
                            <div style="display: flex; gap: 15px; font-size: 13px; color: #999;">
                                <span>ğŸ‘ ${blog.likeCount || 0}</span>
                                <span>ğŸ’¬ ${blog.commentCount || 0}</span>
                                <span>â­ ${blog.favoriteCount || 0}</span>
                                ${blog.weight ? `<span>æƒé‡: ${blog.weight}</span>` : ''}
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('recommended-blogs-container').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥</div>';
                }
            } catch (error) {
                console.error('åŠ è½½æ¨èåšå®¢å¤±è´¥:', error);
                document.getElementById('recommended-blogs-container').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥</div>';
            }
        }
        
        async function loadHotTopics() {
            try {
                const response = await fetch('/petblog/api/admin/recommendations/topics?limit=10');
                const result = await response.json();
                if (result.success && result.data) {
                    const topics = result.data || [];
                    const container = document.getElementById('hot-topics-container');
                    if (topics.length === 0) {
                        container.innerHTML = '<div class="list-placeholder">æš‚æ— çƒ­é—¨è¯é¢˜</div>';
                        return;
                    }
                    container.innerHTML = topics.map(topic => `
                        <div style="padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--primary-color);">${topic.topicName}</div>
                                <div style="color: #666; font-size: 14px; margin-top: 5px;">${topic.blogCount || 0} ç¯‡åšå®¢</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('hot-topics-container').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥</div>';
                }
            } catch (error) {
                console.error('åŠ è½½çƒ­é—¨è¯é¢˜å¤±è´¥:', error);
                document.getElementById('hot-topics-container').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥</div>';
            }
        }
        
        async function loadTopAuthors() {
            try {
                const response = await fetch('/petblog/api/admin/recommendations/authors?limit=10');
                const result = await response.json();
                if (result.success && result.data) {
                    const authors = result.data || [];
                    const container = document.getElementById('top-authors-container');
                    if (authors.length === 0) {
                        container.innerHTML = '<div class="list-placeholder">æš‚æ— ä¼˜è´¨ä½œè€…</div>';
                        return;
                    }
                    container.innerHTML = authors.map(author => `
                        <div style="padding: 15px; border-bottom: 1px solid var(--border-color);">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 50px; height: 50px; border-radius: 50%; background: var(--primary-color); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                    ${author.userName ? author.userName.charAt(0) : '?'}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--primary-color);">${author.userName || author.userId}</div>
                                    <div style="color: #666; font-size: 14px; margin-top: 5px;">
                                        åšå®¢: ${author.blogCount || 0} | 
                                        ç‚¹èµ: ${author.totalLikes || 0} | 
                                        è¯„è®º: ${author.totalComments || 0}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('top-authors-container').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥</div>';
                }
            } catch (error) {
                console.error('åŠ è½½ä¼˜è´¨ä½œè€…å¤±è´¥:', error);
                document.getElementById('top-authors-container').innerHTML = '<div class="list-placeholder">åŠ è½½å¤±è´¥</div>';
            }
        }
        
        // ==================== æ•°æ®å¯è§†åŒ–åŠŸèƒ½ ====================
        async function loadPlatformStats() {
            try {
                const response = await fetch('/petblog/api/admin/analytics/platform-stats');
                const result = await response.json();
                if (result.success && result.data) {
                    const stats = result.data;
                    document.getElementById('stat-total-users').textContent = stats.totalUsers || 0;
                    document.getElementById('stat-total-blogs').textContent = stats.totalBlogs || 0;
                    document.getElementById('stat-today-users').textContent = stats.todayUsers || 0;
                    document.getElementById('stat-active-users').textContent = stats.activeUsers || 0;
                }
            } catch (error) {
                console.error('åŠ è½½å¹³å°ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        async function loadBlogTrend() {
            const days = document.getElementById('blog-trend-days').value;
            const canvas = document.getElementById('blog-trend-chart');
            if (!canvas) {
                console.error('åšå®¢è¶‹åŠ¿å›¾è¡¨canvaså…ƒç´ æœªæ‰¾åˆ°');
                return;
            }
            
            try {
                const response = await fetch(`/petblog/api/admin/analytics/blog-trend?days=${days}`);
                const result = await response.json();
                console.log('åšå®¢è¶‹åŠ¿æ•°æ®:', result);
                
                if (result.success && result.data) {
                    const data = result.data;
                    const dates = data.dates || [];
                    const blogCounts = data.blogCounts || [];
                    const likeCounts = data.likeCounts || [];
                    const commentCounts = data.commentCounts || [];
                    
                    if (dates.length === 0) {
                        canvas.parentElement.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">æš‚æ— æ•°æ®</div>';
                        return;
                    }
                    
                    const ctx = canvas.getContext('2d');
                    
                    if (blogTrendChart) {
                        blogTrendChart.destroy();
                    }
                    
                    blogTrendChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [
                                {
                                    label: 'åšå®¢æ•°',
                                    data: blogCounts,
                                    borderColor: 'rgb(75, 192, 192)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    tension: 0.1,
                                    fill: true
                                },
                                {
                                    label: 'ç‚¹èµæ•°',
                                    data: likeCounts,
                                    borderColor: 'rgb(255, 99, 132)',
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    tension: 0.1,
                                    fill: true
                                },
                                {
                                    label: 'è¯„è®ºæ•°',
                                    data: commentCounts,
                                    borderColor: 'rgb(54, 162, 235)',
                                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                    tension: 0.1,
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'åšå®¢çƒ­åº¦è¶‹åŠ¿'
                                }
                            }
                        }
                    });
                } else {
                    canvas.parentElement.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">åŠ è½½å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                console.error('åŠ è½½åšå®¢è¶‹åŠ¿å¤±è´¥:', error);
                if (canvas && canvas.parentElement) {
                    canvas.parentElement.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
                }
            }
        }
        
        async function loadUserGrowth() {
            const days = document.getElementById('user-growth-days').value;
            const canvas = document.getElementById('user-growth-chart');
            if (!canvas) {
                console.error('ç”¨æˆ·å¢é•¿å›¾è¡¨canvaså…ƒç´ æœªæ‰¾åˆ°');
                return;
            }
            
            try {
                const response = await fetch(`/petblog/api/admin/analytics/user-growth?days=${days}`);
                const result = await response.json();
                console.log('ç”¨æˆ·å¢é•¿æ•°æ®:', result);
                
                if (result.success && result.data) {
                    const data = result.data;
                    const dates = data.dates || [];
                    const userCounts = data.userCounts || [];
                    
                    if (dates.length === 0) {
                        canvas.parentElement.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">æš‚æ— æ•°æ®</div>';
                        return;
                    }
                    
                    const ctx = canvas.getContext('2d');
                    
                    if (userGrowthChart) {
                        userGrowthChart.destroy();
                    }
                    
                    userGrowthChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: 'æ–°å¢ç”¨æˆ·æ•°',
                                data: userCounts,
                                backgroundColor: 'rgba(74, 155, 142, 0.6)',
                                borderColor: 'rgba(74, 155, 142, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'ç”¨æˆ·å¢é•¿è¶‹åŠ¿'
                                }
                            }
                        }
                    });
                } else {
                    canvas.parentElement.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">åŠ è½½å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·å¢é•¿è¶‹åŠ¿å¤±è´¥:', error);
                if (canvas && canvas.parentElement) {
                    canvas.parentElement.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
                }
            }
        }
        
        async function loadSymptomStats() {
            try {
                const response = await fetch('/petblog/api/admin/analytics/symptoms');
                const result = await response.json();
                if (result.success && result.data) {
                    const data = result.data;
                    const ctx = document.getElementById('symptom-chart').getContext('2d');
                    
                    if (symptomChart) {
                        symptomChart.destroy();
                    }
                    
                    symptomChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: data.symptoms || [],
                            datasets: [{
                                label: 'å‡ºç°æ¬¡æ•°',
                                data: data.counts || [],
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.6)',
                                    'rgba(54, 162, 235, 0.6)',
                                    'rgba(255, 206, 86, 0.6)',
                                    'rgba(75, 192, 192, 0.6)',
                                    'rgba(153, 102, 255, 0.6)',
                                    'rgba(255, 159, 64, 0.6)',
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    position: 'right',
                                },
                                title: {
                                    display: true,
                                    text: 'é—®è¯Šç—‡çŠ¶é¢‘ç‡ç»Ÿè®¡'
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('åŠ è½½ç—‡çŠ¶ç»Ÿè®¡å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åŠ è½½ä¸¾æŠ¥åˆ—è¡¨...');
        loadReports();
    </script>

    <!-- ä¸¾æŠ¥è¯¦æƒ…å¼¹çª— -->
    <div id="reportDetailModal" class="report-modal">
        <div class="report-modal-content">
            <div class="report-modal-header">
                <h2 class="report-modal-title">ä¸¾æŠ¥è¯¦æƒ…</h2>
                <span class="report-modal-close" onclick="closeReportModal()">&times;</span>
            </div>
            <div id="reportDetailContent">
                <!-- ä¸¾æŠ¥è¯¦æƒ…å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>
</body>
</html> 