<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å®¡æ ¸å‘˜åå° - Oh my dogï¼</title>
    <style>
        :root {
            --primary-color: #3d8b7e;
            --secondary-color: #5ba898;
            --accent-color: #7bc5b7;
            --background-color: #edf6f5;
            --card-background: #ffffff;
            --border-color: #d4ede9;
            --text-primary: #2a4f49;
            --text-secondary: #3e6b61;
            --blue-accent: #6fa5c3;
            --blue-light: #a8c8da;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('/petblog/images/auditor.png') no-repeat center center fixed;
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            z-index: -1;
            pointer-events: none;
        }
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--blue-accent) 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(74, 155, 142, 0.2);
        }
        .nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 60px;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-decoration: none;
            letter-spacing: 1px;
        }
        .nav-links a {
            margin-left: 24px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            border-radius: 20px;
            padding: 8px 16px;
            transition: background 0.2s, color 0.2s;
        }
        .nav-links a:hover, .nav-links a.active {
            background: rgba(255,255,255,0.12);
            color: #fff;
        }
        .hero-banner {
            width: 100%;
            height: 220px;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }
        .hero-image {
            width: 100%;
            height: 100%;
            position: relative;
        }
        .hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top;
            transform: scale(1.1);
        }
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg,rgba(74,155,142,0.3) 0%,rgba(107,183,168,0.25) 50%,rgba(133,193,184,0.2) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hero-text {
            text-align: center;
            color: white;
            z-index: 2;
            animation: heroFadeIn 1.5s ease-out;
        }
        .hero-title {
            font-size: 2.5rem;
            font-weight: 900;
            margin: 0 0 10px 0;
            letter-spacing: 2px;
            color: #ffffff;
        }
        .hero-subtitle {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 10px 0;
            opacity: 1;
            letter-spacing: 1px;
            color: #ffffff;
        }
        .hero-decorations {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        .paw-print {
            font-size: 1.5rem;
            animation: pawBounce 2s ease-in-out infinite;
        }
        @keyframes heroFadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pawBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            margin-left: 600px;
            padding: 0 20px 40px 0;
            display: flex;
            gap: 30px;
        }
        .content-left {
            flex: 2;
            max-width: 700px;
        }
        .content-right {
            flex: 1;
            max-width: 350px;
        }
        .card {
            background: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(74, 155, 142, 0.1);
            border: 1px solid var(--border-color);
            padding: 28px 24px 18px 24px;
            margin-bottom: 24px;
        }
        .section-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 12px;
            font-weight: 600;
        }
        .logout-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 28px;
            font-size: 1rem;
            cursor: pointer;
            float: right;
            margin-top: -10px;
        }
        .logout-btn:hover { background: #217dbb; }
        .list-placeholder { color: #888; font-size: 1rem; padding: 18px 0; text-align: center; background: #f4f8fb; border-radius: 8px; }
        
        /* ä¸¾æŠ¥è¯¦æƒ…å¼¹çª—æ ·å¼ */
        .report-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .report-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .report-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .report-modal-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        .report-modal-close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .report-modal-close:hover {
            color: var(--primary-color);
        }

        .report-detail-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .report-detail-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .report-detail-content {
            color: var(--text-color);
            line-height: 1.6;
        }

        .report-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .report-action-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-action-btn.ban-user {
            background: #e74c3c;
            color: white;
        }

        .report-action-btn.ban-blog {
            background: #f39c12;
            color: white;
        }

        .report-action-btn.reject {
            background: #95a5a6;
            color: white;
        }

        .report-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* ä¸¾æŠ¥å¡ç‰‡æ‚¬åœæ•ˆæœ */
        .report-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .report-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(74, 155, 142, 0.2) !important;
            border-color: var(--accent-color) !important;
        }

        .report-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(74, 155, 142, 0.05) 0%, rgba(74, 155, 142, 0.02) 100%);
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .report-card:hover::before {
            opacity: 1;
        }

        .report-card:hover::after {
            content: 'ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…';
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, rgba(74, 155, 142, 0.95) 0%, rgba(74, 155, 142, 0.85) 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            opacity: 0;
            animation: fadeInUp 0.3s ease forwards;
            box-shadow: 0 2px 8px rgba(74, 155, 142, 0.3);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å·²å¤„ç†ä¸¾æŠ¥åŒºåŸŸæ ·å¼ */
        #handled-report-list .report-card {
            background: #f8f9fa !important;
            border-left: 4px solid #27ae60 !important;
            opacity: 0.9;
        }

        #handled-report-list .report-card:hover {
            opacity: 1;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.12) !important;
        }

        /* çŠ¶æ€æ ‡ç­¾æ ·å¼ */
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .status-pending {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .status-user-banned {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .status-blog-banned {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .status-rejected {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }
        
        @media (max-width: 900px) {
            .main-content { 
                flex-direction: column; 
                gap: 20px; 
                margin-left: 300px;
            }
            .content-left, .content-right { max-width: 100%; }
        }
        
        @media (max-width: 600px) {
            .main-content { 
                margin-left: 150px; /* æ›´å°å±å¹•æ—¶è¿›ä¸€æ­¥å‡å°‘å³ç§»è·ç¦» */
            }
            .hero-banner {
                /* æ¨ªå¹…æ¢å¤åŸå§‹ä½ç½®ï¼Œä¸è¿›è¡Œå³ç§» */
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="nav">
            <a href="/" class="logo">Oh my dogï¼</a>
            <div class="nav-links">
                <a href="/auditor/dashboard" class="active">å®¡æ ¸é¦–é¡µ</a>
                <a href="/auditor/logout">é€€å‡ºç™»å½•</a>
            </div>
        </div>
    </header>
    <div class="hero-banner">
        <div class="hero-image">
            <img src="/petblog/images/index1.png" alt="OH MY DOG Banner" />
            <div class="hero-overlay">
                <div class="hero-text">
                    <h1 class="hero-title">å®¡æ ¸å‘˜åå°</h1>
                    <p class="hero-subtitle">å®ˆæŠ¤ç¤¾åŒºï¼Œå‘ç°ä¸å¤„ç†ä¸è‰¯å†…å®¹</p>
                    <div class="hero-decorations">
                        <span class="paw-print">ğŸ¾</span>
                        <span class="paw-print">ğŸ¾</span>
                        <span class="paw-print">ğŸ¾</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="content-left">
            <!-- ä¸¾æŠ¥ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="section-title">ä¸¾æŠ¥ç»Ÿè®¡</div>
                <div id="report-stats" style="display: flex; gap: 20px; padding: 15px 0;">
                    <div style="text-align: center; flex: 1;">
                        <div style="font-size: 24px; font-weight: bold; color: #e74c3c;" id="pending-count">0</div>
                        <div style="color: #666; font-size: 14px;">å¾…å¤„ç†</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div style="font-size: 24px; font-weight: bold; color: #27ae60;" id="handled-count">0</div>
                        <div style="color: #666; font-size: 14px;">å·²å¤„ç†</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div style="font-size: 24px; font-weight: bold; color: #3498db;" id="total-count">0</div>
                        <div style="color: #666; font-size: 14px;">æ€»è®¡</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="section-title">å¾…å¤„ç†ä¸¾æŠ¥</div>
                <div id="report-list" class="list-placeholder">æš‚æ— ä¸¾æŠ¥</div>
            </div>
            <div class="card">
                <div class="section-title">å·²å¤„ç†ä¸¾æŠ¥</div>
                <div id="handled-report-list" class="list-placeholder">æš‚æ— å·²å¤„ç†ä¸¾æŠ¥</div>
            </div>
        </div>
        <div class="content-right">
            // ... existing code ...
            <div class="card">
                <div class="section-title">å®¡æ ¸å°è´´å£«</div>
                <ul style="color:#3e6b61;line-height:1.8;font-size:15px;padding-left:18px;">
                    <li><strong>ä¸€ã€è¯æ®æ ¸å®</strong></li>
                    <li>åŒè¯æŸ¥éªŒ</li>
                    <li>åŒæ—¶æŸ¥çœ‹ä¸¾æŠ¥å†…å®¹ + åŸå§‹åšå®¢ï¼Œé¿å…æ–­ç« å–ä¹‰</li>
                    <li>é‡ç‚¹æ£€æŸ¥ï¼šæ•æ„Ÿè¯è§¦å‘ä½ç½®ã€åšå®¢é™„ä»¶æ˜¯å¦å«è¿è§„å…ƒç´ ï¼ˆè¡€è…¥ / è‰²æƒ… / ä¾µæƒï¼‰</li>
                    <li>æ¶‰åŠç‰ˆæƒä¾µæƒï¼šç”¨ç™¾åº¦å›¾ç‰‡åå‘æœç´¢æ ¸å®åŸå›¾æ¥æº</li>
                    <li>æ¶‰åŠå® ç‰©è™å¾…ï¼šè”ç³» "å¥åº·åŒ»ç–—" æ¿å—ç‰ˆä¸»ååŠ©åˆ¤æ–­å†…å®¹çœŸå®æ€§</li>
                    <li style="margin-top:12px;"><strong>äºŒã€æƒé™æ“ä½œ</strong></li>
                    <li>å°ç¦ç”¨æˆ·<br>éœ€æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼š<br>
                        <ul style="margin-top:4px;margin-bottom:4px;">
                            <li>å‘å¸ƒè¿æ³•å†…å®¹</li>
                            <li>æ¶æ„ä¸¾æŠ¥â‰¥5 æ¬¡</li>
                            <li>éªšæ‰°å…¶ä»–ç”¨æˆ·è¶… 3 æ¬¡</li>
                        </ul>
                    </li>
                    <li>é©³å›ä¸¾æŠ¥ <br>å¿…é¡»å¡«å†™é©³å›ç†ç”±ï¼Œè‡ªåŠ¨å‘é€é€šçŸ¥ç»™ä¸¾æŠ¥è€…</li>
                </ul>
            </div>
    </div>
    <script>
    // åŠ è½½ä¸¾æŠ¥ç»Ÿè®¡ä¿¡æ¯
    async function loadReportStats() {
        try {
            const response = await fetch('/api/reports/stats');
            const result = await response.json();
            
            if (result.success) {
                const stats = result.stats;
                document.getElementById('pending-count').textContent = stats.pending;
                document.getElementById('handled-count').textContent = stats.handled;
                document.getElementById('total-count').textContent = stats.total;
            } else {
                console.error('è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', result.message);
                // å¦‚æœç»Ÿè®¡APIå¤±è´¥ï¼Œè®¾ç½®ä¸º0
                document.getElementById('pending-count').textContent = '0';
                document.getElementById('handled-count').textContent = '0';
                document.getElementById('total-count').textContent = '0';
            }
        } catch (error) {
            console.error('è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
            // å¦‚æœç»Ÿè®¡APIå¤±è´¥ï¼Œè®¾ç½®ä¸º0
            document.getElementById('pending-count').textContent = '0';
            document.getElementById('handled-count').textContent = '0';
            document.getElementById('total-count').textContent = '0';
        }
    }

    async function loadReports() {
        const res = await fetch('/api/reports/all');
        const data = await res.json();
        const pendingList = document.getElementById('report-list');
        const handledList = document.getElementById('handled-report-list');
        
        if (!data.success || !data.reports || data.reports.length === 0) {
            pendingList.innerHTML = '<div class="list-placeholder">æš‚æ— ä¸¾æŠ¥</div>';
            handledList.innerHTML = '<div class="list-placeholder">æš‚æ— å·²å¤„ç†ä¸¾æŠ¥</div>';
            // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
            loadReportStats();
            return;
        }
        
        // åˆ†ç»„
        const pending = data.reports.filter(r => r.report_status == 0);
        const handled = data.reports.filter(r => r.report_status != 0);
        
        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        loadReportStats();
        
        // æ¸²æŸ“å¾…å¤„ç†ä¸¾æŠ¥
        if (pending.length > 0) {
            const pendingHtml = pending.map(r => `
                <div class="report-card" style="background:linear-gradient(135deg, #fff 0%, #f8f9fa 100%);border-radius:16px;box-shadow:0 4px 20px rgba(74,155,142,0.1);border:2px solid #e8f5e8;padding:24px;margin-bottom:20px;transition:all 0.3s ease;cursor:pointer;position:relative;overflow:hidden;" onclick="showReportDetail(${r.report_id})">
                    <div style="position:absolute;top:0;left:0;width:4px;height:100%;background:linear-gradient(180deg, #e74c3c 0%, #c0392b 100%);"></div>
                    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;">
                        <div style="flex:1;">
                            <div style="font-size:13px;color:#7f8c8d;display:flex;align-items:center;gap:8px;">
                                <span>ğŸ“… ${new Date(r.report_createdtime).toLocaleString()}</span>
                            </div>
                        </div>
                        <span class="status-badge status-pending" style="margin-left:12px;">å¾…å¤„ç†</span>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
                        <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #ecf0f1;">
                            <div style="font-weight:600;color:#34495e;margin-bottom:4px;">ğŸ‘¤ ä¸¾æŠ¥äºº</div>
                            <div style="color:#7f8c8d;font-size:14px;">${r.user_name || r.user_id}</div>
                        </div>
                        <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #ecf0f1;">
                            <div style="font-weight:600;color:#34495e;margin-bottom:4px;">ğŸ“ ä¸¾æŠ¥ç†ç”±</div>
                            <div style="color:#e67e22;font-size:14px;font-weight:500;">${r.reason}</div>
                        </div>
                    </div>
                    <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #ecf0f1;margin-bottom:20px;">
                        <div style="font-weight:600;color:#34495e;margin-bottom:4px;">ğŸ“„ åšå®¢æ ‡é¢˜</div>
                        <div style="color:#2c3e50;font-size:14px;font-weight:500;">${r.blog_title || 'åšå®¢ID:' + r.blog_id}</div>
                    </div>
                    <div style="display:flex;gap:10px;justify-content:flex-end;" onclick="event.stopPropagation();">
                        <button class="action-btn" style="background:linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);color:#fff;border:none;border-radius:10px;padding:10px 20px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(231,76,60,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(231,76,60,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 2px 8px rgba(231,76,60,0.3)'" onclick="banUser(${r.user_id}, ${r.report_id})">ğŸš« å°ç¦ç”¨æˆ·</button>
                        <button class="action-btn" style="background:linear-gradient(135deg, #f39c12 0%, #e67e22 100%);color:#fff;border:none;border-radius:10px;padding:10px 20px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(243,156,18,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(243,156,18,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 2px 8px rgba(243,156,18,0.3)'" onclick="banBlog(${r.blog_id}, ${r.report_id})">ğŸš« å°ç¦åšå®¢</button>
                        <button class="action-btn" style="background:linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);color:#fff;border:none;border-radius:10px;padding:10px 20px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(149,165,166,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(149,165,166,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 2px 8px rgba(149,165,166,0.3)'" onclick="rejectReport(${r.report_id}, ${r.user_id})">âŒ é©³å›ä¸¾æŠ¥</button>
                    </div>
                </div>
            `).join('');
            pendingList.innerHTML = pendingHtml;
        } else {
            pendingList.innerHTML = '<div class="list-placeholder">æš‚æ— å¾…å¤„ç†ä¸¾æŠ¥</div>';
        }
        
        // æ¸²æŸ“å·²å¤„ç†ä¸¾æŠ¥
        if (handled.length > 0) {
            const handledHtml = handled.map(r => {
                let statusText = 'å·²å¤„ç†';
                let statusClass = 'status-pending';
                let statusColor = '#95a5a6';
                // ä¼˜å…ˆåˆ¤æ–­ç”¨æˆ·å°ç¦ï¼Œå…¶æ¬¡åšå®¢å°ç¦ï¼Œå†åˆ¤æ–­report_status
                if (r.user_is_ban == 1) {
                    statusText = 'ç”¨æˆ·å·²å°ç¦';
                    statusClass = 'status-user-banned';
                    statusColor = '#e74c3c';
                } else if (r.blog_is_shielded == 1) {
                    statusText = 'åšå®¢å·²å°ç¦';
                    statusClass = 'status-blog-banned';
                    statusColor = '#f39c12';
                } else if (r.report_status == 1) {
                    statusText = 'ç”¨æˆ·å·²å°ç¦';
                    statusClass = 'status-user-banned';
                    statusColor = '#e74c3c';
                } else if (r.report_status == 2) {
                    statusText = 'åšå®¢å·²å°ç¦';
                    statusClass = 'status-blog-banned';
                    statusColor = '#f39c12';
                } else if (r.report_status == 3) {
                    statusText = 'ä¸¾æŠ¥å·²é©³å›';
                    statusClass = 'status-rejected';
                    statusColor = '#95a5a6';
                }
                return `
                    <div class="report-card" style="background:linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);border-radius:16px;box-shadow:0 3px 15px rgba(39,174,96,0.08);border:2px solid #d4edda;padding:24px;margin-bottom:18px;opacity:0.95;cursor:pointer;position:relative;overflow:hidden;" onclick="showReportDetail(${r.report_id})">
                        <div style="position:absolute;top:0;left:0;width:4px;height:100%;background:linear-gradient(180deg, ${statusColor} 0%, ${statusColor}dd 100%);"></div>
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;">
                            <div style="flex:1;">
                                <div style="font-size:13px;color:#6c757d;display:flex;align-items:center;gap:8px;">
                                    <span>ğŸ“… ${new Date(r.report_createdtime).toLocaleString()}</span>
                                </div>
                            </div>
                            <span class="status-badge ${statusClass}" style="margin-left:12px;background:${statusColor};">${statusText}</span>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
                            <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #dee2e6;">
                                <div style="font-weight:600;color:#495057;margin-bottom:4px;">ğŸ‘¤ ä¸¾æŠ¥äºº</div>
                                <div style="color:#6c757d;font-size:14px;">${r.user_name || r.user_id}</div>
                            </div>
                            <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #dee2e6;">
                                <div style="font-weight:600;color:#495057;margin-bottom:4px;">ğŸ“ ä¸¾æŠ¥ç†ç”±</div>
                                <div style="color:#e67e22;font-size:14px;font-weight:500;">${r.reason}</div>
                            </div>
                        </div>
                        <div style="background:#fff;padding:12px;border-radius:10px;border:1px solid #dee2e6;margin-bottom:0;">
                            <div style="font-weight:600;color:#495057;margin-bottom:4px;">ğŸ“„ åšå®¢æ ‡é¢˜</div>
                            <div style="color:#495057;font-size:14px;font-weight:500;">${r.blog_title || 'åšå®¢ID:' + r.blog_id}</div>
                        </div>
                    </div>
                `;
            }).join('');
            handledList.innerHTML = handledHtml;
        } else {
            handledList.innerHTML = '<div class="list-placeholder">æš‚æ— å·²å¤„ç†ä¸¾æŠ¥</div>';
        }
    }

    // æ˜¾ç¤ºä¸¾æŠ¥è¯¦æƒ…
    async function showReportDetail(reportId) {
        try {
            const response = await fetch(`/api/reports/${reportId}/detail`);
            const result = await response.json();
            
            if (result.success) {
                const report = result.report;
                const blog = result.blog;
                const reporter = result.reporter;
                const blogAuthor = result.blogAuthor;
                
                const detailContent = `
                    <div class="report-detail-section">
                        <div class="report-detail-title">ä¸¾æŠ¥ä¿¡æ¯</div>
                        <div class="report-detail-content">
                            <p><strong>ä¸¾æŠ¥IDï¼š</strong>${report.report_id}</p>
                            <p><strong>ä¸¾æŠ¥æ—¶é—´ï¼š</strong>${new Date(report.report_createdtime).toLocaleString()}</p>
                            <p><strong>ä¸¾æŠ¥çŠ¶æ€ï¼š</strong>${report.report_status == 0 ? '<span style="color:#e74c3c;">å¾…å¤„ç†</span>' : '<span style="color:#27ae60;">å·²å¤„ç†</span>'}</p>
                            ${report.report_handled_time ? `<p><strong>å¤„ç†æ—¶é—´ï¼š</strong>${new Date(report.report_handled_time).toLocaleString()}</p>` : ''}
                        </div>
                    </div>
                    
                    <div class="report-detail-section">
                        <div class="report-detail-title">ä¸¾æŠ¥äººä¿¡æ¯</div>
                        <div class="report-detail-content">
                            <p><strong>ç”¨æˆ·IDï¼š</strong>${reporter.user_id}</p>
                            <p><strong>ç”¨æˆ·åï¼š</strong>${reporter.user_name || 'æœªçŸ¥'}</p>
                            <p><strong>é‚®ç®±ï¼š</strong>${reporter.user_email || 'æœªçŸ¥'}</p>
                        </div>
                    </div>
                    
                    <div class="report-detail-section">
                        <div class="report-detail-title">ä¸¾æŠ¥ç†ç”±</div>
                        <div class="report-detail-content">
                            <p style="color:#e67e22;font-weight:500;">${report.reason}</p>
                        </div>
                    </div>
                    
                    <div class="report-detail-section">
                        <div class="report-detail-title">è¢«ä¸¾æŠ¥åšå®¢ä¿¡æ¯</div>
                        <div class="report-detail-content">
                            <p><strong>åšå®¢IDï¼š</strong>${blog.blog_id}</p>
                            <p><strong>åšå®¢æ ‡é¢˜ï¼š</strong>${blog.blog_title || 'æ— æ ‡é¢˜'}</p>
                            <p><strong>åšå®¢å†…å®¹ï¼š</strong></p>
                            <div style="background:#f1f1f1;padding:10px;border-radius:5px;margin:5px 0;max-height:200px;overflow-y:auto;">
                                ${blog.blog_content || 'æ— å†…å®¹'}
                            </div>
                            <p><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>${new Date(blog.blog_create_time).toLocaleString()}</p>
                            <p><strong>ç‚¹èµæ•°ï¼š</strong>${blog.like_count || 0}</p>
                            <p><strong>æ”¶è—æ•°ï¼š</strong>${blog.favorite_count || 0}</p>
                            <p><strong>è¯„è®ºæ•°ï¼š</strong>${blog.comment_count || 0}</p>
                        </div>
                    </div>
                    
                    <div class="report-detail-section">
                        <div class="report-detail-title">åšå®¢ä½œè€…ä¿¡æ¯</div>
                        <div class="report-detail-content">
                            <p><strong>ç”¨æˆ·IDï¼š</strong>${blogAuthor.user_id}</p>
                            <p><strong>ç”¨æˆ·åï¼š</strong>${blogAuthor.user_name || 'æœªçŸ¥'}</p>
                            <p><strong>é‚®ç®±ï¼š</strong>${blogAuthor.user_email || 'æœªçŸ¥'}</p>
                            <p><strong>æ³¨å†Œæ—¶é—´ï¼š</strong>${new Date(blogAuthor.user_createdtime).toLocaleString()}</p>
                        </div>
                    </div>
                    
                    ${report.report_status == 0 ? `
                        <div class="report-actions">
                            <button class="report-action-btn ban-user" onclick="banUserFromDetail(${blogAuthor.user_id}, ${report.report_id})">
                                ğŸš« å°ç¦ç”¨æˆ·
                            </button>
                            <button class="report-action-btn ban-blog" onclick="banBlogFromDetail(${blog.blog_id}, ${report.report_id})">
                                ğŸš« å°ç¦åšå®¢
                            </button>
                            <button class="report-action-btn reject" onclick="rejectReportFromDetail(${report.report_id}, ${reporter.user_id})">
                                âŒ é©³å›ä¸¾æŠ¥
                            </button>
                </div>
                    ` : ''}
                `;
                
                document.getElementById('reportDetailContent').innerHTML = detailContent;
                document.getElementById('reportDetailModal').style.display = 'block';
            } else {
                alert('è·å–ä¸¾æŠ¥è¯¦æƒ…å¤±è´¥ï¼š' + (result.message || 'æœªçŸ¥é”™è¯¯'));
            }
        } catch (error) {
            console.error('è·å–ä¸¾æŠ¥è¯¦æƒ…å¤±è´¥:', error);
            alert('è·å–ä¸¾æŠ¥è¯¦æƒ…å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        }
    }

    // å…³é—­ä¸¾æŠ¥è¯¦æƒ…å¼¹çª—
    function closeReportModal() {
        document.getElementById('reportDetailModal').style.display = 'none';
    }

    // ä»è¯¦æƒ…å¼¹çª—å°ç¦ç”¨æˆ·
    function banUserFromDetail(userId, reportId) {
        if (!confirm('ç¡®å®šè¦å°ç¦è¯¥ç”¨æˆ·å—ï¼Ÿ')) return;
        fetch('/api/reports/banUser', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_id: userId, report_id: reportId })
        }).then(res => res.json()).then(data => {
            if (data.success) {
                // å‘é€é€šçŸ¥ç»™è¢«å°ç¦çš„ç”¨æˆ·
                sendUserNotification(userId, 'error', 'æ‚¨çš„è´¦æˆ·å› è¿åç¤¾åŒºè§„å®šå·²è¢«å°ç¦ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚');
                alert('ç”¨æˆ·å°ç¦æˆåŠŸï¼');
                closeReportModal();
                loadReports();
            } else {
                alert(data.message || 'æ“ä½œå¤±è´¥');
            }
        });
    }

    // ä»è¯¦æƒ…å¼¹çª—å°ç¦åšå®¢
    function banBlogFromDetail(blogId, reportId) {
        if (!confirm('ç¡®å®šè¦å°ç¦è¯¥åšå®¢å—ï¼Ÿ')) return;
        fetch('/api/reports/banBlog', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ blog_id: blogId, report_id: reportId })
        }).then(res => res.json()).then(data => {
            if (data.success) {
                // è·å–åšå®¢ä½œè€…IDå¹¶å‘é€é€šçŸ¥
                getBlogAuthorId(blogId).then(authorId => {
                    if (authorId) {
                        sendUserNotification(authorId, 'warning', 'æ‚¨å‘å¸ƒçš„åšå®¢å› è¿åç¤¾åŒºè§„å®šå·²è¢«å°ç¦ã€‚è¯·éµå®ˆç¤¾åŒºè§„åˆ™ã€‚');
                    }
                });
                alert('åšå®¢å°ç¦æˆåŠŸï¼');
                closeReportModal();
                loadReports();
            } else {
                alert(data.message || 'æ“ä½œå¤±è´¥');
            }
        });
    }

    // ä»è¯¦æƒ…å¼¹çª—é©³å›ä¸¾æŠ¥
    function rejectReportFromDetail(reportId, userId) {
        const reason = prompt('è¯·è¾“å…¥é©³å›ç†ç”±ï¼ˆå¯é€‰ï¼‰ï¼š');
        fetch('/api/reports/reject', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ report_id: reportId, user_id: userId, reason })
        }).then(res => res.json()).then(data => {
            if (data.success) {
                // é€šçŸ¥å·²é€šè¿‡åç«¯APIè‡ªåŠ¨å‘é€
                alert('ä¸¾æŠ¥é©³å›æˆåŠŸï¼');
                closeReportModal();
                loadReports();
            } else {
                alert(data.message || 'æ“ä½œå¤±è´¥');
            }
        });
    }

    function banUser(userId, reportId) {
        if (!confirm('ç¡®å®šè¦å°ç¦è¯¥ç”¨æˆ·å—ï¼Ÿ')) return;
        fetch('/api/reports/banUser', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_id: userId, report_id: reportId })
        }).then(res => res.json()).then(data => {
            if (data.success) {
                // å‘é€é€šçŸ¥ç»™è¢«å°ç¦çš„ç”¨æˆ·
                sendUserNotification(userId, 'error', 'æ‚¨çš„è´¦æˆ·å› è¿åç¤¾åŒºè§„å®šå·²è¢«å°ç¦ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚');
                loadReports();
            } else {
                alert(data.message || 'æ“ä½œå¤±è´¥');
            }
        });
    }
    function banBlog(blogId, reportId) {
        if (!confirm('ç¡®å®šè¦å°ç¦è¯¥åšå®¢å—ï¼Ÿ')) return;
        fetch('/api/reports/banBlog', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ blog_id: blogId, report_id: reportId })
        }).then(res => res.json()).then(data => {
            if (data.success) {
                // è·å–åšå®¢ä½œè€…IDå¹¶å‘é€é€šçŸ¥
                getBlogAuthorId(blogId).then(authorId => {
                    if (authorId) {
                        sendUserNotification(authorId, 'warning', 'æ‚¨å‘å¸ƒçš„åšå®¢å› è¿åç¤¾åŒºè§„å®šå·²è¢«å°ç¦ã€‚è¯·éµå®ˆç¤¾åŒºè§„åˆ™ã€‚');
                    }
                });
                loadReports();
            } else {
                alert(data.message || 'æ“ä½œå¤±è´¥');
            }
        });
    }
    function rejectReport(reportId, userId) {
        const reason = prompt('è¯·è¾“å…¥é©³å›ç†ç”±ï¼ˆå¯é€‰ï¼‰ï¼š');
        fetch('/api/reports/reject', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ report_id: reportId, user_id: userId, reason })
        }).then(res => res.json()).then(data => {
            if (data.success) {
                // é€šçŸ¥å·²é€šè¿‡åç«¯APIè‡ªåŠ¨å‘é€
                loadReports();
            } else {
                alert(data.message || 'æ“ä½œå¤±è´¥');
            }
        });
    }

    // è·å–åšå®¢ä½œè€…ID
    async function getBlogAuthorId(blogId) {
        try {
            const response = await fetch(`/api/blogs/${blogId}`);
            const result = await response.json();
            if (result.success && result.blog) {
                return result.blog.user_id;
            }
        } catch (error) {
            console.error('è·å–åšå®¢ä½œè€…IDå¤±è´¥:', error);
        }
        return null;
    }

    // å‘é€ç”¨æˆ·é€šçŸ¥
    async function sendUserNotification(userId, type, content) {
        try {
            await fetch('/api/notifications/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    inform_type: type,
                    inform_content: content
                })
            });
        } catch (error) {
            console.error('å‘é€é€šçŸ¥å¤±è´¥:', error);
        }
    }

    // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
    window.onclick = function(event) {
        const modal = document.getElementById('reportDetailModal');
        if (event.target === modal) {
            closeReportModal();
        }
    }

    loadReports();
    </script>

    <!-- ä¸¾æŠ¥è¯¦æƒ…å¼¹çª— -->
    <div id="reportDetailModal" class="report-modal">
        <div class="report-modal-content">
            <div class="report-modal-header">
                <h2 class="report-modal-title">ä¸¾æŠ¥è¯¦æƒ…</h2>
                <span class="report-modal-close" onclick="closeReportModal()">&times;</span>
            </div>
            <div id="reportDetailContent">
                <!-- ä¸¾æŠ¥è¯¦æƒ…å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>
</body>
