<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oh my dogï¼ - æŒ‘æˆ˜</title>
    <style>
        :root {
            --primary-color: #3d8b7e;
            --secondary-color: #5ba898;
            --accent-color: #7bc5b7;
            --blue-accent: #8bb8d4;
            --background-color: #edf6f5;
            --card-background: #ffffff;
            --text-color: #2c3e50;
            --border-color: #e0e0e0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('/petblog/images/challenge.png') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            color: var(--text-color);
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--blue-accent) 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--accent-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(74, 155, 142, 0.15);
            backdrop-filter: blur(10px);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--blue-accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        .page-subtitle {
            font-size: 1.2rem;
            color: var(--text-color);
            font-weight: 600;
            margin-bottom: 0.8rem;
            animation: subtitleFloat 4s ease-in-out infinite;
        }

        .challenge-info {
            background: linear-gradient(135deg, rgba(74, 155, 142, 0.1) 0%, rgba(139, 184, 212, 0.1) 100%);
            padding: 0.6rem 1rem;
            border-radius: 15px;
            border: 2px solid rgba(74, 155, 142, 0.2);
            margin-top: 0.8rem;
            animation: infoPulse 5s ease-in-out infinite;
        }

        .challenge-info-text {
            color: var(--primary-color);
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes titleGlow {
            0% {
                filter: drop-shadow(0 0 5px rgba(74, 155, 142, 0.3));
            }
            100% {
                filter: drop-shadow(0 0 15px rgba(74, 155, 142, 0.6));
            }
        }

        @keyframes subtitleFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        @keyframes infoPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(74, 155, 142, 0.1);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 6px 20px rgba(74, 155, 142, 0.2);
            }
        }

        .create-challenge-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.8rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0.8rem;
            box-shadow: 0 4px 15px rgba(61, 139, 126, 0.3);
            position: relative;
            overflow: hidden;
            animation: buttonShine 4s ease-in-out infinite;
        }

        .create-challenge-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .create-challenge-btn:hover::before {
            left: 100%;
        }

        .create-challenge-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(61, 139, 126, 0.4);
        }

        .create-challenge-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes buttonShine {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(61, 139, 126, 0.3);
            }
            50% {
                box-shadow: 0 6px 20px rgba(61, 139, 126, 0.5);
            }
        }

        .challenges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .challenge-card {
            background: var(--card-background);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .challenge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .challenge-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .status-planning {
            background: #fff3cd;
            color: #856404;
        }

        .status-ongoing {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-ended {
            background: #f8d7da;
            color: #721c24;
        }

        .challenge-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .challenge-description {
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .challenge-time {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 1rem;
        }

        .challenge-author {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .challenge-heat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 8px 12px;
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            border-radius: 20px;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .heat-icon {
            font-size: 1.1rem;
        }

        .heat-value {
            font-weight: 700;
            font-size: 1.5rem;
            color: #fff !important;
            text-shadow: none !important;
            letter-spacing: 1px;
        }

        .challenge-heat {
            position: relative;
            cursor: help;
        }

        .heat-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            margin-bottom: 5px;
        }

        .heat-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .challenge-heat:hover .heat-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .challenge-winner {
            background: linear-gradient(135deg, #fff9e6, #ffffff);
            border: 1px solid #ffd700;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 1rem;
        }

        .winner-info-compact {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .winner-avatar-small {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ffd700;
        }

        .winner-text {
            color: #b8860b;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .author-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .participate-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .participate-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }

        .participate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(61, 139, 126, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        /* å® ç‰©é€‰æ‹©æ ·å¼ */
        .pet-tag {
            display: inline-block;
            padding: 8px 12px;
            margin: 5px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .pet-tag:hover {
            border-color: var(--accent-color);
            background: #f0f8f7;
        }

        .pet-tag.selected {
            background: var(--accent-color);
            color: white;
            border-color: var(--primary-color);
        }

        .pet-tag img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }

        /* åšå®¢å¡ç‰‡æ ·å¼ */
        .blog-card {
            background: var(--card-background);
            border-radius: 10px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .blog-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .blog-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .blog-author-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
        }

        .blog-author-info {
            flex: 1;
        }

        .blog-author-name {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 2px;
        }

        .blog-time {
            font-size: 0.8rem;
            color: #888;
        }

        .blog-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .blog-content {
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
            max-height: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .blog-pets {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .blog-pet-tag {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            background: var(--background-color);
            border-radius: 15px;
            font-size: 0.8rem;
            color: var(--primary-color);
        }

        .blog-pet-avatar {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            object-fit: cover;
        }

        .blog-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vote-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .vote-btn {
            background: none;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .vote-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        .vote-btn.voted {
            background: var(--accent-color);
            color: white;
        }

        .vote-count {
            font-size: 0.9rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        /* ç‹—ç‹—æ’åæ ·å¼ */
        .pet-ranking-card {
            background: var(--card-background);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .pet-ranking-card.winner {
            border-color: #ffd700;
            background: linear-gradient(135deg, #fff9e6, #ffffff);
        }

        .pet-ranking-card.second {
            border-color: #c0c0c0;
            background: linear-gradient(135deg, #f8f8f8, #ffffff);
        }

        .pet-ranking-card.third {
            border-color: #cd7f32;
            background: linear-gradient(135deg, #fdf6f0, #ffffff);
        }

        .ranking-badge {
            position: absolute;
            top: -10px;
            left: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .ranking-badge.first {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #b8860b;
        }

        .ranking-badge.second {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: #666;
        }

        .ranking-badge.third {
            background: linear-gradient(135deg, #cd7f32, #deb887);
            color: #8b4513;
        }

        .ranking-badge.other {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .pet-ranking-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .pet-ranking-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
        }

        .pet-ranking-info {
            flex: 1;
        }

        .pet-ranking-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .pet-ranking-breed {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .pet-ranking-owner {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #888;
            font-size: 0.8rem;
        }

        .owner-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
        }

        .pet-ranking-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--background-color);
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
        }

        .winner-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .winner-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ffd700;
        }

        .winner-info {
            flex: 1;
        }

        .winner-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #b8860b;
            margin-bottom: 3px;
        }

        .winner-votes {
            color: #666;
            font-size: 0.9rem;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .page-title {
                font-size: 2.2rem;
            }
            
            .page-subtitle {
                font-size: 1.2rem;
            }
            
            .challenge-info-text {
                font-size: 0.85rem;
                flex-direction: column;
                gap: 4px;
            }
            
            .page-header {
                padding: 1.2rem;
                margin-bottom: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 1.8rem;
            }
            
            .page-subtitle {
                font-size: 1.1rem;
            }
            
            .challenge-info-text {
                font-size: 0.8rem;
            }
            
            .page-header {
                padding: 1rem;
            }
        }

        .remove-challenge-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }

        .remove-challenge-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
        }

        .remove-challenge-btn:active {
            transform: translateY(0);
        }

        /* åšå®¢çƒ­åº¦æ ·å¼ */
        .blog-heat-section {
            margin: 15px 0;
            padding: 12px 16px;
            background: linear-gradient(135deg, #fff5f5 0%, #f0f8ff 100%);
            border-radius: 12px;
            border: 1px solid #e8f4fd;
        }

        .blog-heat-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .heat-icon {
            font-size: 16px;
            color: #ff6b35;
        }

        .heat-label {
            color: #666;
            font-weight: 500;
        }

        .heat-value {
            font-weight: bold;
            color: #ff6b35;
            font-size: 16px;
        }

        .heat-details-btn {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            color: #666;
        }

        .heat-details-btn:hover {
            background: rgba(255, 107, 53, 0.1);
            color: #ff6b35;
            transform: scale(1.1);
        }

        /* çƒ­åº¦è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
        .heat-details-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .heat-details-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        .heat-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 16px 24px;
            border-bottom: 1px solid #eee;
        }

        .heat-details-header h3 {
            margin: 0;
            color: #333;
            font-size: 20px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 4px;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: #333;
        }

        .heat-details-body {
            padding: 24px;
        }

        .total-heat {
            text-align: center;
            margin-bottom: 24px;
            padding: 20px;
            background: linear-gradient(135deg, #fff5f5 0%, #f0f8ff 100%);
            border-radius: 12px;
            border: 2px solid #e8f4fd;
        }

        .total-heat-label {
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }

        .total-heat-value {
            font-size: 28px;
            font-weight: bold;
            color: #ff6b35;
            margin-left: 8px;
        }

        .heat-breakdown {
            margin-bottom: 24px;
        }

        .heat-breakdown h4 {
            margin: 0 0 16px 0;
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .heat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .heat-item:last-child {
            border-bottom: none;
        }

        .heat-item-label {
            font-weight: 500;
            color: #333;
            flex: 1;
        }

        .heat-item-value {
            font-weight: bold;
            color: #ff6b35;
            margin: 0 16px;
            min-width: 40px;
            text-align: center;
        }

        .heat-item-calculation {
            color: #666;
            font-size: 12px;
            font-family: monospace;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }

        .heat-formula {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #ff6b35;
        }

        .heat-formula h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 14px;
            font-weight: 600;
        }

        .heat-formula p {
            margin: 0;
            color: #666;
            font-size: 13px;
            line-height: 1.4;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .heat-details-content {
                width: 95%;
                margin: 20px;
            }

            .heat-details-header,
            .heat-details-body {
                padding: 16px;
            }

            .heat-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .heat-item-value,
            .heat-item-calculation {
                margin: 0;
                align-self: flex-end;
            }
        }

        .challenge-heat .heat-value {
            color: #fff !important;
        }

        .blog-heat-display .heat-value {
            color: #000 !important;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">Oh my dogï¼</a>
            <div class="nav-links">
                <a href="/">é¦–é¡µ</a>
                <a href="/challenges.html" class="active">æŒ‘æˆ˜</a>
                <a href="/petblog/profile.html">ä¸ªäººä¸­å¿ƒ</a>
                <a href="/logout">é€€å‡ºç™»å½•</a>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">ğŸ• ç‹—ç‹—æŒ‘æˆ˜ ğŸ•</h1>
            <p class="page-subtitle">å‚ä¸æœ‰è¶£çš„æŒ‘æˆ˜ï¼Œå±•ç¤ºæ‚¨çš„ç‹—ç‹—æ‰èƒ½</p>
            <button class="create-challenge-btn" onclick="openCreateModal()">
                ğŸ¯ å‘èµ·æŒ‘æˆ˜
            </button>

            <div class="challenge-info">
                <div class="challenge-info-text">
                    <span style="font-size: 1.2rem;">ğŸ’¡</span>
                    <span>æŒ‘æˆ˜æŒ‰çƒ­åº¦æ’åºæ˜¾ç¤ºï¼Œçƒ­åº¦è¶Šé«˜æ’åè¶Šé å‰</span>
                    <span style="font-size: 1.2rem;">ğŸ”¥</span>
                </div>
            </div>
        </div>

        <div id="challengesContainer" class="challenges-grid">
            <!-- æŒ‘æˆ˜å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <h3>æš‚æ— æŒ‘æˆ˜</h3>
            <p>æˆä¸ºç¬¬ä¸€ä¸ªå‘èµ·æŒ‘æˆ˜çš„äººå§ï¼</p>
        </div>
    </div>

    <!-- åˆ›å»ºæŒ‘æˆ˜æ¨¡æ€æ¡† -->
    <div id="createChallengeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">å‘èµ·æ–°æŒ‘æˆ˜</h2>
                <span class="close" onclick="closeCreateModal()">&times;</span>
            </div>
            <form id="createChallengeForm">
                <div class="form-group">
                    <label for="challengeTitle">æŒ‘æˆ˜æ ‡é¢˜ *</label>
                    <input type="text" id="challengeTitle" name="title" required maxlength="100">
                </div>
                <div class="form-group">
                    <label for="challengeDescription">æŒ‘æˆ˜æè¿°</label>
                    <textarea id="challengeDescription" name="description" maxlength="255" placeholder="æè¿°æŒ‘æˆ˜çš„è§„åˆ™å’Œè¦æ±‚..."></textarea>
                </div>
                <div class="form-group">
                    <label for="startTime">å¼€å§‹æ—¶é—´ *</label>
                    <input type="datetime-local" id="startTime" name="start_time" required>
                </div>
                <div class="form-group">
                    <label for="endTime">ç»“æŸæ—¶é—´ *</label>
                    <input type="datetime-local" id="endTime" name="end_time" required>
                </div>
                <button type="submit" class="submit-btn">å‘èµ·æŒ‘æˆ˜</button>
            </form>
        </div>
    </div>

    <!-- å‚ä¸æŒ‘æˆ˜æ¨¡æ€æ¡† -->
    <div id="participateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">å‚ä¸æŒ‘æˆ˜ - å‘å¸ƒåšå®¢</h2>
                <span class="close" onclick="closeParticipateModal()">&times;</span>
            </div>

            <!-- æŒ‘æˆ˜ä¿¡æ¯æ˜¾ç¤º -->
            <div id="participateChallengeInfo" style="padding: 15px; background: #f0f8f7; border-radius: 8px; border: 1px solid var(--accent-color); margin-bottom: 20px;">
                <div id="participateChallengeTitle" style="font-weight: 600; color: var(--primary-color); margin-bottom: 5px;"></div>
                <div id="participateChallengeDescription" style="color: #666; font-size: 0.9rem; margin-bottom: 5px;"></div>
                <div id="participateChallengeTime" style="color: #888; font-size: 0.8rem;"></div>
                <div style="margin-top: 10px; color: #e74c3c; font-size: 0.9rem; font-weight: 500;">
                    âš ï¸ å‚ä¸æŒ‘æˆ˜å¿…é¡»é€‰æ‹©è‡³å°‘ä¸€åªç‹—ç‹—
                </div>
            </div>

            <form id="participateBlogForm" enctype="multipart/form-data">
                <input type="hidden" id="participateChallengeId" name="challenge_id">

                <div class="form-group">
                    <label for="participateBlogTitle">åšå®¢æ ‡é¢˜ *</label>
                    <input type="text" id="participateBlogTitle" name="blog_title" required maxlength="100" placeholder="è¯·è¾“å…¥åšå®¢æ ‡é¢˜">
                </div>

                <div class="form-group">
                    <label for="participateBlogContent">åšå®¢å†…å®¹ *</label>
                    <textarea id="participateBlogContent" name="blog_content" required placeholder="åˆ†äº«æ‚¨çš„æƒ³æ³•..." style="min-height: 120px;"></textarea>
                </div>

                <div class="form-group">
                    <label for="participateColumnId">é€‰æ‹©ä¸“æ ï¼ˆå¯é€‰ï¼‰</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <select id="participateColumnId" name="column_id" style="flex: 1; padding: 0.8rem; border: 2px solid var(--border-color); border-radius: 8px;">
                            <option value="">ä¸é€‰æ‹©ä¸“æ </option>
                        </select>
                        <button type="button" id="participateQuickCreateColumn" style="padding: 8px 12px; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap;">æ–°å»º</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>é€‰æ‹©å‚èµ›ç‹—ç‹— *</label>
                    <div id="participatePetSelection" style="margin-top: 10px;">
                        <div style="color: #666; text-align: center; padding: 10px;">æ­£åœ¨åŠ è½½ç‹—ç‹—åˆ—è¡¨...</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="participateFiles">é™„ä»¶ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="file" id="participateFiles" name="files" multiple accept="*/*">
                    <div style="font-size: 12px; color: #666; margin-top: 4px;">æœ€å¤š5ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªä¸è¶…è¿‡10MB</div>
                </div>

                <button type="submit" class="submit-btn">å‘å¸ƒåšå®¢å‚ä¸æŒ‘æˆ˜</button>
            </form>
        </div>
    </div>

    <!-- æŸ¥çœ‹æŒ‘æˆ˜ä½œå“æ¨¡æ€æ¡† -->
    <div id="challengeBlogsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">æŒ‘æˆ˜ä½œå“</h2>
                <span class="close" onclick="closeChallengeBlogs()">&times;</span>
            </div>

            <div id="challengeBlogsInfo" style="padding: 15px; background: #f0f8f7; border-radius: 8px; border: 1px solid var(--accent-color); margin-bottom: 20px;">
                <div id="challengeBlogsTitle" style="font-weight: 600; color: var(--primary-color); margin-bottom: 5px;"></div>
                <div id="challengeBlogsDescription" style="color: #666; font-size: 0.9rem;"></div>
            </div>

            <div id="challengeBlogsList">
                <div style="color: #666; text-align: center; padding: 20px;">æ­£åœ¨åŠ è½½ä½œå“...</div>
            </div>
        </div>
    </div>

    <!-- ç‹—ç‹—æ’åæ¨¡æ€æ¡† -->
    <div id="petRankingsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ† ç‹—ç‹—æŠ•ç¥¨æ’å</h2>
                <span class="close" onclick="closePetRankings()">&times;</span>
            </div>

            <div id="rankingsInfo" style="padding: 15px; background: #f0f8f7; border-radius: 8px; border: 1px solid var(--accent-color); margin-bottom: 20px;">
                <div id="rankingsTitle" style="font-weight: 600; color: var(--primary-color); margin-bottom: 5px;"></div>
                <div id="rankingsDescription" style="color: #666; font-size: 0.9rem; margin-bottom: 10px;"></div>
                <div id="challengeStatus" style="color: #888; font-size: 0.9rem;"></div>
            </div>

            <div id="winnersSection" style="display: none; margin-bottom: 20px;">
                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #ffd700, #ffed4e); border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="color: #b8860b; margin-bottom: 10px;">ğŸ‰ è·èƒœç‹—ç‹— ğŸ‰</h3>
                    <div id="winnersList"></div>
                </div>
            </div>

            <div id="petRankingsList">
                <div style="color: #666; text-align: center; padding: 20px;">æ­£åœ¨åŠ è½½æ’å...</div>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶è·å–æŒ‘æˆ˜åˆ—è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            loadChallenges();

            // å¿«é€Ÿåˆ›å»ºä¸“æ åŠŸèƒ½
            document.getElementById('participateQuickCreateColumn').addEventListener('click', function() {
                const columnName = prompt('è¯·è¾“å…¥ä¸“æ åç§°:');
                if (columnName && columnName.trim()) {
                    createQuickColumnForParticipate(columnName.trim());
                }
            });
        });

        // è·å–å½“å‰ç”¨æˆ·ID
        let currentUserId = null;

        // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        async function getCurrentUser() {
            try {
                // ä» sessionStorage è·å–å½“å‰ç”¨æˆ·ID
                const currentUserStr = sessionStorage.getItem('currentUser');
                if (currentUserStr) {
                    try {
                        const currentUser = JSON.parse(currentUserStr);
                        currentUserId = currentUser.userId;
                        console.log('å½“å‰ç”¨æˆ·ID:', currentUserId);
                    } catch (e) {
                        console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);
                    }
                } else {
                    console.log('æœªæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·å…ˆç™»å½•');
                }
            } catch (error) {
                console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // åŠ è½½æŒ‘æˆ˜åˆ—è¡¨
        async function loadChallenges() {
            try {
                // å…ˆè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
                await getCurrentUser();
                
                const response = await fetch('/petblog/api/challenges');
                const challenges = await response.json();
                console.log('è·å–åˆ°çš„æŒ‘æˆ˜åˆ—è¡¨:', challenges);
                
                const container = document.getElementById('challengesContainer');
                const emptyState = document.getElementById('emptyState');
                
                if (challenges.length === 0) {
                    container.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }
                
                container.style.display = 'grid';
                emptyState.style.display = 'none';
                
                container.innerHTML = challenges.map(challenge => createChallengeCard(challenge)).join('');
            } catch (error) {
                console.error('åŠ è½½æŒ‘æˆ˜å¤±è´¥:', error);
            }
        }

        // åˆ›å»ºæŒ‘æˆ˜å¡ç‰‡
        function createChallengeCard(challenge) {
            const status = getChallengeStatus(challenge.challenge_start_time, challenge.challenge_end_time);
            const statusClass = `status-${status.type}`;
            // ç¡®ä¿ç±»å‹ä¸€è‡´ï¼Œéƒ½è½¬æ¢ä¸ºæ•°å­—è¿›è¡Œæ¯”è¾ƒ
            const isCreator = currentUserId && parseInt(challenge.uer_id) === parseInt(currentUserId);
            // ä¿®æ”¹åˆ é™¤æ¡ä»¶ï¼šå‘èµ·è€…å¯ä»¥åˆ é™¤ä»»ä½•çŠ¶æ€çš„æŒ‘æˆ˜ï¼ˆåªè¦æ²¡æœ‰åšå®¢å‚ä¸ï¼‰
            const canDelete = isCreator;

            // è°ƒè¯•ä¿¡æ¯
            console.log('æŒ‘æˆ˜å¡ç‰‡è°ƒè¯•ä¿¡æ¯:', {
                challengeId: challenge.challenge_id,
                challengeTitle: challenge.challenge_title,
                currentUserId: currentUserId,
                currentUserIdType: typeof currentUserId,
                challengeUserId: challenge.uer_id,
                challengeUserIdType: typeof challenge.uer_id,
                isCreator: isCreator,
                status: status,
                canDelete: canDelete
            });

            return `
                <div class="challenge-card">
                    <div class="challenge-status ${statusClass}">${status.text}</div>
                    <div class="challenge-heat">
                        <span class="heat-icon">ğŸ”¥</span>
                        <span>çƒ­åº¦ï¼š</span>
                        <span class="heat-value" id="heat_${challenge.challenge_id}">${formatHeat(challenge.heat || 0)}</span>
                        <div class="heat-tooltip">
                            çƒ­åº¦ = åšå®¢æ•°Ã—50 + æŠ•ç¥¨æ•°Ã—50 + ç‚¹èµæ•°Ã—20 + æ”¶è—æ•°Ã—20 + è¯„è®ºæ•°Ã—10 + è½¬å‘æ•°Ã—10
                        </div>
                    </div>
                    <h3 class="challenge-title">${challenge.challenge_title}</h3>
                    <p class="challenge-description">${challenge.challenge_description || 'æš‚æ— æè¿°'}</p>
                    <div class="challenge-time">
                        å¼€å§‹ï¼š${formatDateTime(challenge.challenge_start_time)}<br>
                        ç»“æŸï¼š${formatDateTime(challenge.challenge_end_time)}
                    </div>
                    <div class="challenge-author">
                        <img src="${challenge.user_avatar_path || '/petblog/images/Default avatar.png'}" alt="å¤´åƒ" class="author-avatar">
                        <span>å‘èµ·è€…ï¼š${challenge.user_name}</span>
                    </div>
                    <div id="winner_${challenge.challenge_id}" class="challenge-winner" style="display: none;">
                        <!-- è·èƒœè€…ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="participate-btn"
                                onclick="participateChallenge(${challenge.challenge_id})"
                                ${status.type !== 'ongoing' ? 'disabled' : ''}
                                style="flex: 1; min-width: 100px;">
                            ${status.type === 'ongoing' ? 'å‚ä¸æŒ‘æˆ˜' : 'æŒ‘æˆ˜å·²ç»“æŸ'}
                        </button>
                        <button class="participate-btn"
                                onclick="viewChallengeBlogs(${challenge.challenge_id})"
                                style="flex: 1; min-width: 100px; background: var(--blue-accent);">
                            æŸ¥çœ‹ä½œå“
                        </button>
                        <button class="participate-btn"
                                onclick="viewPetRankings(${challenge.challenge_id})"
                                style="flex: 1; min-width: 100px; background: var(--secondary-color);">
                            ğŸ† æ’å
                        </button>
                        ${canDelete ? `
                            <button class="participate-btn"
                                    onclick="deleteChallenge(${challenge.challenge_id})"
                                    style="flex: 1; min-width: 100px; background: #e74c3c; color: white;">
                                ğŸ—‘ï¸ åˆ é™¤
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // è·å–æŒ‘æˆ˜çŠ¶æ€
        function getChallengeStatus(startTime, endTime) {
            const now = new Date();
            const start = new Date(startTime);
            const end = new Date(endTime);
            
            if (now < start) {
                return { type: 'planning', text: 'è§„åˆ’ä¸­' };
            } else if (now >= start && now <= end) {
                return { type: 'ongoing', text: 'è¿›è¡Œä¸­' };
            } else {
                return { type: 'ended', text: 'å·²ç»“æŸ' };
            }
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        function formatDateTime(dateTime) {
            return new Date(dateTime).toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // æ ¼å¼åŒ–çƒ­åº¦æ•°å€¼
        function formatHeat(heat) {
            if (heat >= 10000) {
                return (heat / 10000).toFixed(1) + 'w';
            } else if (heat >= 1000) {
                return (heat / 1000).toFixed(1) + 'k';
            } else {
                return heat.toString();
            }
        }

        // æ‰“å¼€åˆ›å»ºæŒ‘æˆ˜æ¨¡æ€æ¡†
        function openCreateModal() {
            document.getElementById('createChallengeModal').style.display = 'block';
            
            // è®¾ç½®é»˜è®¤æ—¶é—´
            const now = new Date();
            const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
            const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('startTime').value = formatDateTimeLocal(tomorrow);
            document.getElementById('endTime').value = formatDateTimeLocal(nextWeek);
        }

        // å…³é—­åˆ›å»ºæŒ‘æˆ˜æ¨¡æ€æ¡†
        function closeCreateModal() {
            document.getElementById('createChallengeModal').style.display = 'none';
            document.getElementById('createChallengeForm').reset();
        }

        // æ ¼å¼åŒ–ä¸ºdatetime-localè¾“å…¥æ ¼å¼
        function formatDateTimeLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // åˆ›å»ºæŒ‘æˆ˜è¡¨å•æäº¤
        document.getElementById('createChallengeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const challengeData = {
                title: formData.get('title'),
                description: formData.get('description'),
                start_time: formData.get('start_time'),
                end_time: formData.get('end_time')
            };
            
            // éªŒè¯æ—¶é—´
            const startTime = new Date(challengeData.start_time);
            const endTime = new Date(challengeData.end_time);
            const now = new Date();
            
            if (startTime <= now) {
                alert('å¼€å§‹æ—¶é—´å¿…é¡»æ™šäºå½“å‰æ—¶é—´');
                return;
            }
            
            if (endTime <= startTime) {
                alert('ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´');
                return;
            }
            
            try {
                const response = await fetch('/api/challenges', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(challengeData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('æŒ‘æˆ˜åˆ›å»ºæˆåŠŸï¼');
                    closeCreateModal();
                    loadChallenges(); // é‡æ–°åŠ è½½æŒ‘æˆ˜åˆ—è¡¨
                } else {
                    alert(result.message || 'åˆ›å»ºæŒ‘æˆ˜å¤±è´¥');
                }
            } catch (error) {
                console.error('åˆ›å»ºæŒ‘æˆ˜å¤±è´¥:', error);
                alert('åˆ›å»ºæŒ‘æˆ˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        });

        // å‚ä¸æŒ‘æˆ˜
        async function participateChallenge(challengeId) {
            try {
                // è·å–æŒ‘æˆ˜è¯¦æƒ…
                const response = await fetch(`/petblog/api/challenges/${challengeId}`);
                const result = await response.json();

                if (result.success) {
                    const challenge = result.challenge;

                    // å¡«å……æŒ‘æˆ˜ä¿¡æ¯
                    document.getElementById('participateChallengeTitle').textContent = challenge.challenge_title;
                    document.getElementById('participateChallengeDescription').textContent = challenge.challenge_description || 'æš‚æ— æè¿°';
                    document.getElementById('participateChallengeTime').textContent =
                        `å¼€å§‹ï¼š${formatDateTime(challenge.challenge_start_time)} | ç»“æŸï¼š${formatDateTime(challenge.challenge_end_time)}`;
                    document.getElementById('participateChallengeId').value = challengeId;

                    // åŠ è½½å® ç‰©åˆ—è¡¨å’Œä¸“æ åˆ—è¡¨
                    await loadPetsForParticipate();
                    await loadColumnsForParticipate();

                    // æ˜¾ç¤ºå‚ä¸æ¨¡æ€æ¡†
                    document.getElementById('participateModal').style.display = 'block';
                } else {
                    alert('æŒ‘æˆ˜ä¸å­˜åœ¨æˆ–å·²ç»“æŸ');
                }
            } catch (error) {
                console.error('åŠ è½½æŒ‘æˆ˜ä¿¡æ¯å¤±è´¥:', error);
                alert('åŠ è½½æŒ‘æˆ˜ä¿¡æ¯å¤±è´¥');
            }
        }

        // åŠ è½½å® ç‰©åˆ—è¡¨ç”¨äºå‚ä¸æŒ‘æˆ˜
        async function loadPetsForParticipate() {
            try {
                const response = await fetch('/petblog/api/pets/my');
                const pets = await response.json();

                const container = document.getElementById('participatePetSelection');

                if (pets.length === 0) {
                    container.innerHTML = '<div style="color: #666; text-align: center; padding: 10px;">æ‚¨è¿˜æ²¡æœ‰æ·»åŠ ç‹—ç‹—ï¼Œè¯·å…ˆåœ¨ä¸ªäººä¸­å¿ƒæ·»åŠ </div>';
                    return;
                }

                container.innerHTML = pets.map(pet => `
                    <div class="pet-tag" data-pet-id="${pet.pet_id}" onclick="togglePetSelection(this)">
                        <img src="${pet.pet_avatar_path || '/petblog/images/default-pet.png'}" alt="${pet.pet_name}">
                        ${pet.pet_name}
                    </div>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½å® ç‰©åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('participatePetSelection').innerHTML =
                    '<div style="color: #e74c3c; text-align: center; padding: 10px;">åŠ è½½å® ç‰©åˆ—è¡¨å¤±è´¥</div>';
            }
        }

        // åŠ è½½ä¸“æ åˆ—è¡¨ç”¨äºå‚ä¸æŒ‘æˆ˜
        async function loadColumnsForParticipate() {
            try {
                const response = await fetch('/petblog/api/columns/my');
                const columns = await response.json();

                const select = document.getElementById('participateColumnId');

                // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™é»˜è®¤é€‰é¡¹ï¼‰
                select.innerHTML = '<option value="">ä¸é€‰æ‹©ä¸“æ </option>';

                // æ·»åŠ ä¸“æ é€‰é¡¹
                columns.forEach(column => {
                    const option = document.createElement('option');
                    option.value = column.Column_id;
                    option.textContent = column.Column_name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('åŠ è½½ä¸“æ åˆ—è¡¨å¤±è´¥:', error);
            }
        }

        // åˆ‡æ¢å® ç‰©é€‰æ‹©çŠ¶æ€
        function togglePetSelection(element) {
            element.classList.toggle('selected');
        }

        // å¿«é€Ÿåˆ›å»ºä¸“æ ç”¨äºå‚ä¸æŒ‘æˆ˜
        async function createQuickColumnForParticipate(columnName) {
            try {
                const response = await fetch('/petblog/api/columns', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: columnName })
                });

                const result = await response.json();

                if (result.success) {
                    // é‡æ–°åŠ è½½ä¸“æ åˆ—è¡¨
                    await loadColumnsForParticipate();
                    // è‡ªåŠ¨é€‰æ‹©æ–°åˆ›å»ºçš„ä¸“æ 
                    document.getElementById('participateColumnId').value = result.column_id;
                    alert('ä¸“æ åˆ›å»ºæˆåŠŸï¼');
                } else {
                    alert(result.message || 'åˆ›å»ºä¸“æ å¤±è´¥');
                }
            } catch (error) {
                console.error('åˆ›å»ºä¸“æ å¤±è´¥:', error);
                alert('åˆ›å»ºä¸“æ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // æŸ¥çœ‹æŒ‘æˆ˜ä½œå“
        async function viewChallengeBlogs(challengeId) {
            try {
                console.log('å¼€å§‹åŠ è½½æŒ‘æˆ˜ä½œå“ï¼ŒæŒ‘æˆ˜ID:', challengeId);
                
                // è®¾ç½®å½“å‰æŒ‘æˆ˜IDåˆ°å…¨å±€å˜é‡
                window.currentChallengeId = challengeId;
                
                // è·å–æŒ‘æˆ˜è¯¦æƒ…
                console.log('æ­£åœ¨è·å–æŒ‘æˆ˜è¯¦æƒ…...');
                const challengeResponse = await fetch(`/petblog/api/challenges/${challengeId}`);
                
                if (!challengeResponse.ok) {
                    throw new Error(`æŒ‘æˆ˜è¯¦æƒ…è¯·æ±‚å¤±è´¥: ${challengeResponse.status} ${challengeResponse.statusText}`);
                }
                
                const challengeResult = await challengeResponse.json();
                console.log('æŒ‘æˆ˜è¯¦æƒ…å“åº”:', challengeResult);

                if (challengeResult.success) {
                    const challenge = challengeResult.challenge;

                    // å¡«å……æŒ‘æˆ˜ä¿¡æ¯
                    document.getElementById('challengeBlogsTitle').textContent = challenge.challenge_title;
                    document.getElementById('challengeBlogsDescription').textContent = challenge.challenge_description || 'æš‚æ— æè¿°';

                    // è·å–æŒ‘æˆ˜ç›¸å…³çš„åšå®¢
                    console.log('æ­£åœ¨è·å–æŒ‘æˆ˜åšå®¢...');
                    const blogsResponse = await fetch(`/petblog/api/challenges/${challengeId}/blogs-with-heat`);
                    
                    if (!blogsResponse.ok) {
                        throw new Error(`åšå®¢åˆ—è¡¨è¯·æ±‚å¤±è´¥: ${blogsResponse.status} ${blogsResponse.statusText}`);
                    }
                    
                    const blogs = await blogsResponse.json();
                    console.log('åšå®¢åˆ—è¡¨å“åº”:', blogs);

                    const container = document.getElementById('challengeBlogsList');

                    if (blogs.length === 0) {
                        container.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">æš‚æ— å‚ä¸ä½œå“</div>';
                    } else {
                        container.innerHTML = blogs.map(blog => createBlogCard(blog)).join('');
                        // åŠ è½½æ¯ä¸ªåšå®¢çš„æŠ•ç¥¨çŠ¶æ€
                        blogs.forEach(blog => {
                            loadVoteStatus(blog.blog_id);
                        });
                    }

                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    document.getElementById('challengeBlogsModal').style.display = 'block';
                } else {
                    throw new Error(challengeResult.message || 'è·å–æŒ‘æˆ˜ä¿¡æ¯å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½æŒ‘æˆ˜ä½œå“å¤±è´¥:', error);
                alert(`åŠ è½½æŒ‘æˆ˜ä½œå“å¤±è´¥: ${error.message}`);
            }
        }

        // åˆ›å»ºåšå®¢å¡ç‰‡
        function createBlogCard(blog) {
            // æ£€æŸ¥æ˜¯å¦ä¸ºå½“å‰ç”¨æˆ·çš„åšå®¢
            const isCurrentUserBlog = currentUserId && parseInt(blog.user_id) === parseInt(currentUserId);
            
            return `
                <div class="blog-card">
                    <div class="blog-header">
                        <img src="${blog.user_avatar_path || '/petblog/images/Default avatar.png'}" alt="å¤´åƒ" class="blog-author-avatar">
                        <div class="blog-author-info">
                            <div class="blog-author-name">${blog.user_name}</div>
                            <div class="blog-time">${formatDateTime(blog.blog_create_time)}</div>
                        </div>
                        ${isCurrentUserBlog ? `
                            <button class="remove-challenge-btn" onclick="removeFromChallenge(${blog.blog_id})" title="ä»æŒ‘æˆ˜ä¸­ç§»å‡º">
                                ğŸš« é€€å‡ºæŒ‘æˆ˜
                            </button>
                        ` : ''}
                    </div>
                    <div class="blog-title">${blog.blog_title}</div>
                    <div class="blog-content">${blog.blog_content.substring(0, 150)}${blog.blog_content.length > 150 ? '...' : ''}</div>
                    <div class="blog-heat-section">
                        <div class="blog-heat-display">
                            <span class="heat-icon">ğŸ”¥</span>
                            <span class="heat-label">çƒ­åº¦ï¼š</span>
                            <span class="heat-value" id="heat_${blog.blog_id}">${formatHeat(blog.heat || 0)}</span>
                            <button class="heat-details-btn" onclick="showHeatDetails(${blog.blog_id})" title="æŸ¥çœ‹çƒ­åº¦è¯¦æƒ…">
                                ğŸ“Š
                            </button>
                        </div>
                    </div>
                    <div class="blog-actions">
                        <button class="vote-btn" onclick="toggleVote(${blog.blog_id}, this)" data-blog-id="${blog.blog_id}">
                            ğŸ‘ æŠ•ç¥¨
                        </button>
                        <div class="vote-count" id="voteCount_${blog.blog_id}">${blog.vote_count || 0} ç¥¨</div>
                    </div>
                </div>
            `;
        }

        // ä»æŒ‘æˆ˜ä¸­ç§»å‡ºåšå®¢
        async function removeFromChallenge(blogId) {
            if (!confirm('ç¡®å®šè¦ä»æŒ‘æˆ˜ä¸­ç§»å‡ºè¿™ä¸ªåšå®¢å—ï¼Ÿç§»å‡ºåå°†ä¸å†å‚ä¸æŒ‘æˆ˜ã€‚')) {
                return;
            }

            // è·å–å½“å‰æŒ‘æˆ˜IDï¼ˆä»URLæˆ–å…¨å±€å˜é‡ï¼‰
            const currentChallengeId = getCurrentChallengeId();
            if (!currentChallengeId) {
                alert('æ— æ³•è·å–æŒ‘æˆ˜ä¿¡æ¯');
                return;
            }

            try {
                const response = await fetch('/petblog/api/challenges/remove-blog', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        challenge_id: currentChallengeId,
                        blog_id: blogId
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('åšå®¢å·²ä»æŒ‘æˆ˜ä¸­ç§»å‡ºï¼');
                    // é‡æ–°åŠ è½½æŒ‘æˆ˜ä½œå“åˆ—è¡¨
                    viewChallengeBlogs(currentChallengeId);
                } else {
                    alert(result.message || 'ç§»å‡ºå¤±è´¥');
                }
            } catch (error) {
                console.error('ç§»å‡ºåšå®¢å¤±è´¥:', error);
                alert('ç§»å‡ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // è·å–å½“å‰æŒ‘æˆ˜ID
        function getCurrentChallengeId() {
            // ä»å…¨å±€å˜é‡æˆ–URLå‚æ•°è·å–å½“å‰æŒ‘æˆ˜ID
            // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
            return window.currentChallengeId;
        }

        // æŸ¥çœ‹ç‹—ç‹—æ’å
        async function viewPetRankings(challengeId) {
            try {
                // è·å–æŒ‘æˆ˜è¯¦æƒ…
                const challengeResponse = await fetch(`/petblog/api/challenges/${challengeId}`);
                const challengeResult = await challengeResponse.json();

                if (challengeResult.success) {
                    const challenge = challengeResult.challenge;

                    // å¡«å……æŒ‘æˆ˜ä¿¡æ¯
                    document.getElementById('rankingsTitle').textContent = challenge.challenge_title;
                    document.getElementById('rankingsDescription').textContent = challenge.challenge_description || 'æš‚æ— æè¿°';

                    // æ£€æŸ¥æŒ‘æˆ˜çŠ¶æ€
                    const status = getChallengeStatus(challenge.challenge_start_time, challenge.challenge_end_time);
                    document.getElementById('challengeStatus').textContent = `æŒ‘æˆ˜çŠ¶æ€ï¼š${status.text}`;

                    // è·å–ç‹—ç‹—æ’å
                    const rankingsResponse = await fetch(`/petblog/api/challenges/${challengeId}/pet-rankings`);
                    const rankingsResult = await rankingsResponse.json();

                    if (rankingsResult.success) {
                        const rankings = rankingsResult.rankings;

                        // å¦‚æœæŒ‘æˆ˜å·²ç»“æŸï¼Œæ˜¾ç¤ºè·èƒœè€…
                        if (status.type === 'ended') {
                            const winnersResponse = await fetch(`/petblog/api/challenges/${challengeId}/winners`);
                            const winnersResult = await winnersResponse.json();

                            if (winnersResult.success && winnersResult.winners.length > 0) {
                                document.getElementById('winnersSection').style.display = 'block';
                                document.getElementById('winnersList').innerHTML = winnersResult.winners.map(winner => `
                                    <div class="winner-card">
                                        <img src="${winner.pet_avatar_path || '/petblog/images/default-pet.png'}" alt="${winner.pet_name}" class="winner-avatar">
                                        <div class="winner-info">
                                            <div class="winner-name">${winner.pet_name}</div>
                                            <div class="winner-votes">${winner.vote_count} ç¥¨ | ä¸»äººï¼š${winner.owner_name}</div>
                                        </div>
                                        <div style="font-size: 2rem;">ğŸ†</div>
                                    </div>
                                `).join('');
                            } else {
                                document.getElementById('winnersSection').style.display = 'none';
                            }
                        } else {
                            document.getElementById('winnersSection').style.display = 'none';
                        }

                        // æ˜¾ç¤ºæ’ååˆ—è¡¨
                        const container = document.getElementById('petRankingsList');

                        if (rankings.length === 0) {
                            container.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">æš‚æ— å‚ä¸çš„ç‹—ç‹—</div>';
                        } else {
                            container.innerHTML = rankings.map((pet, index) => createPetRankingCard(pet, index)).join('');
                        }

                        // æ˜¾ç¤ºæ¨¡æ€æ¡†
                        document.getElementById('petRankingsModal').style.display = 'block';
                    } else {
                        alert('è·å–æ’åå¤±è´¥');
                    }
                } else {
                    alert('è·å–æŒ‘æˆ˜ä¿¡æ¯å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½ç‹—ç‹—æ’åå¤±è´¥:', error);
                alert('åŠ è½½ç‹—ç‹—æ’åå¤±è´¥');
            }
        }

        // åˆ›å»ºç‹—ç‹—æ’åå¡ç‰‡
        function createPetRankingCard(pet, index) {
            const ranking = pet.ranking;
            let cardClass = 'pet-ranking-card';
            let badgeClass = 'ranking-badge';
            let rankIcon = ranking;

            if (ranking === 1) {
                cardClass += ' winner';
                badgeClass += ' first';
                rankIcon = 'ğŸ¥‡';
            } else if (ranking === 2) {
                cardClass += ' second';
                badgeClass += ' second';
                rankIcon = 'ğŸ¥ˆ';
            } else if (ranking === 3) {
                cardClass += ' third';
                badgeClass += ' third';
                rankIcon = 'ğŸ¥‰';
            } else {
                badgeClass += ' other';
            }

            return `
                <div class="${cardClass}">
                    <div class="${badgeClass}">${rankIcon}</div>
                    <div class="pet-ranking-header">
                        <img src="${pet.pet_avatar_path || '/petblog/images/default-pet.png'}" alt="${pet.pet_name}" class="pet-ranking-avatar">
                        <div class="pet-ranking-info">
                            <div class="pet-ranking-name">${pet.pet_name}</div>
                            <div class="pet-ranking-breed">${pet.pet_breed}</div>
                            <div class="pet-ranking-owner">
                                <img src="${pet.owner_avatar || '/images/Default avatar.png'}" alt="${pet.owner_name}" class="owner-avatar">
                                <span>ä¸»äººï¼š${pet.owner_name}</span>
                            </div>
                        </div>
                    </div>
                    <div class="pet-ranking-stats">
                        <div class="stat-item">
                            <div class="stat-value">${pet.vote_count}</div>
                            <div class="stat-label">æŠ•ç¥¨æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${pet.blog_count}</div>
                            <div class="stat-label">ä½œå“æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">#${ranking}</div>
                            <div class="stat-label">æ’å</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // å…³é—­ç‹—ç‹—æ’åæ¨¡æ€æ¡†
        function closePetRankings() {
            document.getElementById('petRankingsModal').style.display = 'none';
        }

        // å…³é—­æŒ‘æˆ˜ä½œå“æ¨¡æ€æ¡†
        function closeChallengeBlogs() {
            document.getElementById('challengeBlogsModal').style.display = 'none';
        }

        // å…³é—­å‚ä¸æŒ‘æˆ˜æ¨¡æ€æ¡†
        function closeParticipateModal() {
            document.getElementById('participateModal').style.display = 'none';
            document.getElementById('participateBlogForm').reset();
            // æ¸…é™¤å® ç‰©é€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.pet-tag.selected').forEach(tag => {
                tag.classList.remove('selected');
            });
        }

        // å‚ä¸æŒ‘æˆ˜è¡¨å•æäº¤
        document.getElementById('participateBlogForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData(this);

            // è·å–é€‰ä¸­çš„å® ç‰©IDåˆ—è¡¨
            const selectedPetTags = document.querySelectorAll('#participatePetSelection .pet-tag.selected');
            const petIds = Array.from(selectedPetTags).map(tag => tag.dataset.petId).filter(id => id);

            // éªŒè¯æ˜¯å¦é€‰æ‹©äº†å® ç‰©
            if (petIds.length === 0) {
                alert('å‚ä¸æŒ‘æˆ˜å¿…é¡»é€‰æ‹©è‡³å°‘ä¸€åªç‹—ç‹—ï¼');
                return;
            }

            // æ·»åŠ å® ç‰©IDåˆ°è¡¨å•æ•°æ®
            formData.append('pet_ids', JSON.stringify(petIds));

            try {
                const response = await fetch('/petblog/api/blogs/add', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    alert('æˆåŠŸå‚ä¸æŒ‘æˆ˜ï¼åšå®¢å·²å‘å¸ƒï¼');
                    closeParticipateModal();
                    loadChallenges(); // é‡æ–°åŠ è½½æŒ‘æˆ˜åˆ—è¡¨
                } else {
                    alert(result.message || 'å‚ä¸æŒ‘æˆ˜å¤±è´¥');
                }
            } catch (error) {
                console.error('å‚ä¸æŒ‘æˆ˜å¤±è´¥:', error);
                alert('å‚ä¸æŒ‘æˆ˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        });

        // åˆ‡æ¢æŠ•ç¥¨çŠ¶æ€
        async function toggleVote(blogId, buttonElement) {
            try {
                const response = await fetch('/petblog/api/votes/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ blog_id: blogId })
                });

                const result = await response.json();

                if (result.success) {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    if (result.voted) {
                        buttonElement.classList.add('voted');
                        buttonElement.textContent = 'ğŸ‘ å·²æŠ•ç¥¨';
                    } else {
                        buttonElement.classList.remove('voted');
                        buttonElement.textContent = 'ğŸ‘ æŠ•ç¥¨';
                    }

                    // æ›´æ–°æŠ•ç¥¨æ•°
                    document.getElementById(`voteCount_${blogId}`).textContent = `${result.voteCount} ç¥¨`;

                    // æ›´æ–°åšå®¢çƒ­åº¦
                    updateBlogHeat(blogId);

                    // æ›´æ–°æŒ‘æˆ˜çƒ­åº¦ï¼ˆå¦‚æœåœ¨æŒ‘æˆ˜é¡µé¢ï¼‰
                    const currentChallengeId = getCurrentChallengeId();
                    if (currentChallengeId) {
                        updateChallengeHeat(currentChallengeId);
                    }
                } else {
                    alert(result.message || 'æŠ•ç¥¨å¤±è´¥');
                }
            } catch (error) {
                console.error('æŠ•ç¥¨å¤±è´¥:', error);
                alert('æŠ•ç¥¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // æ›´æ–°åšå®¢çƒ­åº¦æ˜¾ç¤º
        async function updateBlogHeat(blogId) {
            try {
                const response = await fetch(`/api/blogs/${blogId}/heat-details`);
                const result = await response.json();

                if (result.success) {
                    const heatElement = document.getElementById(`heat_${blogId}`);
                    if (heatElement) {
                        heatElement.textContent = formatHeat(result.heat);
                    }
                }
            } catch (error) {
                console.error('æ›´æ–°åšå®¢çƒ­åº¦å¤±è´¥:', error);
            }
        }

        // æ›´æ–°æŒ‘æˆ˜çƒ­åº¦æ˜¾ç¤º
        async function updateChallengeHeat(challengeId) {
            try {
                const response = await fetch(`/petblog/api/challenges/${challengeId}/heat`);
                const result = await response.json();

                if (result.success) {
                    const heatElement = document.getElementById(`heat_${challengeId}`);
                    if (heatElement) {
                        heatElement.textContent = formatHeat(result.heat);
                    }
                }
            } catch (error) {
                console.error('æ›´æ–°æŒ‘æˆ˜çƒ­åº¦å¤±è´¥:', error);
            }
        }

        // åŠ è½½åšå®¢çš„æŠ•ç¥¨çŠ¶æ€
        async function loadVoteStatus(blogId) {
            try {
                const response = await fetch(`/api/votes/status/${blogId}`);
                const result = await response.json();

                if (result.success) {
                    const button = document.querySelector(`[data-blog-id="${blogId}"]`);
                    const countElement = document.getElementById(`voteCount_${blogId}`);

                    if (button) {
                        if (result.userVoted) {
                            button.classList.add('voted');
                            button.textContent = 'ğŸ‘ å·²æŠ•ç¥¨';
                        } else {
                            button.classList.remove('voted');
                            button.textContent = 'ğŸ‘ æŠ•ç¥¨';
                        }
                    }

                    if (countElement) {
                        countElement.textContent = `${result.voteCount} ç¥¨`;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½æŠ•ç¥¨çŠ¶æ€å¤±è´¥:', error);
            }
        }

        // åˆ é™¤æŒ‘æˆ˜
        async function deleteChallenge(challengeId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæŒ‘æˆ˜å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚')) {
                return;
            }

            try {
                const response = await fetch(`/petblog/api/challenges/${challengeId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('æŒ‘æˆ˜åˆ é™¤æˆåŠŸï¼');
                    loadChallenges(); // é‡æ–°åŠ è½½æŒ‘æˆ˜åˆ—è¡¨
                } else {
                    alert(result.message || 'åˆ é™¤æŒ‘æˆ˜å¤±è´¥');
                }
            } catch (error) {
                console.error('åˆ é™¤æŒ‘æˆ˜å¤±è´¥:', error);
                alert('åˆ é™¤æŒ‘æˆ˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // æ˜¾ç¤ºçƒ­åº¦è¯¦æƒ…
        async function showHeatDetails(blogId) {
            try {
                const response = await fetch(`/api/blogs/${blogId}/heat-details`);
                const result = await response.json();

                if (result.success) {
                    const details = result.details;
                    const calculation = result.calculation;
                    
                    const detailsHtml = `
                        <div class="heat-details-modal">
                            <div class="heat-details-content">
                                <div class="heat-details-header">
                                    <h3>ğŸ”¥ åšå®¢çƒ­åº¦è¯¦æƒ…</h3>
                                    <button class="close-btn" onclick="closeHeatDetails()">Ã—</button>
                                </div>
                                <div class="heat-details-body">
                                    <div class="total-heat">
                                        <span class="total-heat-label">æ€»çƒ­åº¦ï¼š</span>
                                        <span class="total-heat-value">${formatHeat(result.heat)}</span>
                                    </div>
                                    <div class="heat-breakdown">
                                        <h4>çƒ­åº¦æ„æˆï¼š</h4>
                                        <div class="heat-item">
                                            <span class="heat-item-label">ğŸ‘ æŠ•ç¥¨ï¼š</span>
                                            <span class="heat-item-value">${details.votes}</span>
                                            <span class="heat-item-calculation">${calculation.votes}</span>
                                        </div>
                                        <div class="heat-item">
                                            <span class="heat-item-label">â¤ï¸ ç‚¹èµï¼š</span>
                                            <span class="heat-item-value">${details.likes}</span>
                                            <span class="heat-item-calculation">${calculation.likes}</span>
                                        </div>
                                        <div class="heat-item">
                                            <span class="heat-item-label">â­ æ”¶è—ï¼š</span>
                                            <span class="heat-item-value">${details.favorites}</span>
                                            <span class="heat-item-calculation">${calculation.favorites}</span>
                                        </div>
                                        <div class="heat-item">
                                            <span class="heat-item-label">ğŸ’¬ è¯„è®ºï¼š</span>
                                            <span class="heat-item-value">${details.replies}</span>
                                            <span class="heat-item-calculation">${calculation.replies}</span>
                                        </div>
                                        <div class="heat-item">
                                            <span class="heat-item-label">ğŸ”„ è½¬å‘ï¼š</span>
                                            <span class="heat-item-value">${details.reposts}</span>
                                            <span class="heat-item-calculation">${calculation.reposts}</span>
                                        </div>
                                    </div>
                                    <div class="heat-formula">
                                        <h4>è®¡ç®—å…¬å¼ï¼š</h4>
                                        <p>çƒ­åº¦ = æŠ•ç¥¨æ•°Ã—50 + ç‚¹èµæ•°Ã—20 + æ”¶è—æ•°Ã—20 + è¯„è®ºæ•°Ã—10 + è½¬å‘æ•°Ã—10</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    // åˆ›å»ºæ¨¡æ€æ¡†
                    const modal = document.createElement('div');
                    modal.id = 'heatDetailsModal';
                    modal.innerHTML = detailsHtml;
                    document.body.appendChild(modal);

                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    setTimeout(() => {
                        modal.style.display = 'flex';
                    }, 10);
                } else {
                    alert('è·å–çƒ­åº¦è¯¦æƒ…å¤±è´¥ï¼š' + result.message);
                }
            } catch (error) {
                console.error('è·å–çƒ­åº¦è¯¦æƒ…å¤±è´¥:', error);
                alert('è·å–çƒ­åº¦è¯¦æƒ…å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // å…³é—­çƒ­åº¦è¯¦æƒ…
        function closeHeatDetails() {
            const modal = document.getElementById('heatDetailsModal');
            if (modal) {
                modal.style.display = 'none';
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('heatDetailsModal');
            if (modal && event.target === modal) {
                closeHeatDetails();
            }
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const createModal = document.getElementById('createChallengeModal');
            const participateModal = document.getElementById('participateModal');
            const challengeBlogsModal = document.getElementById('challengeBlogsModal');
            const petRankingsModal = document.getElementById('petRankingsModal');

            if (event.target === createModal) {
                closeCreateModal();
            } else if (event.target === participateModal) {
                closeParticipateModal();
            } else if (event.target === challengeBlogsModal) {
                closeChallengeBlogs();
            } else if (event.target === petRankingsModal) {
                closePetRankings();
            }
        }
    </script>
</body>
</html>
