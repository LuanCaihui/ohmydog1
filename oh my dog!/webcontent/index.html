<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Oh my dogÔºÅ - ÂçöÂÆ¢ÂπøÂú∫</title>
    <style>
        :root {
            --primary-color: #3d8b7e;
            --secondary-color: #5ba898;
            --accent-color: #7bc5b7;
            --background-color: #edf6f5;
            --card-background: #ffffff;
            --border-color: #d4ede9;
            --text-primary: #2a4f49;
            --text-secondary: #3e6b61;
            --blue-accent: #6fa5c3;
            --blue-light: #a8c8da;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('/petblog/images/index.png') no-repeat center center fixed;
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            position: relative;
        }

        /* ‰∏∫‰∫ÜÁ°Æ‰øùÂÜÖÂÆπÂú®ËÉåÊôØÂõæÁâá‰∏äÊ∏ÖÊô∞ÂèØËßÅÔºåÊ∑ªÂä†‰∏Ä‰∏™ÂçäÈÄèÊòéÈÅÆÁΩ© */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            z-index: -1;
            pointer-events: none;
        }
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--blue-accent) 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(74, 155, 142, 0.2);
        }
        .nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 60px;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-decoration: none;
            letter-spacing: 1px;
        }
        .nav-links a {
            margin-left: 24px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            border-radius: 20px;
            padding: 8px 16px;
            transition: background 0.2s, color 0.2s;
            position: relative;
        }
        .nav-links a:hover, .nav-links a.active {
            background: rgba(255,255,255,0.12);
            color: #fff;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }


        /* Ê®™ÂπÖÂõæÁâáÂå∫ÂüüÊ†∑Âºè */
        .hero-banner {
            width: 100%;
            height: 250px;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .hero-image {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top;
            transform: scale(1.1);
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                135deg,
                rgba(74, 155, 142, 0.3) 0%,
                rgba(107, 183, 168, 0.25) 50%,
                rgba(133, 193, 184, 0.2) 100%
            );
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-text {
            text-align: center;
            color: white;
            z-index: 2;
            animation: heroFadeIn 1.5s ease-out;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 900;
            margin: 0 0 15px 0;
            letter-spacing: 3px;
            color: #ffffff;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0 0 20px 0;
            opacity: 1;
            letter-spacing: 1px;
            color: #ffffff;
        }

        .hero-decorations {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .paw-print {
            font-size: 2rem;
            animation: pawBounce 2s ease-in-out infinite;
        }

        .paw-print:nth-child(1) {
            animation-delay: 0s;
        }

        .paw-print:nth-child(2) {
            animation-delay: 0.3s;
        }

        .paw-print:nth-child(3) {
            animation-delay: 0.6s;
        }

        /* Âä®ÁîªÊïàÊûú */
        @keyframes heroFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pawBounce {
            0%, 100% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-10px) scale(1.1);
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .hero-banner {
                height: 180px;
            }

            .hero-title {
                font-size: 2.5rem;
                letter-spacing: 2px;
            }

            .hero-subtitle {
                font-size: 1rem;
            }

            .paw-print {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .hero-banner {
                height: 140px;
            }

            .hero-title {
                font-size: 2rem;
                letter-spacing: 1px;
            }

            .hero-subtitle {
                font-size: 0.9rem;
            }
        }

        /* Âä†ÂÆΩËØùÈ¢òÂπøÂú∫ */
        .topic-aside {
            background: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(74, 155, 142, 0.1);
            border: 1px solid var(--border-color);
            padding: 12px 14px 8px 14px !important;
            margin-bottom: 10px !important;
            width: 300px !important;
            min-width: 220px !important;
            max-width: 340px !important;
            margin-left: 200px !important;
            margin-right: 0 !important;
            height: fit-content !important;
            align-self: flex-start !important;
        }
        .topic-aside-card {
            background: none;
            border: none;
            box-shadow: none;
            border-radius: 0;
            padding: 0;
        }
        .topic-aside-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 0;
            margin: 0;
            list-style: none;
        }
        .topic-aside-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            background: #eaf6ff;
            border-radius: 18px;
            padding: 8px 18px;
            border: 1px solid #b3e0ff;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            cursor: pointer;
            font-size: 15px;
            margin-bottom: 0;
            width: 100%;
            box-sizing: border-box;
        }
        .topic-aside-link span:first-child {
            font-size: 16px;
            flex-shrink: 0;
        }
        .topic-aside-link:hover {
            background: #3498db;
            color: #fff;
            box-shadow: 0 2px 8px rgba(74,155,142,0.10);
            text-decoration: none;
        }

        /* Â∑¶‰æßÂÜÖÂÆπÂå∫Âüü */
        .content-left {
            flex: 2;
            max-width: 700px;
            background: rgba(255,255,255,0.75); /* ÂçäÈÄèÊòéÁôΩËâ≤ */
            border-radius: 20px;
            box-shadow: 0 6px 32px rgba(74,155,142,0.10);
            padding: 24px 18px 24px 18px;
            margin-bottom: 24px;
        }

        .content-right {
            flex: 1;
            max-width: 350px;
        }

        /* ÁÉ≠Èó®ÊåëÊàòÊéíË°åÊ¶úÊ†∑Âºè */
        .hot-challenges {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(74, 155, 142, 0.12);
            border: 1px solid rgba(74, 155, 142, 0.1);
            padding: 24px;
            margin-bottom: 20px;
            position: sticky;
            top: 20px;
            backdrop-filter: blur(10px);
        }

        .hot-challenges-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(74, 155, 142, 0.15);
            position: relative;
        }

        .hot-challenges-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 1px;
        }

        .hot-challenges-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            letter-spacing: 0.5px;
        }

        .hot-challenges-icon {
            font-size: 1.5rem;
            animation: flame 2s ease-in-out infinite;
        }

        @keyframes flame {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        .challenge-rank-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            margin-bottom: 8px;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(74, 155, 142, 0.08);
            position: relative;
            overflow: hidden;
        }

        .challenge-rank-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 155, 142, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .challenge-rank-item:hover::before {
            left: 100%;
        }

        .challenge-rank-item:last-child {
            margin-bottom: 0;
        }

        .challenge-rank-item:hover {
            background: rgba(74, 155, 142, 0.05);
            border-color: rgba(74, 155, 142, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 155, 142, 0.15);
        }

        .rank-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .rank-number.top1 {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #b8860b;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }

        .rank-number.top2 {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: #666;
            box-shadow: 0 4px 12px rgba(192, 192, 192, 0.3);
        }

        .rank-number.top3 {
            background: linear-gradient(135deg, #cd7f32, #deb887);
            color: #8b4513;
            box-shadow: 0 4px 12px rgba(205, 127, 50, 0.3);
        }

        .rank-number.other {
            background: linear-gradient(135deg, var(--background-color), #e8f5f3);
            color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(74, 155, 142, 0.2);
        }

        .challenge-rank-info {
            flex: 1;
            min-width: 0;
        }

        .challenge-rank-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            line-height: 1.3;
        }

        .challenge-rank-heat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #ff6b6b;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .challenge-rank-heat span:first-child {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .challenge-rank-status {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-ongoing {
            background: linear-gradient(135deg, #d1ecf1, #b8e6f0);
            color: #0c5460;
            box-shadow: 0 2px 6px rgba(13, 84, 96, 0.2);
        }

        .status-planning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            box-shadow: 0 2px 6px rgba(133, 100, 4, 0.2);
        }

        .status-ended {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            box-shadow: 0 2px 6px rgba(114, 28, 36, 0.2);
        }

        .view-all-challenges {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid rgba(74, 155, 142, 0.1);
            position: relative;
        }

        .view-all-btn {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(74, 155, 142, 0.1);
            border: 1px solid rgba(74, 155, 142, 0.2);
            display: inline-block;
            position: relative;
            overflow: hidden;
        }

        .view-all-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 155, 142, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .view-all-btn:hover::before {
            left: 100%;
        }

        .view-all-btn:hover {
            color: white;
            background: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 155, 142, 0.3);
        }

        /* ÂèëÂ∏ÉÂÖ•Âè£Ê†∑Âºè */
        .quick-post-bar {
            background: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(74, 155, 142, 0.1);
            border: 1px solid var(--border-color);
            padding: 18px 22px 12px 22px;
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 18px;
            transition: all 0.3s ease;
        }

        .quick-post-bar:hover {
            box-shadow: 0 6px 30px rgba(74, 155, 142, 0.15);
            transform: translateY(-2px);
            border-color: var(--accent-color);
        }
        .quick-post-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e0e0e0;
        }
        .quick-post-input {
            flex: 1;
            background: #f4f6fa;
            border: none;
            border-radius: 20px;
            padding: 12px 18px;
            font-size: 15px;
            color: #333;
            outline: none;
            transition: box-shadow 0.2s;
        }
        .quick-post-input:focus {
            box-shadow: 0 0 0 2px #3498db33;
        }
        .quick-post-btn {
            background: var(--secondary-color);
            color: #fff;
            border: none;
            border-radius: 20px;
            padding: 8px 22px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quick-post-btn:hover {
            background: var(--primary-color);
            transform: translateY(-1px);
        }
        /* ÂºπÁ™ó */
        #postModal {
            display: none;
            position: fixed;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(74, 155, 142, 0.15);
            backdrop-filter: blur(8px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        #postModal form {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            min-width: 400px;
            max-width: 95vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 50px rgba(74, 155, 142, 0.2);
            padding: 32px 32px 18px 32px;
            position: relative;
        }
        #postModal h2 {
            margin: 0 0 18px 0;
            font-size: 20px;
            color: var(--primary-color);
        }
        #postModal .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 14px;
        }
        #postModal label {
            min-width: 60px;
            color: #555;
            font-weight: 500;
        }
        #postModal input[type="text"],
        #postModal textarea,
        #postModal select {
            flex: 1;
            padding: 10px;
            border: 1.5px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            background: #fafbfc;
            transition: border-color 0.2s;
        }
        #postModal input[type="text"]:focus,
        #postModal textarea:focus,
        #postModal select:focus {
            border-color: #3498db;
            outline: none;
        }
        #postModal textarea {
            min-height: 80px;
            resize: vertical;
        }
        #postModal input[type="file"] {
            border: none;
            background: none;
        }
        #postModal .topic-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        #postModal .topic-item {
            background: #eaf6ff;
            color: #3498db;
            border-radius: 16px;
            padding: 2px 12px;
            font-size: 14px;
            cursor: pointer;
            border: 1px solid #b3e0ff;
            transition: background 0.2s;
        }
        #postModal .topic-item.selected {
            background: #3498db;
            color: #fff;
        }
        #postModal .btn {
            background: var(--secondary-color);
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 10px 28px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        #postModal .btn:hover {
            background: #217dbb;
        }
        #postModal .close-btn {
            position: absolute;
            right: 18px;
            top: 18px;
            background: none;
            border: none;
            font-size: 22px;
            color: #888;
            cursor: pointer;
        }

        /* ÁºñËæëÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(74, 155, 142, 0.15);
            backdrop-filter: blur(8px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            min-width: 400px;
            max-width: 95vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 50px rgba(74, 155, 142, 0.2);
            padding: 32px 32px 18px 32px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
            color: var(--primary-color);
        }

        .modal .close {
            font-size: 28px;
            font-weight: bold;
            color: #888;
            cursor: pointer;
            line-height: 1;
        }

        .modal .close:hover {
            color: #333;
        }

        .modal .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 14px;
            align-items: flex-start;
        }

        .modal label {
            min-width: 80px;
            color: #555;
            font-weight: 500;
            padding-top: 10px;
        }

        .modal input[type="text"],
        .modal textarea,
        .modal select {
            flex: 2;
            padding: 10px;
            border: 1.5px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            background: #fafbfc;
            transition: border-color 0.2s;
        }

        .modal input[type="text"]:focus,
        .modal textarea:focus,
        .modal select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .modal textarea {
            min-height: 120px;
            resize: vertical;
        }

        .modal input[type="file"] {
            border: none;
            background: none;
            flex: 2;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .form-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* ÂÆ†Áâ©ÈÄâÊã©Ê†∑Âºè */
        #editPetSelection {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            max-height: 120px;
            overflow-y: auto;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fafbfc;
        }

        .pet-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f0f8f7;
            border: 1px solid var(--accent-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .pet-tag:hover {
            background: var(--accent-color);
            color: white;
        }

        .pet-tag.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .pet-tag img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
        }
        /* ÂçöÂÆ¢ÊµÅ */
        .blog-list {
            display: flex;
            flex-direction: column;
            gap: 10px; /* Âéü22pxÔºåË∞ÉÂ∞è‰∏∫10px */
        }
        .blog-card {
            background: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(74, 155, 142, 0.1);
            border: 1px solid var(--border-color);
            padding: 16px 18px 10px 18px; /* paddingÁï•Ë∞ÉÂ∞è */
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            margin-bottom: 8px; /* Âéü16pxÔºåË∞ÉÂ∞è‰∏∫8px */
        }

        .blog-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 35px rgba(74, 155, 142, 0.15);
            border-color: var(--accent-color);
        }
        .blog-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .blog-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            border: 2px solid #e0e0e0;
        }
        .blog-user-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .blog-user-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 15px;
        }
        .blog-time {
            color: #888;
            font-size: 12px;
            margin-left: 8px;
        }
        .blog-title {
            font-size: 17px;
            font-weight: bold;
            color: #3498db;
            margin: 6px 0 6px 0;
        }
        .blog-content {
            color: #333;
            font-size: 15px;
            margin-bottom: 8px;
            white-space: pre-line;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            max-height: 4.8em; /* 3Ë°å * 1.6em Ë°åÈ´ò */
            line-height: 1.6em;
        }

        .blog-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }


        .blog-attachment {
            margin-bottom: 6px;
        }
        .blog-column {
            display: inline-block;
            background: #f5eaff;
            color: #8e44ad;
            border-radius: 12px;
            padding: 2px 10px;
            font-size: 12px;
            margin-right: 8px;
        }
        .blog-topics {
            display: flex;
            gap: 8px;
            margin-top: 2px;
        }
        .blog-topic {
            background: #eaf6ff;
            color: #3498db;
            border-radius: 16px;
            padding: 2px 12px;
            font-size: 13px;
            border: 1px solid #b3e0ff;
        }
        
        /* ÁÇπËµûÂäüËÉΩÊ†∑Âºè */
        .blog-actions {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }
        
        .like-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.2s ease;
            color: #666;
            font-size: 14px;
        }
        
        .like-btn:hover {
            background: #f8f9fa;
        }
        
        .like-btn.liked {
            color: #e74c3c;
        }
        
        .like-btn.liked:hover {
            background: #fff5f5;
        }
        
        .like-icon {
            font-size: 16px;
            transition: transform 0.2s ease;
        }
        
        .like-btn.liked .like-icon {
            transform: scale(1.1);
        }
        
        .like-count {
            font-weight: 500;
        }
        
        /* Êî∂ËóèÂäüËÉΩÊ†∑Âºè */
        .favorite-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.2s ease;
            color: #666;
            font-size: 14px;
        }
        
        .favorite-btn:hover {
            background: #f8f9fa;
        }
        
        .favorite-btn.favorited {
            color: #f39c12;
        }
        
        .favorite-btn.favorited:hover {
            background: #fff8e1;
        }
        
        .favorite-icon {
            font-size: 16px;
            transition: transform 0.2s ease;
        }
        
        .favorite-btn.favorited .favorite-icon {
            transform: scale(1.1);
        }
        
        .favorite-count {
            font-weight: 500;
        }

        /* ËΩ¨ÂèëÂäüËÉΩÊ†∑Âºè */
        .repost-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.2s ease;
            color: #666;
            font-size: 14px;
        }

        .repost-btn:hover {
            background: #f8f9fa;
        }

        .repost-btn.reposted {
            color: #17a2b8;
        }

        .repost-btn.reposted:hover {
            background: #e1f7fa;
        }

        .repost-icon {
            font-size: 16px;
            transition: transform 0.2s ease;
        }

        .repost-btn.reposted .repost-icon {
            transform: scale(1.1);
        }

        .repost-count {
            font-weight: 500;
        }

        /* ÂÖ≥Ê≥®ÂäüËÉΩÊ†∑Âºè */
        .follow-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.2s ease;
            color: #666;
            font-size: 14px;
        }
        
        .follow-btn:hover {
            background: #f8f9fa;
        }
        
        .follow-btn.followed {
            color: #27ae60;
        }
        
        .follow-btn.followed:hover {
            background: #e8f5e8;
        }
        
        .follow-icon {
            font-size: 16px;
            transition: transform 0.2s ease;
        }
        
        .follow-btn.followed .follow-icon {
            transform: scale(1.1);
        }
        
        .follower-count {
            font-weight: 500;
        }
        
        /* Áî®Êà∑‰ø°ÊÅØÂå∫ÂüüÊ†∑Âºè */
        .blog-user-stats {
            display: flex;
            gap: 15px;
            margin-top: 4px;
            font-size: 12px;
            color: #888;
        }

        /* ËØÑËÆ∫ÂäüËÉΩÊ†∑Âºè */
        .comment-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            transition: all 0.2s ease;
            color: #666;
            font-size: 14px;
        }

        .comment-btn:hover {
            background: #f8f9fa;
        }

        .edit-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .edit-btn:hover {
            background: #f0f8f7;
            color: var(--primary-color);
        }

        .edit-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .edit-btn:hover {
            background: #f0f8f7;
            color: var(--primary-color);
        }

        .comment-icon {
            font-size: 16px;
        }

        .comment-count {
            font-weight: 500;
        }

        /* ËØÑËÆ∫Âå∫ÂüüÊ†∑Âºè */
        .comments-section {
            margin-top: 15px;
            border-top: 1px solid #f0f0f0;
            padding-top: 15px;
            display: none;
        }

        .comments-section.show {
            display: block;
        }

        .comment-input-area {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .comment-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .comment-input:focus {
            border-color: #3498db;
        }

        .comment-submit-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .comment-submit-btn:hover {
            background: var(--primary-color);
            transform: translateY(-1px);
        }

        /* ÂÆ†Áâ©ÈÄâÊã©Ê†∑Âºè - Â§öÈÄâÊåâÈíÆÂΩ¢Âºè */
        #petSelection {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .pet-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            font-size: 14px;
            position: relative;
        }

        .pet-tag:hover {
            border-color: var(--accent-color);
            background: #f0f8f7;
        }

        .pet-tag.selected {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
            color: white;
        }

        .pet-tag img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
        }

        .pet-tag-name {
            font-weight: 500;
        }

        .no-pet-tag {
            background: #f8f9fa;
            border-color: #dee2e6;
            color: #6c757d;
        }

        .no-pet-tag.selected {
            background: #6c757d;
            border-color: #6c757d;
            color: white;
        }

        /* ÂçöÂÆ¢‰∏≠ÊòæÁ§∫ÁöÑÂÆ†Áâ©‰ø°ÊÅØ */
        .blog-pets {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
        }

        .blog-pets-title {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .blog-pet-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .blog-pet-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: #f0f8f7;
            border-radius: 12px;
            font-size: 12px;
            color: var(--text-primary);
        }

        .blog-pet-item img {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Âà†Èô§ÂçöÂÆ¢ÊåâÈíÆÊ†∑Âºè */
        .delete-blog-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s ease;
        }

        .delete-blog-btn:hover {
            background: #c82333;
        }

        .delete-blog-btn:active {
            transform: translateY(1px);
        }

        /* Êñá‰ª∂ÂàóË°®Ê†∑Âºè */
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 8px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .file-item-info {
            flex: 1;
            overflow: hidden;
        }

        .file-item-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-item-size {
            color: #666;
            font-size: 11px;
        }

        .file-remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 6px;
            cursor: pointer;
            font-size: 11px;
        }

        .comment-submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .comments-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .comment-item {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            padding: 12px;
            background: #f8fffe;
            border: 1px solid var(--border-color);
            border-radius: 12px;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .comment-content {
            flex: 1;
        }

        .comment-user-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .comment-text {
            color: #333;
            font-size: 14px;
            margin-bottom: 4px;
            word-wrap: break-word;
        }

        .comment-time {
            color: #888;
            font-size: 12px;
        }

        .comment-actions {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .comment-reply-btn, .comment-delete-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 12px;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .comment-reply-btn:hover {
            background: #e3f2fd;
            color: #3498db;
        }

        .comment-delete-btn:hover {
            background: #ffebee;
            color: #e74c3c;
        }

        .reply-comment {
            margin-left: 42px;
            border-left: 2px solid #e0e0e0;
            padding-left: 10px;
        }

        .reply-indicator {
            color: #3498db;
            font-size: 12px;
            margin-bottom: 4px;
        }

        /* ‰∏æÊä•ÂºπÁ™óÊ†∑Âºè */
        .modal-overlay {position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;z-index:9999;}
        .modal-content {background:#fff;padding:32px 24px;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.15);min-width:320px;max-width:90vw;}

        .topic-tag-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .topic-tag { background: #eaf6ff; color: #3498db; border-radius: 16px; padding: 4px 16px; font-size: 14px; cursor: pointer; border: 1px solid #b3e0ff; transition: background 0.2s; user-select: none; }
        .topic-tag.selected { background: #3498db; color: #fff; }

        .topic-aside-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        .topic-aside-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            background: #eaf6ff;
            border-radius: 18px;
            padding: 8px 18px;
            border: 1px solid #b3e0ff;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .topic-aside-link:hover {
            background: #3498db;
            color: #fff;
            box-shadow: 0 2px 8px rgba(74,155,142,0.10);
            text-decoration: none;
        }
        .main-content {
            max-width: 1200px;
            margin-left: 0;
            margin-right: 0;
            padding: 0 20px 40px 0;
            display: flex;
            gap: 550x;
            flex: 1;
        }
        .main-content-wrapper {
            display: flex;
            margin-left: 70px;
            justify-content: flex-start;
            align-items: flex-start;
        }
        .recommend-follows-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(74, 155, 142, 0.08);
            border: 1px solid #e0f2ef;
            padding: 18px 16px 12px 16px;
            margin-bottom: 20px;
        }
        .recommend-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #3d8b7e;
            margin-bottom: 12px;
        }
        .recommend-user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .recommend-user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 1.5px solid #e0f2ef;
        }
        .recommend-user-info {
            flex: 1;
        }
        .recommend-user-name {
            font-weight: 600;
            color: #2a4f49;
            font-size: 15px;
        }
        .recommend-user-stats {
            font-size: 12px;
            color: #888;
        }
        .recommend-follow-btn {
            background: #3d8b7e;
            color: #fff;
            border: none;
            border-radius: 16px;
            padding: 6px 16px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .recommend-follow-btn:hover {
            background: #217dbb;
        }
        /* ÊåëÊàò/ÁãóÁãóÈÄâÊã©ÂºπÁ™óÁæéÂåñ */
        #challengeSelectModal .select-section-title {
          font-size: 15px;
          font-weight: 700;
          color: #3d8b7e;
          margin-bottom: 8px;
          margin-top: 8px;
        }
        #challengeSelectModal .select-list {
          display: flex;
          flex-wrap: wrap;
          gap: 12px;
          margin-bottom: 10px;
        }
        #challengeSelectModal .challenge-card, #challengeSelectModal .pet-card {
          background: #f8f9fa;
          border-radius: 12px;
          box-shadow: 0 2px 8px rgba(74,155,142,0.08);
          border: 2px solid #e0e0e0;
          padding: 12px 18px;
          min-width: 180px;
          cursor: pointer;
          transition: all 0.2s;
          display: flex;
          align-items: center;
          gap: 10px;
          position: relative;
        }
        #challengeSelectModal .challenge-card.selected, #challengeSelectModal .pet-card.selected {
          border-color: #ff9800;
          background: #fffbe6;
          box-shadow: 0 4px 16px rgba(255,152,0,0.10);
        }
        #challengeSelectModal .challenge-card:hover, #challengeSelectModal .pet-card:hover {
          border-color: #7bc5b7;
          background: #eaf6ff;
          box-shadow: 0 4px 16px rgba(74,155,142,0.12);
        }
        #challengeSelectModal .challenge-title {
          font-weight: 600;
          color: #3498db;
          font-size: 16px;
        }
        #challengeSelectModal .challenge-time {
          color: #888;
          font-size: 13px;
          margin-left: 6px;
        }
        #challengeSelectModal .pet-avatar {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          object-fit: cover;
          border: 1.5px solid #e0e0e0;
          background: #fff;
        }
        #challengeSelectModal .pet-name {
          font-weight: 500;
          color: #2a4f49;
          font-size: 15px;
        }
    </style>
</head>
<body>
    <header>
        <div class="nav">
            <a href="/petblog/index.html" class="logo">Oh my dogÔºÅ</a>
            <div class="nav-links">
                <a href="/petblog/index.html" class="active">È¶ñÈ°µ</a>
                <a href="/petblog/challenges.html" id="nav-topics">ÊåëÊàò</a>
                <a href="/petblog/consultation.html">Êô∫ËÉΩÈóÆËØä</a>
                <a href="/petblog/notifications.html" id="nav-notifications">ÈÄöÁü•<span id="notification-badge" class="notification-badge" style="display: none;">0</span></a>
                <a href="/petblog/profile.html">‰∏™‰∫∫‰∏≠ÂøÉ</a>
                <a href="javascript:void(0)" onclick="logout()">ÈÄÄÂá∫ÁôªÂΩï</a>
            </div>
        </div>
    </header>

    <!-- Ê®™ÂπÖÂõæÁâáÂå∫Âüü -->
    <div class="hero-banner">
        <div class="hero-image">
            <img src="/petblog/images/index1.png" alt="OH MY DOG Banner" />
            <div class="hero-overlay">
                <div class="hero-text">
                    <h1 class="hero-title">OH MY DOG!</h1>
                    <p class="hero-subtitle">ÂàÜ‰∫´‰Ω†‰∏éÁãóÁãóÁöÑÁæéÂ•ΩÊó∂ÂÖâ</p>
                    <div class="hero-decorations">
                        <span class="paw-print">üêæ</span>
                        <span class="paw-print">üêæ</span>
                        <span class="paw-print">üêæ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content-wrapper">
        <!-- ËØùÈ¢òÊ®°Âùó -->
        <aside class="topic-aside">
            <div class="topic-aside-card">
                <div style="font-size: 1.15rem; font-weight: 700; color: var(--primary-color); margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 1.5rem;">#Ô∏è‚É£</span> ËØùÈ¢òÂπøÂú∫
                </div>
                <ul class="topic-aside-list"></ul>
            </div>
        </aside>
        <div class="main-content">
            <!-- Â∑¶‰æßÂÜÖÂÆπÂå∫Âüü -->
            <div class="content-left">
                <!-- Âø´ÈÄüÂèëÂ∏ÉÂÖ•Âè£ -->
                <div class="quick-post-bar">
                    <img class="quick-post-avatar" id="quickPostAvatar" src="/petblog/images/Default avatar.png" alt="Â§¥ÂÉè">
                    <input class="quick-post-input" id="quickPostInput" placeholder="Êúâ‰ªÄ‰πàÊñ∞È≤ú‰∫ãÊÉ≥ÂàÜ‰∫´ÁªôÂ§ßÂÆ∂Ôºü" readonly onclick="showPostModal()">
                    <button class="quick-post-btn" onclick="showPostModal()">ÂèëÂ∏É</button>
                </div>
            <!-- ÂèëÂ∏ÉÂºπÁ™ó -->
            <div id="postModal">
                <form id="blogPostForm" enctype="multipart/form-data">
                    <button type="button" class="close-btn" onclick="hidePostModal()">√ó</button>
                    <h2>ÂèëÂ∏ÉÊñ∞ÂçöÂÆ¢</h2>

                    <!-- ÂçöÂÆ¢Ê†áÈ¢ò -->
                    <div class="form-row">
                        <label>Ê†áÈ¢ò</label>
                        <input type="text" name="blog_title" id="blog_title" required placeholder="ËØ∑ËæìÂÖ•ÂçöÂÆ¢Ê†áÈ¢ò" style="flex:2;">
                    </div>

                    <!-- ÂçöÂÆ¢ÂÜÖÂÆπ -->
                    <div class="form-row">
                        <label>ÂÜÖÂÆπ</label>
                        <textarea name="blog_content" id="blog_content" required placeholder="ÂàÜ‰∫´ÊÇ®ÁöÑÊÉ≥Ê≥ï..." style="min-height: 120px;"></textarea>
                    </div>

                    <!-- ÈÄâÊã©ÁãóÁãó -->
                    <div class="form-row">
                        <label>ÈÄâÊã©ÁãóÁãó</label>
                        <div id="petSelection" style="flex:2;">
                            <div style="color: #666; text-align: center; padding: 10px;">Ê≠£Âú®Âä†ËΩΩÁãóÁãóÂàóË°®...</div>
                        </div>
                    </div>

                    <!-- ÈÄâÊã©‰∏ìÊ†è -->
                    <div class="form-row">
                        <label>‰∏ìÊ†è</label>
                        <div style="flex:2; display: flex; gap: 8px; align-items: center;">
                            <select name="column_id" id="column_id" style="flex:1;">
                                <option value="">‰∏çÈÄâÊã©‰∏ìÊ†è</option>
                            </select>
                            <button type="button" id="quickCreateColumn" style="padding: 8px 12px; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap;">Êñ∞Âª∫</button>
                        </div>
                    </div>

                    <!-- ÊåëÊàòÂäüËÉΩÂ∑≤ÁßªËá≥ÊåëÊàòÈ°µÈù¢ -->

                    <!-- ÈôÑ‰ª∂‰∏ä‰º† -->
                    <div class="form-row">
                        <label>ÈôÑ‰ª∂</label>
                        <div style="flex:2;">
                            <input type="file" name="files" multiple accept="*/*" id="fileInput" style="width: 100%;">
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">ÊúÄÂ§ö5‰∏™Êñá‰ª∂ÔºåÊØè‰∏™‰∏çË∂ÖËøá10MB</div>
                            <div id="fileList" style="margin-top: 8px;"></div>
                        </div>
                    </div>

                    <!-- ÂçöÂÆ¢ÂèëÂ∏ÉË°®Âçï‰∏≠ÔºåÂø´ÈÄüÂèëÂ∏ÉÂÖ•Âè£‰∏ãÊñπÔºåÈÄâÊã©ËØùÈ¢ò -->
                    <div class="form-row">
                        <label>ÈÄâÊã©ËØùÈ¢ò</label>
                        <div id="topicTagSelection" class="topic-tag-list"></div>
                    </div>

                    <div style="text-align:right;margin-top:20px;">
                        <button type="submit" class="btn">ÂèëÂ∏ÉÂçöÂÆ¢</button>
                    </div>
                </form>
            </div>
                <!-- ÂçöÂÆ¢ÊµÅÂå∫ -->
                <div class="blog-list" id="blogList">
                    <!-- ÂçöÂÆ¢Âç°ÁâáÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÂä†ËΩΩ -->
                </div>
            </div>

            <!-- Âè≥‰æßÂÜÖÂÆπÂå∫Âüü -->
            <div class="content-right">
                <!-- ÁÉ≠Èó®ÊåëÊàòÊéíË°åÊ¶ú -->
                <div class="hot-challenges" style="margin-bottom:30px; max-width:400px; margin-left:auto; margin-right:auto;">
                    <div class="hot-challenges-header">
                        <span class="hot-challenges-icon">üî•</span>
                        <h3 class="hot-challenges-title">ÁÉ≠Èó®ÊåëÊàò</h3>
                    </div>
                    <div id="hotChallengesList">
                        <div style="text-align: center; color: #666; padding: 20px;">Ê≠£Âú®Âä†ËΩΩ...</div>
                    </div>
                    <div class="view-all-challenges">
                        <a href="/petblog/challenges.html" class="view-all-btn">Êü•ÁúãÂÖ®ÈÉ®ÊåëÊàò ‚Üí</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÁºñËæëÂçöÂÆ¢Ê®°ÊÄÅÊ°Ü -->
    <div id="editModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÁºñËæëÂçöÂÆ¢</h2>
                <span class="close" onclick="hideEditModal()">&times;</span>
            </div>
            <form id="blogEditForm" enctype="multipart/form-data">
                <input type="hidden" id="editBlogId" name="blog_id">

                <div class="form-row">
                    <label>Ê†áÈ¢ò</label>
                    <input type="text" name="blog_title" id="editBlogTitle" required maxlength="100" placeholder="ËØ∑ËæìÂÖ•ÂçöÂÆ¢Ê†áÈ¢ò">
                </div>

                <div class="form-row">
                    <label>ÂÜÖÂÆπ</label>
                    <textarea name="blog_content" id="editBlogContent" required placeholder="ÂàÜ‰∫´ÊÇ®ÁöÑÊÉ≥Ê≥ï..."></textarea>
                </div>

                <!-- ÈÄâÊã©‰∏ìÊ†è -->
                <div class="form-row">
                    <label>‰∏ìÊ†è</label>
                    <div style="flex:2; display: flex; gap: 8px; align-items: center;">
                        <select name="column_id" id="editColumnId" style="flex:1;">
                            <option value="">‰∏çÈÄâÊã©‰∏ìÊ†è</option>
                        </select>
                        <button type="button" id="editQuickCreateColumn" style="padding: 8px 12px; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap;">Êñ∞Âª∫</button>
                    </div>
                </div>

                <!-- ÈÄâÊã©ÁãóÁãó -->
                <div class="form-row">
                    <label>ÈÄâÊã©ÁãóÁãó</label>
                    <div id="editPetSelection" style="flex:2;">
                        <!-- ÂÆ†Áâ©Ê†áÁ≠æÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÂä†ËΩΩ -->
                    </div>
                </div>

                <div class="form-row">
                    <label>ÈôÑ‰ª∂</label>
                    <input type="file" name="files" multiple accept="*/*" style="flex:2;">
                    <div style="font-size: 12px; color: #666; margin-top: 4px;">ÊúÄÂ§ö5‰∏™Êñá‰ª∂ÔºåÊØè‰∏™‰∏çË∂ÖËøá10MB</div>
                </div>

                <!-- ÁºñËæëÂçöÂÆ¢Ë°®Âçï‰∏≠ÔºåÈÄâÊã©ËØùÈ¢ò -->
                <div class="form-row">
                    <label>ÈÄâÊã©ËØùÈ¢ò</label>
                    <div id="editTopicTagSelection" class="topic-tag-list"></div>
                </div>

                <div class="form-actions">
                    <button type="button" onclick="hideEditModal()" style="background: #ccc; color: #666;">ÂèñÊ∂à</button>
                    <button type="submit" style="background: var(--primary-color); color: white;">‰øùÂ≠ò‰øÆÊîπ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‰∏æÊä•ÂºπÁ™ó -->
    <div id="reportModal" class="modal-overlay" style="display:none;">
      <div class="modal-content">
        <h3 style="margin-bottom: 16px; color: #e74c3c;">‰∏æÊä•ÂçöÂÆ¢</h3>
        <textarea id="reportReason" placeholder="ËØ∑ËæìÂÖ•‰∏æÊä•ÁêÜÁî±..." style="width:100%;min-height:80px;padding:10px;border-radius:8px;border:1px solid #ddd;"></textarea>
        <div style="margin-top:16px;text-align:right;">
          <button onclick="hideReportModal()" style="margin-right:10px;">ÂèñÊ∂à</button>
          <button id="submitReportBtn" style="background:#e74c3c;color:#fff;border:none;padding:8px 20px;border-radius:8px;">Êèê‰∫§‰∏æÊä•</button>
        </div>
      </div>
    </div>

    <!-- Âä®ÊÄÅÂπøÂú∫ -->
    <div>
      <h2>Âä®ÊÄÅÂπøÂú∫</h2>
      <div id="dynamicSquareList"></div>
    </div>
    <script>
        // ÁºñËæëÂçöÂÆ¢Ë°®ÂçïÊèê‰∫§
        document.getElementById('blogEditForm').onsubmit = async function(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const blogId = document.getElementById('editBlogId').value;

            // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÂÆ†Áâ©IDÂàóË°®
            const selectedPetTags = document.querySelectorAll('#editPetSelection .pet-tag.selected');
            const petIds = Array.from(selectedPetTags).map(tag => tag.dataset.petId).filter(id => id);
            if (petIds.length > 0) {
                formData.append('pet_ids', JSON.stringify(petIds));
            }

            // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑËØùÈ¢òÊ†áÁ≠æ
            const selectedTopics = Array.from(document.querySelectorAll('#editTopicTagSelection .topic-tag.selected')).map(tag => tag.dataset.value);
            if (selectedTopics.length > 0) {
                formData.append('topics', JSON.stringify(selectedTopics));
            }

            try {
                const res = await fetch(`/petblog/api/blogs/${blogId}`, {
                    method: 'PUT',
                    body: formData
                });
                const result = await res.json();
                if (result.success) {
                    alert('ÂçöÂÆ¢Êõ¥Êñ∞ÊàêÂäüÔºÅ');
                    hideEditModal();
                    loadBlogs(); // ÈáçÊñ∞Âä†ËΩΩÂçöÂÆ¢ÂàóË°®
                } else {
                    alert(result.message || 'Êõ¥Êñ∞Â§±Ë¥•');
                }
            } catch (err) {
                console.error('Êõ¥Êñ∞Â§±Ë¥•:', err);
                alert('Êõ¥Êñ∞Â§±Ë¥•');
            }
        };

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Âø´ÈÄüÂàõÂª∫‰∏ìÊ†èÂäüËÉΩ
            document.getElementById('quickCreateColumn').addEventListener('click', function() {
                const columnName = prompt('ËØ∑ËæìÂÖ•‰∏ìÊ†èÂêçÁß∞:');
                if (columnName && columnName.trim()) {
                    createQuickColumn(columnName.trim());
                }
            });

            // ÁßªÈô§‰∫ÜÊåëÊàòÁõ∏ÂÖ≥ÁöÑURLÂèÇÊï∞Â§ÑÁêÜÔºåÁé∞Âú®ÊåëÊàòÂäüËÉΩÂú®ÊåëÊàòÈ°µÈù¢Â§ÑÁêÜ

            // Âä†ËΩΩÁÉ≠Èó®ÊåëÊàòÊéíË°åÊ¶ú
            loadHotChallenges();

            // ÁºñËæëÊ®°ÂºèÁöÑÂø´ÈÄüÂàõÂª∫‰∏ìÊ†èÂäüËÉΩ
            document.getElementById('editQuickCreateColumn').addEventListener('click', function() {
                const columnName = prompt('ËØ∑ËæìÂÖ•‰∏ìÊ†èÂêçÁß∞:');
                if (columnName && columnName.trim()) {
                    createQuickColumnForEdit(columnName.trim());
                }
            });

            const confirmBtn = document.getElementById('confirmChallengeBtn');
            if (confirmBtn) {
                confirmBtn.onclick = async function() {
                    if (!_participateBlogId || !_selectedChallengeId || !_selectedPetId) return;
                    try {
                        const res = await fetch(`/api/blogs/${_participateBlogId}/participate-challenge`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                challenge_id: _selectedChallengeId,
                                pet_id: _selectedPetId
                            })
                        });
                        const result = await res.json();
                        if (result.success) {
                            alert('ÂèÇ‰∏éÊåëÊàòÊàêÂäüÔºÅ');
                            hideChallengeSelectModal();
                        } else {
                            alert(result.message || 'ÂèÇ‰∏éÊåëÊàòÂ§±Ë¥•');
                        }
                    } catch (e) {
                        alert('ÁΩëÁªúÈîôËØØÔºåÂèÇ‰∏éÊåëÊàòÂ§±Ë¥•');
                    }
                };
            }
        });

        // ÊòæÁ§∫ÂèëÂ∏ÉÂºπÁ™ó
        function showPostModal() {
            document.getElementById('postModal').style.display = 'flex';
            loadColumns(); // Âä†ËΩΩ‰∏ìÊ†èÂàóË°®
            loadPets(); // Âä†ËΩΩÂÆ†Áâ©ÂàóË°®
        }

        // Âä†ËΩΩÁÉ≠Èó®ÊåëÊàòÊéíË°åÊ¶ú
        async function loadHotChallenges() {
            try {
                const response = await fetch('/petblog/api/challenges');
                const challenges = await response.json();

                const container = document.getElementById('hotChallengesList');

                if (!challenges || !Array.isArray(challenges) || challenges.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ÊöÇÊó†ÊåëÊàò</div>';
                    return;
                }

                // Âè™ÊòæÁ§∫Ââç5‰∏™ÁÉ≠Èó®ÊåëÊàò
                const topChallenges = challenges.slice(0, 5);

                container.innerHTML = topChallenges.map((challenge, index) => createChallengeRankItem(challenge, index + 1)).join('');
            } catch (error) {
                console.error('Âä†ËΩΩÁÉ≠Èó®ÊåëÊàòÂ§±Ë¥•:', error);
                document.getElementById('hotChallengesList').innerHTML =
                    '<div style="text-align: center; color: #e74c3c; padding: 20px;">Âä†ËΩΩÂ§±Ë¥•</div>';
            }
        }

        // ÂàõÂª∫ÊåëÊàòÊéíË°åÊ¶úÈ°πÁõÆ
        function createChallengeRankItem(challenge, rank) {
            const status = getChallengeStatus(challenge.challenge_start_time, challenge.challenge_end_time);
            const statusClass = `status-${status.type}`;

            let rankClass = 'other';
            if (rank === 1) rankClass = 'top1';
            else if (rank === 2) rankClass = 'top2';
            else if (rank === 3) rankClass = 'top3';

            // Ê£ÄÊü•ÂΩìÂâçÁî®Êà∑ÊòØÂê¶ÊòØÊåëÊàòÂàõÂª∫ËÄÖ
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
            const isOwner = currentUser.userId && challenge.user_id && currentUser.userId === challenge.user_id;
            
            return `
                <div class="challenge-rank-item" style="position: relative;">
                    <div style="position: absolute; top: 5px; right: 5px; z-index: 10;" onclick="event.stopPropagation();">
                        ${isOwner ? `<button onclick="deleteChallenge(${challenge.challenge_id}, this)" style="background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">Âà†Èô§</button>` : ''}
                    </div>
                    <div onclick="window.open('/petblog/challenges.html', '_blank')" style="cursor: pointer;">
                        <div class="rank-number ${rankClass}">${rank}</div>
                        <div class="challenge-rank-info">
                            <div class="challenge-rank-title" title="${challenge.challenge_title}">
                                ${challenge.challenge_title}
                            </div>
                            <div class="challenge-rank-heat">
                                <span>üî•</span>
                                <span>${formatHeat(challenge.heat || 0)}</span>
                            </div>
                            <div class="challenge-rank-status ${statusClass}">
                                ${status.text}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Ëé∑ÂèñÊåëÊàòÁä∂ÊÄÅ
        function getChallengeStatus(startTime, endTime) {
            const now = new Date();
            const start = new Date(startTime);
            const end = new Date(endTime);

            if (now < start) {
                return { type: 'planning', text: 'ËßÑÂàí‰∏≠' };
            } else if (now >= start && now <= end) {
                return { type: 'ongoing', text: 'ËøõË°å‰∏≠' };
            } else {
                return { type: 'ended', text: 'Â∑≤ÁªìÊùü' };
            }
        }

        // Ê†ºÂºèÂåñÁÉ≠Â∫¶Êï∞ÂÄº
        function formatHeat(heat) {
            if (heat >= 10000) {
                return (heat / 10000).toFixed(1) + 'w';
            } else if (heat >= 1000) {
                return (heat / 1000).toFixed(1) + 'k';
            } else {
                return heat.toString();
            }
        }

        // Âà†Èô§ÊåëÊàò
        async function deleteChallenge(challengeId, buttonElement) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÊåëÊàòÂêóÔºüÂà†Èô§ÂêéÂ∞ÜÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ')) {
                return;
            }

            try {
                const response = await fetch(`/petblog/api/challenges/${challengeId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('ÊåëÊàòÂà†Èô§ÊàêÂäü');
                    loadHotChallenges(); // ÈáçÊñ∞Âä†ËΩΩÊåëÊàòÂàóË°®
                } else {
                    alert('Âà†Èô§Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (error) {
                console.error('Âà†Èô§ÊåëÊàòÂ§±Ë¥•:', error);
                alert('Âà†Èô§ÊåëÊàòÂ§±Ë¥•: ' + error.message);
            }
        }

        // ÁºñËæëÂçöÂÆ¢ÂäüËÉΩ
        async function editBlog(blogId) {
            console.log('ÁºñËæëÂçöÂÆ¢Ë¢´Ë∞ÉÁî®ÔºåÂçöÂÆ¢ID:', blogId);
            try {
                // Ëé∑ÂèñÂçöÂÆ¢ÁºñËæë‰ø°ÊÅØ
                const response = await fetch(`/api/blogs/${blogId}/edit`);
                const result = await response.json();

                if (result.success) {
                    const blog = result.blog;

                    // Â°´ÂÖÖË°®ÂçïÊï∞ÊçÆ
                    document.getElementById('editBlogId').value = blog.blogId;
                    document.getElementById('editBlogTitle').value = blog.blogTitle || '';
                    document.getElementById('editBlogContent').value = blog.blogContent || '';

                    // Âä†ËΩΩ‰∏ìÊ†èÂàóË°®Âπ∂ÈÄâ‰∏≠ÂΩìÂâç‰∏ìÊ†è
                    await loadColumnsForEdit();
                    if (blog.column_id) {
                        document.getElementById('editColumnId').value = blog.column_id;
                    }

                    // Âä†ËΩΩÂÆ†Áâ©ÂàóË°®Âπ∂ÈÄâ‰∏≠ÂΩìÂâçÂÆ†Áâ©
                    await loadPetsForEdit();
                    if (blog.pet_ids && blog.pet_ids.length > 0) {
                        blog.pet_ids.forEach(petId => {
                            const petTag = document.querySelector(`#editPetSelection .pet-tag[data-pet-id="${petId}"]`);
                            if (petTag) {
                                petTag.classList.add('selected');
                            }
                        });
                    }

                    // ÈÄâ‰∏≠Â∑≤ÊúâËØùÈ¢òÊ†áÁ≠æ
                    renderTopicTags('editTopicTagSelection', blog.topics||[]);

                    // ÊòæÁ§∫ÁºñËæëÊ®°ÊÄÅÊ°Ü
                    document.getElementById('editModal').style.display = 'flex';
                } else {
                    alert(result.message || 'Ëé∑ÂèñÂçöÂÆ¢‰ø°ÊÅØÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂçöÂÆ¢ÁºñËæë‰ø°ÊÅØÂ§±Ë¥•:', error);
                alert('Âä†ËΩΩÂçöÂÆ¢‰ø°ÊÅØÂ§±Ë¥•');
            }
        }

        // Âä†ËΩΩ‰∏ìÊ†èÂàóË°®Áî®‰∫éÁºñËæë
        async function loadColumnsForEdit() {
            try {
                const response = await fetch('/petblog/api/columns/my');
                const columns = await response.json();

                const select = document.getElementById('editColumnId');
                select.innerHTML = '<option value="">‰∏çÈÄâÊã©‰∏ìÊ†è</option>';

                columns.forEach(column => {
                    const option = document.createElement('option');
                    option.value = column.Column_id;
                    option.textContent = column.Column_name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Âä†ËΩΩ‰∏ìÊ†èÂàóË°®Â§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÂÆ†Áâ©ÂàóË°®Áî®‰∫éÁºñËæë
        async function loadPetsForEdit() {
            try {
                const response = await fetch('/petblog/api/pets/my');
                const pets = await response.json();

                const container = document.getElementById('editPetSelection');

                if (pets.length === 0) {
                    container.innerHTML = '<div style="color: #666; text-align: center; padding: 10px;">ÊÇ®ËøòÊ≤°ÊúâÊ∑ªÂä†ÁãóÁãó</div>';
                    return;
                }

                container.innerHTML = pets.map(pet => `
                    <div class="pet-tag" data-pet-id="${pet.pet_id}" onclick="togglePetSelectionEdit(this)">
                        ${pet.pet_name}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Âä†ËΩΩÂÆ†Áâ©ÂàóË°®Â§±Ë¥•:', error);
            }
        }

        // ÂàáÊç¢ÂÆ†Áâ©ÈÄâÊã©Áä∂ÊÄÅÔºàÁºñËæëÊ®°ÂºèÔºâ
        function togglePetSelectionEdit(element) {
            element.classList.toggle('selected');
        }

        // Âø´ÈÄüÂàõÂª∫‰∏ìÊ†èÁî®‰∫éÁºñËæë
        async function createQuickColumnForEdit(columnName) {
            try {
                const response = await fetch('/petblog/api/columns', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: columnName })
                });

                const result = await response.json();

                if (result.success) {
                    // ÈáçÊñ∞Âä†ËΩΩ‰∏ìÊ†èÂàóË°®
                    await loadColumnsForEdit();
                    // Ëá™Âä®ÈÄâÊã©Êñ∞ÂàõÂª∫ÁöÑ‰∏ìÊ†è
                    document.getElementById('editColumnId').value = result.column_id;
                    alert('‰∏ìÊ†èÂàõÂª∫ÊàêÂäüÔºÅ');
                } else {
                    alert(result.message || 'ÂàõÂª∫‰∏ìÊ†èÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂàõÂª∫‰∏ìÊ†èÂ§±Ë¥•:', error);
                alert('ÂàõÂª∫‰∏ìÊ†èÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // ÈöêËóèÁºñËæëÊ®°ÊÄÅÊ°Ü
        function hideEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('blogEditForm').reset();
            // Ê∏ÖÈô§ÂÆ†Áâ©ÈÄâÊã©Áä∂ÊÄÅ
            document.querySelectorAll('#editPetSelection .pet-tag.selected').forEach(tag => {
                tag.classList.remove('selected');
            });
        }

        // ÈöêËóèÂèëÂ∏ÉÂºπÁ™ó
        function hidePostModal() {
            document.getElementById('postModal').style.display = 'none';
            // Ê∏ÖÁ©∫Ë°®Âçï
            document.getElementById('blogPostForm').reset();
            // Ê∏ÖÁ©∫ÂÆ†Áâ©ÈÄâÊã©
            const petSelection = document.getElementById('petSelection');
            if (petSelection) {
                petSelection.innerHTML = '<div style="color: #666; text-align: center; padding: 10px;">Ê≠£Âú®Âä†ËΩΩÁãóÁãóÂàóË°®...</div>';
            }
        }

        // Âä†ËΩΩ‰∏ìÊ†èÂàóË°®
        async function loadColumns() {
            try {
                const response = await fetch('/petblog/api/columns/my');
                const columns = await response.json();
                const columnSelect = document.getElementById('column_id');
                if (!columnSelect) return;
                columnSelect.innerHTML = '<option value="">‰∏çÈÄâÊã©‰∏ìÊ†è</option>';
                if (columns && Array.isArray(columns)) {
                    columns.forEach(column => {
                        columnSelect.innerHTML += `<option value="${column.Column_id}">${column.Column_name}</option>`;
                    });
                }
            } catch (error) {
                console.error('Âä†ËΩΩ‰∏ìÊ†èÂ§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÂÆ†Áâ©ÂàóË°®
        async function loadPets() {
            try {
                const response = await fetch('/petblog/api/pets/my');
                const pets = await response.json();
                const petSelection = document.getElementById('petSelection');

                if (pets.length === 0) {
                    petSelection.innerHTML = '<div style="color: #666; text-align: center; padding: 10px;">ÊöÇÊó†ÁãóÁãóÔºåËØ∑ÂÖàÂú®‰∏™‰∫∫‰∏≠ÂøÉÊ∑ªÂä†</div>';
                    return;
                }

                petSelection.innerHTML = '';
                pets.forEach(pet => {
                    const petTag = document.createElement('div');
                    petTag.className = 'pet-tag';
                    petTag.dataset.petId = pet.pet_id;
                    petTag.innerHTML = `
                        <img src="${pet.pet_avatar_path || '/petblog/images/default-pet.png'}" alt="${pet.pet_name}" style="width:24px;height:24px;border-radius:50%;object-fit:cover;margin-right:6px;vertical-align:middle;" onerror="this.src='/petblog/images/default-pet.png'">
                        <span>${pet.pet_name}</span>
                    `;
                    petTag.onclick = function() {
                        this.classList.toggle('selected');
                    };
                    petSelection.appendChild(petTag);
                });
            } catch (error) {
                console.error('Âä†ËΩΩÂÆ†Áâ©Â§±Ë¥•:', error);
                const petSelection = document.getElementById('petSelection');
                petSelection.innerHTML = '<div style="color: #e74c3c; text-align: center; padding: 10px;">Âä†ËΩΩÂ§±Ë¥•</div>';
            }
        }

        // ÂàõÂª∫‰∏ìÊ†è
        async function createQuickColumn(columnName) {
            try {
                const response = await fetch('/petblog/api/column/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        column_name: columnName,
                        column_description: ''
                    })
                });

                const result = await response.json();
                if (result.success) {
                    // ÈáçÊñ∞Âä†ËΩΩ‰∏ìÊ†èÂàóË°®Âπ∂ÈÄâ‰∏≠Êñ∞ÂàõÂª∫ÁöÑ‰∏ìÊ†è
                    await loadColumns();
                    document.getElementById('column_id').value = result.column_id;
                    alert('‰∏ìÊ†èÂàõÂª∫ÊàêÂäüÔºÅ');
                } else {
                    alert(result.message || 'ÂàõÂª∫‰∏ìÊ†èÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂàõÂª∫‰∏ìÊ†èÂ§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåÂàõÂª∫‰∏ìÊ†èÂ§±Ë¥•');
            }
        }


        // 4. ÂèëÂ∏ÉÂçöÂÆ¢
        document.getElementById('blogPostForm').onsubmit = async function(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);

            // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÂÆ†Áâ©IDÂàóË°®
            const selectedPetTags = document.querySelectorAll('#petSelection .pet-tag.selected');
            const petIds = Array.from(selectedPetTags).map(tag => tag.dataset.petId).filter(id => id);
            if (petIds.length > 0) {
                formData.append('pet_ids', JSON.stringify(petIds));
            }

            // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑËØùÈ¢òÊ†áÁ≠æ
            const selectedTopics = Array.from(document.querySelectorAll('#topicTagSelection .topic-tag.selected')).map(tag => tag.dataset.value);
            if (selectedTopics.length > 0) {
                formData.append('topics', JSON.stringify(selectedTopics));
            }

            try {
                const res = await fetch('/petblog/api/blogs/add', {
                    method: 'POST',
                    body: formData
                });
                const result = await res.json();
                if (result.success) {
                    alert('ÂèëÂ∏ÉÊàêÂäüÔºÅ');
                    hidePostModal();
                    loadBlogs();
                } else {
                    alert(result.message || 'ÂèëÂ∏ÉÂ§±Ë¥•');
                }
            } catch (err) {
                console.error('ÂèëÂ∏ÉÂ§±Ë¥•:', err);
                alert('ÂèëÂ∏ÉÂ§±Ë¥•');
            }
        };
        // Â§ÑÁêÜÂçöÂÆ¢ÂÜÖÂÆπ‰∏≠ÁöÑÂõæÁâá
        function processImageContent(content) {
            // Â¶ÇÊûúcontent‰∏∫nullÊàñundefinedÔºåËøîÂõûÁ©∫Â≠óÁ¨¶‰∏≤
            if (!content) {
                return '';
            }
            // ËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤
            content = String(content);
            // Â§ÑÁêÜMarkdownÈ£éÊ†ºÁöÑÂõæÁâáËØ≠Ê≥ï ![alt](url)
            const markdownImageRegex = /!\[([^\]]*)\]\(([^)]+)\)/g;
            content = content.replace(markdownImageRegex, '<img src="$2" alt="$1" loading="lazy">');

            // Â§ÑÁêÜHTML imgÊ†áÁ≠æÔºàÂ¶ÇÊûúÂ∑≤ÁªèÊòØimgÊ†áÁ≠æÂ∞±‰∏çÂ§ÑÁêÜÔºâ
            if (content.includes('<img')) {
                return content;
            }

            // Â§ÑÁêÜÂõæÁâáURLÔºåÂ∞ÜÂÖ∂ËΩ¨Êç¢‰∏∫imgÊ†áÁ≠æ
            const imageRegex = /(https?:\/\/[^\s<>"]+\.(jpg|jpeg|png|gif|webp|bmp|svg))/gi;
            content = content.replace(imageRegex, '<img src="$1" alt="ÂçöÂÆ¢ÂõæÁâá" loading="lazy">');

            // Â§ÑÁêÜÊú¨Âú∞ÂõæÁâáË∑ØÂæÑ
            const localImageRegex = /(\/images\/[^\s<>"]+\.(jpg|jpeg|png|gif|webp|bmp|svg))/gi;
            content = content.replace(localImageRegex, '<img src="$1" alt="ÂçöÂÆ¢ÂõæÁâá" loading="lazy">');

            return content;
        }



        // 5. Âä†ËΩΩÂçöÂÆ¢ÊµÅ
        async function loadBlogs() {
            console.log('ÂºÄÂßãÂä†ËΩΩÂçöÂÆ¢...');
            try {
                const res = await fetch('/petblog/api/blogs');
                console.log('ÂçöÂÆ¢APIÂìçÂ∫îÁä∂ÊÄÅ:', res.status);
                const blogs = await res.json();
                console.log('Ëé∑ÂèñÂà∞ÁöÑÂçöÂÆ¢Êï∞ÊçÆ:', blogs);
                console.log('ÂçöÂÆ¢Êï∞Èáè:', blogs.length);
                // Ë∞ÉËØïÔºöÊ£ÄÊü•Á¨¨‰∏Ä‰∏™ÂçöÂÆ¢ÁöÑÊï∞ÊçÆÁªìÊûÑ
                if (blogs.length > 0) {
                    console.log('Á¨¨‰∏Ä‰∏™ÂçöÂÆ¢ÁöÑÂÆåÊï¥Êï∞ÊçÆ:', JSON.stringify(blogs[0], null, 2));
                    console.log('Á¨¨‰∏Ä‰∏™ÂçöÂÆ¢ÁöÑÁªüËÆ°Â≠óÊÆµ:', {
                        likeCount: blogs[0].likeCount,
                        favoriteCount: blogs[0].favoriteCount,
                        commentCount: blogs[0].commentCount,
                        repostCount: blogs[0].repostCount,
                        userName: blogs[0].userName,
                        userAvatarPath: blogs[0].userAvatarPath
                    });
                }

                const blogList = document.getElementById('blogList');
                console.log('ÂçöÂÆ¢ÂàóË°®ÂÆπÂô®:', blogList);

                if (!blogList) {
                    console.error('Êâæ‰∏çÂà∞ÂçöÂÆ¢ÂàóË°®ÂÆπÂô® #blogList');
                    return;
                }

                blogList.innerHTML = '';

                if (blogs.length === 0) {
                    blogList.innerHTML = '<div style="text-align:center;color:#888;padding:40px;">ÊöÇÊó†ÂçöÂÆ¢ÂÜÖÂÆπ</div>';
                    return;
                }

                blogs.forEach(blog => {
                const card = document.createElement('div');
                card.className = 'blog-card';
                card.style.cursor = 'pointer';
                card.onclick = (e) => {
                    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÊåâÈíÆ„ÄÅÈìæÊé•ÔºåÊàñËæìÂÖ•Ê°ÜÔºàËØÑËÆ∫ËæìÂÖ•ÔºâÔºå‰∏çË∑≥ËΩ¨
                    if (
                        e.target.tagName === 'BUTTON' ||
                        e.target.closest('button') ||
                        e.target.tagName === 'A' ||
                        e.target.tagName === 'INPUT' ||
                        (e.target.classList && (e.target.classList.contains('comment-input') || e.target.classList.contains('comment-submit-btn')))
                    ) {
                        return;
                    }
                    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØËØÑËÆ∫Âå∫ÂüüÔºå‰∏çË∑≥ËΩ¨
                    if (e.target.closest('.comments-section') || e.target.closest('.comment-item')) {
                        return;
                    }
                    window.location.href = `/petblog/blog-detail.html?id=${blog.blogId}`;
                };
                
                // Â§ÑÁêÜÈôÑ‰ª∂ÊòæÁ§∫
                let attachmentHtml = '';
                if (blog.attachments && blog.attachments.length > 0) {
                    attachmentHtml = '<div class="blog-attachment">';
                    blog.attachments.forEach(file => {
                        attachmentHtml += `<a href="${file.file_path}" target="_blank">${file.file_name}</a><br>`;
                    });
                    attachmentHtml += '</div>';
                }
                
                // ËÆæÁΩÆÁÇπËµûÊåâÈíÆÁöÑÂàùÂßãÁä∂ÊÄÅ
                const likeBtnClass = blog.is_liked ? 'like-btn liked' : 'like-btn';
                
                // ËÆæÁΩÆÊî∂ËóèÊåâÈíÆÁöÑÂàùÂßãÁä∂ÊÄÅ
                const favoriteBtnClass = blog.is_favorited ? 'favorite-btn favorited' : 'favorite-btn';

                // ËÆæÁΩÆËΩ¨ÂèëÊåâÈíÆÁöÑÂàùÂßãÁä∂ÊÄÅ
                const repostBtnClass = blog.is_reposted ? 'repost-btn reposted' : 'repost-btn';

                // ËÆæÁΩÆÂÖ≥Ê≥®ÊåâÈíÆÁöÑÂàùÂßãÁä∂ÊÄÅ
                const followBtnClass = blog.is_followed ? 'follow-btn followed' : 'follow-btn';
                
                card.innerHTML = `
                    <div class="blog-header">
                        <img class="blog-avatar" src="${normalizeAvatarPath(blog.userAvatarPath)}" alt="Â§¥ÂÉè">
                        <div class="blog-user-info">
                            <div style="display:flex;align-items:center;justify-content:space-between;">
                            <span class="blog-user-name">${blog.userName}</span>
                                ${currentUser && currentUser.userId === blog.userId ? `
                                    <button class="delete-blog-btn" onclick="event.stopPropagation(); deleteBlog(${blog.blogId}, this)" style="margin-left:10px; background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; z-index: 10; position: relative;" title="Âà†Èô§ÂçöÂÆ¢">
                                        üóëÔ∏è Âà†Èô§
                                    </button>
                                ` : `
                                    <button class="${followBtnClass}" data-user-id="${blog.userId}" onclick="event.stopPropagation(); toggleFollow(${blog.userId}, this)" style="margin-left:10px; z-index: 10; position: relative;">
                                        <span class="follow-icon">üë§</span>
                                        <span>${blog.is_followed ? 'Â∑≤ÂÖ≥Ê≥®' : 'ÂÖ≥Ê≥®'}</span>
                                    </button>
                                `}
                            </div>
                            <div class="blog-user-stats">
                                <span class="blog-time">${new Date(blog.blogCreateTime).toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                    <div class="blog-title">${blog.blogTitle || 'Êó†Ê†áÈ¢ò'}</div>
                    <div class="blog-content">${processImageContent(blog.blogContent || '')}</div>
                    ${blog.pets && blog.pets.length > 0 ? `
                        <div class="blog-pets">
                            <div class="blog-pets-title">ÊèêÂà∞ÁöÑÁãóÁãóÔºö</div>
                            <div class="blog-pet-list">
                                ${blog.pets.map(pet => `
                                    <div class="blog-pet-item">
                                        <img src="${pet.pet_avatar_path || '/images/default-pet.png'}" alt="${pet.pet_name}" onerror="this.src='/images/default-pet.png'">
                                        <span>${pet.pet_name}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    ${attachmentHtml}
                    ${blog.column_name ? `<span class="blog-column">${blog.column_name}</span>` : ''}
                    <div class="blog-topics">
                        ${(blog.topics||[]).map(t=>`<span class="blog-topic">#${t}</span>`).join('')}
                    </div>
                    <div class="blog-actions">
                        <button class="${likeBtnClass}" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); toggleLike(${blog.blogId}, this)">
                            <span class="like-icon">üëç</span>
                            <span class="like-count">${blog.likeCount || 0}</span>
                        </button>
                        <button class="${favoriteBtnClass}" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); toggleFavorite(${blog.blogId}, this)">
                            <span class="favorite-icon">‚≠ê</span>
                            <span class="favorite-count">${blog.favoriteCount || 0}</span>
                        </button>
                        <button class="${repostBtnClass}" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); toggleRepost(${blog.blogId}, this)">
                            <span class="repost-icon">üîÑ</span>
                            <span class="repost-count">${blog.repostCount || 0}</span>
                        </button>
                        <button class="comment-btn" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); toggleComments(${blog.blogId}, this)">
                            <span class="comment-icon">üí¨</span>
                            <span class="comment-count">${blog.commentCount || 0}</span>
                        </button>
                        ${currentUser && currentUser.userId !== blog.userId ? `
                            <button class="action-btn report-btn" onclick="event.stopPropagation(); showReportModal(${blog.blogId})" style="color:#e74c3c;">
                                <span>üö©</span> ‰∏æÊä•
                            </button>
                        ` : ''}
                        ${(() => {
                            return currentUser && currentUser.userId === blog.userId ? `
                                <button class="edit-btn" data-blog-id="${blog.blogId}" onclick="editBlog(${blog.blogId})">
                                    <span class="edit-icon">‚úèÔ∏è</span>
                                    <span>ÁºñËæë</span>
                                </button>
                                <button class="participate-challenge-btn" onclick="showChallengeSelectModal(${blog.blogId})" style="margin-left:10px;background:#ff9800;color:#fff;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;">
                                    üèÜ ÂèÇ‰∏éÊåëÊàò
                                </button>
                            ` : '';
                        })()}
                    </div>
                    <div class="comments-section" id="comments-${blog.blogId}">
                        <div class="comment-input-area">
                            <input type="text" class="comment-input" placeholder="ÂÜô‰∏ã‰Ω†ÁöÑËØÑËÆ∫..." maxlength="500">
                            <button class="comment-submit-btn" onclick="event.stopPropagation(); submitComment(${blog.blogId}, this)">ÂèëË°®</button>
                        </div>
                        <div class="comments-list" id="comments-list-${blog.blogId}">
                            <!-- ËØÑËÆ∫ÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÂä†ËΩΩ -->
                        </div>
                    </div>
                `;
                blogList.appendChild(card);
            });
            console.log('ÂçöÂÆ¢Âä†ËΩΩÂÆåÊàê');
            } catch (error) {
                console.error('Âä†ËΩΩÂçöÂÆ¢Â§±Ë¥•:', error);
                const blogList = document.getElementById('blogList');
                if (blogList) {
                    blogList.innerHTML = '<div style="text-align:center;color:#e74c3c;padding:40px;">Âä†ËΩΩÂçöÂÆ¢Â§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï</div>';
                }
            }
        }
        
        // ÁÇπËµû/ÂèñÊ∂àÁÇπËµûÂäüËÉΩ
        async function toggleLike(blogId, button) {
            try {
                if (!currentUser || !currentUser.userId) {
                    await loadCurrentUser(); // Á°Æ‰øùËé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ
                }
                
                if (!currentUser || !currentUser.userId) {
                    alert('ËØ∑ÂÖàÁôªÂΩï');
                    return;
                }
                
                const response = await fetch('/petblog/api/likes/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ blog_id: blogId, userId: currentUser.userId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                    const likeCountSpan = button.querySelector('.like-count');
                    const currentCount = parseInt(likeCountSpan.textContent);
                    
                    if (result.liked) {
                        // ÁÇπËµûÊàêÂäü
                        button.classList.add('liked');
                        likeCountSpan.textContent = currentCount + 1;
                    } else {
                        // ÂèñÊ∂àÁÇπËµûÊàêÂäü
                        button.classList.remove('liked');
                        likeCountSpan.textContent = Math.max(0, currentCount - 1);
                    }
                } else {
                    alert(result.message || 'Êìç‰ΩúÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ÁÇπËµûÊìç‰ΩúÂ§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï');
            }
        }
        
        // Êî∂Ëóè/ÂèñÊ∂àÊî∂ËóèÂäüËÉΩ
        async function toggleFavorite(blogId, button) {
            try {
                if (!currentUser || !currentUser.userId) {
                    await loadCurrentUser(); // Á°Æ‰øùËé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ
                }
                
                if (!currentUser || !currentUser.userId) {
                    alert('ËØ∑ÂÖàÁôªÂΩï');
                    return;
                }
                
                const response = await fetch('/petblog/api/favorites/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ blog_id: blogId, userId: currentUser.userId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                    const favoriteCountSpan = button.querySelector('.favorite-count');
                    const currentCount = parseInt(favoriteCountSpan.textContent);
                    
                    if (result.favorited) {
                        // Êî∂ËóèÊàêÂäü
                        button.classList.add('favorited');
                        favoriteCountSpan.textContent = currentCount + 1;
                    } else {
                        // ÂèñÊ∂àÊî∂ËóèÊàêÂäü
                        button.classList.remove('favorited');
                        favoriteCountSpan.textContent = Math.max(0, currentCount - 1);
                    }
                } else {
                    alert(result.message || 'Êìç‰ΩúÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('Êî∂ËóèÊìç‰ΩúÂ§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï');
            }
        }
        
        // ËΩ¨Âèë/ÂèñÊ∂àËΩ¨ÂèëÂäüËÉΩ
        async function toggleRepost(blogId, button) {
            try {
                if (!currentUser || !currentUser.userId) {
                    await loadCurrentUser(); // Á°Æ‰øùËé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ
                }
                
                if (!currentUser || !currentUser.userId) {
                    alert('ËØ∑ÂÖàÁôªÂΩï');
                    return;
                }
                
                const response = await fetch('/petblog/api/reposts/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ blog_id: blogId, userId: currentUser.userId })
                });

                const result = await response.json();

                if (result.success) {
                    // ËΩ¨ÂèëÊàêÂäü
                    const repostCountSpan = button.querySelector('.repost-count');
                    const currentCount = parseInt(repostCountSpan.textContent);

                    button.classList.add('reposted');
                    button.disabled = true; // Á¶ÅÁî®ÊåâÈíÆÔºåÈò≤Ê≠¢ÈáçÂ§çËΩ¨Âèë
                    repostCountSpan.textContent = currentCount + 1;

                    // ÈáçÊñ∞Âä†ËΩΩÂçöÂÆ¢ÂàóË°®‰ª•ÊòæÁ§∫Êñ∞ÁöÑËΩ¨ÂèëÂçöÂÆ¢
                    console.log('ËΩ¨ÂèëÊàêÂäüÔºåÈáçÊñ∞Âä†ËΩΩÂçöÂÆ¢ÂàóË°®');
                    await loadBlogs();

                    // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                    alert('ËΩ¨ÂèëÊàêÂäüÔºÅÊÇ®ÁöÑËΩ¨ÂèëÂ∑≤ÂèëÂ∏ÉÂà∞È¶ñÈ°µ');
                } else {
                    alert(result.message || 'Êìç‰ΩúÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ËΩ¨ÂèëÊìç‰ΩúÂ§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï');
            }
        }

        // ÂÖ≥Ê≥®/ÂèñÊ∂àÂÖ≥Ê≥®ÂäüËÉΩ
        async function toggleFollow(userId, button) {
            try {
                const response = await fetch('/petblog/api/follows/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ followee_id: userId })
                });

                const result = await response.json();

                if (result.success) {
                    // Êõ¥Êñ∞È°µÈù¢‰∏äÊâÄÊúâËØ•Áî®Êà∑ÁöÑÂÖ≥Ê≥®ÊåâÈíÆÁä∂ÊÄÅ
                    const allFollowButtons = document.querySelectorAll(`button[data-user-id="${userId}"]`);

                    allFollowButtons.forEach(btn => {
                        if (result.followed) {
                            // ÂÖ≥Ê≥®ÊàêÂäü
                            btn.classList.add('followed');
                            btn.innerHTML = '<span class="follow-icon">üë§</span><span>Â∑≤ÂÖ≥Ê≥®</span>';
                        } else {
                            // ÂèñÊ∂àÂÖ≥Ê≥®ÊàêÂäü
                            btn.classList.remove('followed');
                            btn.innerHTML = '<span class="follow-icon">üë§</span><span>ÂÖ≥Ê≥®</span>';
                        }
                    });
                } else {
                    alert(result.message || 'Êìç‰ΩúÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂÖ≥Ê≥®Êìç‰ΩúÂ§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï');
            }
        }
        
        // ÂàùÂßãÂåñLikesË°®
        async function initLikesTable() {
            try {
                await fetch('/petblog/api/likes/init');
                console.log('LikesË°®ÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('LikesË°®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        }
        
        // ÂàùÂßãÂåñFavoritesË°®
        async function initFavoritesTable() {
            try {
                await fetch('/petblog/api/favorites/init');
                console.log('FavoritesË°®ÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('FavoritesË°®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        }
        
        // ÂàùÂßãÂåñFollowsË°®
        async function initFollowsTable() {
            try {
                await fetch('/petblog/api/follows/init');
                console.log('FollowsË°®ÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('FollowsË°®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        }

        // ÂàùÂßãÂåñRepostsË°®
        async function initRepostsTable() {
            try {
                await fetch('/petblog/api/reposts/init');
                console.log('RepostsË°®ÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('RepostsË°®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        }

        // Ê£ÄÊü•repliesË°®
        async function initCommentsTable() {
            try {
                const response = await fetch('/petblog/api/comments/init');
                const result = await response.json();
                console.log('repliesË°®Ê£ÄÊü•ÂÆåÊàê:', result.message);
            } catch (error) {
                console.error('repliesË°®Ê£ÄÊü•Â§±Ë¥•:', error);
            }
        }

        // ÂàáÊç¢ËØÑËÆ∫Âå∫ÂüüÊòæÁ§∫/ÈöêËóè
        async function toggleComments(blogId, button) {
            const commentsSection = document.getElementById(`comments-${blogId}`);

            if (commentsSection.classList.contains('show')) {
                commentsSection.classList.remove('show');
            } else {
                commentsSection.classList.add('show');
                // Âä†ËΩΩËØÑËÆ∫
                await loadComments(blogId);
            }
        }

        // È¶ñÈ°µËØÑËÆ∫Âå∫Âπ≥Èì∫Ê∏≤ÊüìÔºàÂ≠êÂõûÂ§çÁº©Ëøõ‰ΩÜ‰∏çÂµåÂ•óÔºâ
        async function loadComments(blogId) {
            const commentsList = document.getElementById(`comments-list-${blogId}`);
            commentsList.innerHTML = '';
            try {
                const response = await fetch(`/petblog/api/replies/${blogId}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const comments = await response.json();
                if (!comments || comments.length === 0) {
                    commentsList.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">ÊöÇÊó†ËØÑËÆ∫</div>';
                    return;
                }
                // ÊâÅÂπ≥ÂåñËØÑËÆ∫Ê†ë
                function flattenComments(tree, level = 0, arr = []) {
                    tree.forEach(comment => {
                        arr.push({ ...comment, _level: level });
                        if (comment.children && comment.children.length > 0) {
                            flattenComments(comment.children, level + 1, arr);
                        }
                    });
                    return arr;
                }
                const flat = flattenComments(comments);
                flat.forEach(comment => {
                    const div = document.createElement('div');
                    div.className = 'comment-item';
                    div.style.marginLeft = comment._level > 0 ? (40 * comment._level) + 'px' : '0';
                    div.style.borderLeft = comment._level > 0 ? '3px solid #7bc5b7' : 'none';
                    div.style.background = 'none';
                    div.style.paddingLeft = '0';
                    // Â§ÑÁêÜÂ≠óÊÆµÂêçÊò†Â∞ÑÔºàÂêéÁ´ØÂèØËÉΩËøîÂõûÈ©ºÂ≥∞ÂëΩÂêçÔºåÂâçÁ´ØÊúüÊúõ‰∏ãÂàíÁ∫øÂëΩÂêçÔºâ
                    const userName = comment.user_name || comment.userName || 'Êú™Áü•Áî®Êà∑';
                    const userAvatarPath = comment.user_avatar_path || comment.userAvatarPath || '/petblog/images/Default avatar.png';
                    const replyContent = comment.reply_content || comment.replyContent || '';
                    const replyCreatedtime = comment.reply_createdtime || comment.replyCreatedtime;
                    const userId = comment.user_id || comment.userId;
                    const replyId = comment.reply_id || comment.replyId;
                    const blogId = comment.blog_id || comment.blogId;
                    const parentUserName = comment.parent_user_name || comment.parentUserName;
                    
                    div.innerHTML = `
                        <img class="comment-avatar" src="${normalizeAvatarPath(userAvatarPath)}" alt="Â§¥ÂÉè">
                        <div class="comment-content">
                            <div class="comment-user-name">${userName}</div>
                            <div class="comment-text">${comment._level > 0 && parentUserName ? `<span style='color:#1abc9c;font-weight:bold;'>ÂõûÂ§ç @${parentUserName}Ôºö</span>` : ''}${replyContent}</div>
                            <div class="comment-time">${replyCreatedtime ? new Date(replyCreatedtime).toLocaleString() : ''}</div>
                            <div class="comment-actions">
                                <button class="comment-reply-btn">ÂõûÂ§ç</button>
                                ${(getCurrentUser() && getCurrentUser().userId === userId) ? `<button class="comment-delete-btn" onclick="deleteComment(${replyId}, ${blogId})">Âà†Èô§</button>` : ''}
                            </div>
                        </div>
                    `;
                    // ÂõûÂ§çÊåâÈíÆÈÄªËæë
                    const replyBtn = div.querySelector('.comment-reply-btn');
                    replyBtn.onclick = function() {
                        const oldBox = div.querySelector('.reply-input-area');
                        if (oldBox) oldBox.remove();
                        const replyBox = document.createElement('div');
                        replyBox.className = 'reply-input-area';
                        replyBox.style.display = 'flex';
                        replyBox.style.gap = '8px';
                        replyBox.style.margin = '8px 0 0 0';
                        const replyUserName = comment.user_name || comment.userName || 'Áî®Êà∑';
                        replyBox.innerHTML = `
                            <input type="text" class="comment-input" placeholder="ÂõûÂ§ç @${replyUserName}..." style="flex:1;">
                            <button class="comment-submit-btn">ÂèëË°®</button>
                        `;
                        replyBox.querySelector('.comment-submit-btn').onclick = async function() {
                            const input = replyBox.querySelector('.comment-input');
                            const content = input.value.trim();
                            if (!content) { alert('ËØ∑ËæìÂÖ•ÂÜÖÂÆπ'); return; }
                            this.disabled = true;
                            this.textContent = 'ÂèëË°®‰∏≠...';
                            try {
                                if (!currentUser || !currentUser.userId) {
                                    await loadCurrentUser();
                                }
                                if (!currentUser || !currentUser.userId) {
                                    alert('ËØ∑ÂÖàÁôªÂΩï');
                                    this.disabled = false;
                                    this.textContent = 'ÂèëË°®';
                                    return;
                                }
                                
                                const blogIdForReply = comment.blog_id || comment.blogId;
                                const parentReplyId = comment.reply_id || comment.replyId;
                                
                                const response = await fetch('/petblog/api/replies', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        blogId: blogIdForReply,
                                        userId: currentUser.userId,
                                        replyContent: content,
                                        parentReply: parentReplyId
                                    })
                                });
                                
                                if (response.status === 201 || response.ok) {
                                    input.value = '';
                                    // ÈáçÊñ∞Âä†ËΩΩËØÑËÆ∫ÔºàÂª∂Ëøü‰∏Ä‰∏ãÁ°Æ‰øùÊï∞ÊçÆÂ∫ìÂ∑≤Êõ¥Êñ∞Ôºâ
                                    setTimeout(async () => {
                                        await loadComments(blogIdForReply);
                                    }, 100);
                                    // Êõ¥Êñ∞ËØÑËÆ∫Êï∞Èáè
                                    const commentCountSpan = document.querySelector(`button[data-blog-id="${blogIdForReply}"] .comment-count`);
                                    if (commentCountSpan) {
                                        const currentCount = parseInt(commentCountSpan.textContent) || 0;
                                        commentCountSpan.textContent = currentCount + 1;
                                    }
                                } else {
                                    const result = await response.json();
                                    alert(result.error || result.message || 'ÂèëË°®ËØÑËÆ∫Â§±Ë¥•');
                                }
                            } catch (e) {
                                console.error('ÂèëË°®ÂõûÂ§çÂ§±Ë¥•:', e);
                                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï');
                            } finally {
                                this.disabled = false;
                                this.textContent = 'ÂèëË°®';
                            }
                        };
                        div.appendChild(replyBox);
                    };
                    commentsList.appendChild(div);
                });
            } catch (error) {
                commentsList.innerHTML = '<div style="text-align:center;color:#e74c3c;padding:20px;">Âä†ËΩΩËØÑËÆ∫Â§±Ë¥•</div>';
            }
        }

        // ÂàõÂª∫ËØÑËÆ∫ÂÖÉÁ¥†
        function createCommentElement(comment, isReply) {
            const div = document.createElement('div');
            div.className = isReply ? 'comment-item reply-comment' : 'comment-item';

            const currentUser = getCurrentUser();
            const canDelete = currentUser && currentUser.userId === comment.user_id;

            div.innerHTML = `
                <img class="comment-avatar" src="${comment.user_avatar_path || '/petblog/images/Default avatar.png'}" alt="Â§¥ÂÉè">
                <div class="comment-content">
                    <div class="comment-user-name">${comment.user_name}</div>
                    <div class="comment-text">${comment.reply_content}</div>
                    <div class="comment-time">${new Date(comment.reply_createdtime).toLocaleString()}</div>
                    <div class="comment-actions">
                        <button class="comment-reply-btn">ÂõûÂ§ç</button>
                        ${canDelete ? `<button class="comment-delete-btn" onclick="deleteComment(${comment.reply_id}, ${comment.blog_id})">Âà†Èô§</button>` : ''}
                    </div>
                </div>
            `;

            return div;
        }

        // ÂèëË°®ËØÑËÆ∫
        async function submitComment(blogId, button) {
            console.log('ÂºÄÂßãÂèëË°®ËØÑËÆ∫ÔºåÂçöÂÆ¢ID:', blogId);

            const inputArea = button.parentElement;
            const input = inputArea.querySelector('.comment-input');
            const content = input.value.trim();

            console.log('ËØÑËÆ∫ÂÜÖÂÆπ:', content);

            if (!content) {
                alert('ËØ∑ËæìÂÖ•ËØÑËÆ∫ÂÜÖÂÆπ');
                return;
            }

            button.disabled = true;
            button.textContent = 'ÂèëË°®‰∏≠...';

            try {
                if (!currentUser || !currentUser.userId) {
                    await loadCurrentUser(); // Á°Æ‰øùËé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ
                }
                
                if (!currentUser || !currentUser.userId) {
                    alert('ËØ∑ÂÖàÁôªÂΩï');
                    button.disabled = false;
                    button.textContent = 'ÂèëË°®';
                    return;
                }
                
                console.log('ÂèëÈÄÅËØÑËÆ∫ËØ∑Ê±Ç...');
                const response = await fetch('/petblog/api/replies', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        blogId: blogId,
                        userId: currentUser.userId,
                        replyContent: content,
                        parentReply: input.dataset.parentId ? parseInt(input.dataset.parentId) : null
                    })
                });

                console.log('Êî∂Âà∞ÂìçÂ∫îÔºåÁä∂ÊÄÅ:', response.status);
                
                if (response.status === 201 || response.ok) {
                    const result = await response.json();
                    console.log('ÂìçÂ∫îÁªìÊûú:', result);
                    console.log('ËØÑËÆ∫ÂèëË°®ÊàêÂäü');
                    input.value = '';
                    input.dataset.parentId = '';
                    input.placeholder = 'ÂÜô‰∏ã‰Ω†ÁöÑËØÑËÆ∫...';

                    // ÈáçÊñ∞Âä†ËΩΩËØÑËÆ∫ÔºàÂª∂Ëøü‰∏Ä‰∏ãÁ°Æ‰øùÊï∞ÊçÆÂ∫ìÂ∑≤Êõ¥Êñ∞Ôºâ
                    setTimeout(async () => {
                        await loadComments(blogId);
                    }, 200);

                    // Êõ¥Êñ∞ËØÑËÆ∫Êï∞Èáè
                    updateCommentCount(blogId, 1);
                } else {
                    const result = await response.json();
                    console.error('ËØÑËÆ∫ÂèëË°®Â§±Ë¥•:', result.error || result.message);
                    alert(result.error || result.message || 'ÂèëË°®ËØÑËÆ∫Â§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂèëË°®ËØÑËÆ∫Â§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï');
            } finally {
                button.disabled = false;
                button.textContent = 'ÂèëË°®';
            }
        }

        // ÂõûÂ§çËØÑËÆ∫
        function replyToComment(commentId, userName, blogId) {
            const input = document.querySelector(`#comments-${blogId} .comment-input`);
            input.placeholder = `ÂõûÂ§ç @${userName}...`;
            input.dataset.parentId = commentId;
            input.focus();
        }

        // Âà†Èô§ËØÑËÆ∫
        async function deleteComment(commentId, blogId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËØÑËÆ∫ÂêóÔºü')) {
                return;
            }

            try {
                const response = await fetch('/petblog/api/comments/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ comment_id: commentId })
                });

                const result = await response.json();

                if (result.success) {
                    // ÈáçÊñ∞Âä†ËΩΩËØÑËÆ∫ÔºàÂª∂Ëøü‰∏Ä‰∏ãÁ°Æ‰øùÊï∞ÊçÆÂ∫ìÂ∑≤Êõ¥Êñ∞Ôºâ
                    setTimeout(async () => {
                        await loadComments(blogId);
                    }, 200);

                    // Êõ¥Êñ∞ËØÑËÆ∫Êï∞Èáè
                    updateCommentCount(blogId, -1);
                } else {
                    alert(result.message || 'Âà†Èô§ËØÑËÆ∫Â§±Ë¥•');
                }
            } catch (error) {
                console.error('Âà†Èô§ËØÑËÆ∫Â§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï');
            }
        }

        // Êõ¥Êñ∞ËØÑËÆ∫Êï∞Èáè
        function updateCommentCount(blogId, change) {
            const commentBtn = document.querySelector(`button[data-blog-id="${blogId}"].comment-btn`);
            if (commentBtn) {
                const countSpan = commentBtn.querySelector('.comment-count');
                const currentCount = parseInt(countSpan.textContent) || 0;
                countSpan.textContent = Math.max(0, currentCount + change);
            }
        }

        // Ëé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ
        let currentUser = null;

        // ËæÖÂä©ÂáΩÊï∞ÔºöÁ°Æ‰øùÂ§¥ÂÉèË∑ØÂæÑÂåÖÂê´ /petblog ÂâçÁºÄ
        function normalizeAvatarPath(avatarPath) {
            if (!avatarPath) {
                return '/petblog/images/Default avatar.png';
            }
            if (avatarPath.startsWith('/petblog')) {
                return avatarPath;
            } else if (avatarPath.startsWith('/')) {
                return '/petblog' + avatarPath;
            } else {
                return '/petblog/' + avatarPath;
            }
        }

        async function loadCurrentUser() {
            try {
                // ÂÖà‰ªésessionStorageËé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ
                const storedUser = sessionStorage.getItem('currentUser');
                if (storedUser) {
                    currentUser = JSON.parse(storedUser);
                    // ËÆæÁΩÆÂø´ÈÄüÂèëÂ∏ÉÂå∫ÂüüÁöÑÂ§¥ÂÉè
                    const quickPostAvatar = document.getElementById('quickPostAvatar');
                    if (quickPostAvatar) {
                        quickPostAvatar.src = normalizeAvatarPath(currentUser.userAvatarPath);
                    }
                    return;
                }
                
                // Â¶ÇÊûúÊ≤°ÊúâsessionStorage‰∏≠ÁöÑÁî®Êà∑‰ø°ÊÅØÔºåÂ∞ùËØï‰ªéAPIËé∑Âèñ
                if (currentUser && currentUser.userId) {
                    const response = await fetch(`/petblog/api/user/profile?userId=${currentUser.userId}`);
                    if (response.ok) {
                        currentUser = await response.json();
                        // ËÆæÁΩÆÂø´ÈÄüÂèëÂ∏ÉÂå∫ÂüüÁöÑÂ§¥ÂÉè
                        const quickPostAvatar = document.getElementById('quickPostAvatar');
                        if (quickPostAvatar) {
                            quickPostAvatar.src = normalizeAvatarPath(currentUser.userAvatarPath);
                        }
                    }
                }
            } catch (error) {
                console.error('Ëé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);
                // Â¶ÇÊûúÂá∫ÈîôÔºå‰ΩøÁî®ÈªòËÆ§Â§¥ÂÉè
                const quickPostAvatar = document.getElementById('quickPostAvatar');
                if (quickPostAvatar) {
                    quickPostAvatar.src = normalizeAvatarPath(null);
                }
            }
        }

        function getCurrentUser() {
            return currentUser;
        }

        // Âà†Èô§ÂçöÂÆ¢ÂäüËÉΩ
        async function deleteBlog(blogId, button) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÁØáÂçöÂÆ¢ÂêóÔºüÂà†Èô§ÂêéÊó†Ê≥ïÊÅ¢Â§çÔºÅ')) {
                return;
            }

            // Á¶ÅÁî®ÊåâÈíÆÔºåÈò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
            button.disabled = true;
            button.textContent = 'Âà†Èô§‰∏≠...';

            try {
                const response = await fetch(`/petblog/api/blogs/${blogId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                let result;
                if (response.status === 204) {
                    result = { success: true, message: 'Âà†Èô§ÊàêÂäü' };
                } else {
                    result = await response.json();
                }

                if (result.success) {
                    // Âà†Èô§ÊàêÂäüÔºåÈáçÊñ∞Âä†ËΩΩÂçöÂÆ¢ÂàóË°®‰ª•Êõ¥Êñ∞ËΩ¨ÂèëÊï∞ÈáèÁ≠â‰ø°ÊÅØ
                    alert('ÂçöÂÆ¢Âà†Èô§ÊàêÂäüÔºÅ');

                    // ÈáçÊñ∞Âä†ËΩΩÂçöÂÆ¢Êï∞ÊçÆÔºåÁ°Æ‰øùËΩ¨ÂèëÊï∞ÈáèÁ≠â‰ø°ÊÅØÂæóÂà∞Êõ¥Êñ∞
                    console.log('ÂçöÂÆ¢Âà†Èô§ÊàêÂäüÔºåÈáçÊñ∞Âä†ËΩΩÂçöÂÆ¢ÂàóË°®');
                    await loadBlogs();
                } else {
                    alert(result.message || 'Âà†Èô§Â§±Ë¥•');
                    button.disabled = false;
                    button.textContent = 'üóëÔ∏è Âà†Èô§';
                }
            } catch (error) {
                console.error('Âà†Èô§ÂçöÂÆ¢Â§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï');
                button.disabled = false;
                button.textContent = 'üóëÔ∏è Âà†Èô§';
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', async function() {
            // ÂàùÂßãÂåñ
            initLikesTable();
            initFavoritesTable();
            initFollowsTable();
            initRepostsTable();
            initCommentsTable();

            // ÂÖàÂä†ËΩΩÁî®Êà∑‰ø°ÊÅØÔºåÂÜçÂä†ËΩΩÂçöÂÆ¢
            await loadCurrentUser();
            loadColumns();
            loadBlogs();
            loadUnreadNotificationCount();

            // ÂÖ≥Ê≥®ÁÆ°ÁêÜtabÂàáÊç¢
            const followsLink = document.querySelector('a[href="#my-follows"]');
            if (followsLink) {
                followsLink.addEventListener('click', function() {
                    showFollowing(); // ÈªòËÆ§ÊòæÁ§∫ÂÖ≥Ê≥®ÂàóË°®
                });
            }
        });

        // 1. ÈÄâÊã©ËØùÈ¢òÂ§öÈÄâÂàáÊç¢
        function toggleTopicTag(element) {
            element.classList.toggle('selected');
        }

        // 2. ÁªëÂÆöÁÇπÂáª‰∫ã‰ª∂
        // ÂèëÂ∏ÉË°®Âçï
        if (document.getElementById('topicTagSelection')) {
            document.querySelectorAll('#topicTagSelection .topic-tag').forEach(tag => {
                tag.onclick = function() { toggleTopicTag(this); };
            });
        }

        // ÁºñËæëË°®Âçï
        if (document.getElementById('editTopicTagSelection')) {
            document.querySelectorAll('#editTopicTagSelection .topic-tag').forEach(tag => {
                tag.onclick = function() { toggleTopicTag(this); };
            });
        }

        function showReportModal(blogId) {
          window._reportBlogId = blogId;
          document.getElementById('reportModal').style.display = 'flex';
        }
        function hideReportModal() {
          document.getElementById('reportModal').style.display = 'none';
          document.getElementById('reportReason').value = '';
        }
        document.getElementById('submitReportBtn').onclick = async function() {
          const reason = document.getElementById('reportReason').value.trim();
          if (!reason) { alert('ËØ∑ËæìÂÖ•‰∏æÊä•ÁêÜÁî±'); return; }
          
          // Ëé∑ÂèñÂΩìÂâçÁôªÂΩïÁî®Êà∑
          const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
          if (!currentUser || !currentUser.userId) {
            alert('ËØ∑ÂÖàÁôªÂΩïÂêéÂÜçËøõË°å‰∏æÊä•');
            return;
          }
          
          const blogId = window._reportBlogId;
          if (!blogId) {
            alert('‰∏æÊä•Â§±Ë¥•ÔºöÁº∫Â∞ëÂçöÂÆ¢ID');
            return;
          }
          
          try {
            const res = await fetch('/petblog/api/reports/add', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ 
                blog_id: blogId, 
                reason: reason,
                userId: currentUser.userId 
              })
            });
            const result = await res.json();
            if (result.success) {
              alert('‰∏æÊä•ÊàêÂäüÔºåÊÑüË∞¢ÊÇ®ÁöÑÂèçÈ¶àÔºÅ');
              hideReportModal();
            } else {
              alert(result.error || result.message || '‰∏æÊä•Â§±Ë¥•');
            }
          } catch (e) {
            console.error('‰∏æÊä•ÈîôËØØ:', e);
            alert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï');
          }
        };

        // Âä®ÊÄÅÂä†ËΩΩËØùÈ¢ò‰∏ãÊãâÂàóË°®
        async function loadTopicsForPost() {
            const select = document.getElementById('topicTagSelection');
            if (!select) return;
            select.innerHTML = '<option disabled>Âä†ËΩΩ‰∏≠...</option>';
            try {
                const res = await fetch('/petblog/api/topics/all');
                const topics = await res.json();
                if (Array.isArray(topics) && topics.length > 0) {
                    select.innerHTML = topics.map(t => `<option value="${t.topic_name}">${t.topic_name}</option>`).join('');
                } else {
                    select.innerHTML = '<option disabled>ÊöÇÊó†ËØùÈ¢ò</option>';
                }
            } catch (e) {
                select.innerHTML = '<option disabled>Âä†ËΩΩÂ§±Ë¥•</option>';
            }
        }
        document.addEventListener('DOMContentLoaded', loadTopicsForPost);

        // JSÊ∏≤ÊüìÊ†áÁ≠æ
        async function renderTopicTags(containerId, selected=[]) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = 'Âä†ËΩΩ‰∏≠...';
            try {
                const res = await fetch('/petblog/api/topics/all');
                const topics = await res.json();
                if (Array.isArray(topics) && topics.length > 0) {
                    container.innerHTML = topics.map(t => `<span class="topic-tag${selected.includes(t.topic_name)?' selected':''}" data-value="${t.topic_name}">${t.topic_name}</span>`).join('');
                    // ÁªëÂÆöÁÇπÂáª‰∫ã‰ª∂
                    Array.from(container.querySelectorAll('.topic-tag')).forEach(tag => {
                        tag.onclick = function() {
                            const selectedTags = Array.from(container.querySelectorAll('.topic-tag.selected'));
                            if (tag.classList.contains('selected')) {
                                tag.classList.remove('selected');
                            } else {
                                if (selectedTags.length >= 3) {
                                    alert('ÊúÄÂ§öÂè™ËÉΩÈÄâÊã©3‰∏™ËØùÈ¢ò');
                                    return;
                                }
                                tag.classList.add('selected');
                            }
                        };
                    });
                } else {
                    container.innerHTML = '<span style="color:#888">ÊöÇÊó†ËØùÈ¢ò</span>';
                }
            } catch (e) {
                container.innerHTML = '<span style="color:#e74c3c">Âä†ËΩΩÂ§±Ë¥•</span>';
            }
        }
        // È°µÈù¢Âä†ËΩΩÊó∂Ê∏≤ÊüìÂèëÂ∏ÉË°®ÂçïËØùÈ¢òÊ†áÁ≠æ
        document.addEventListener('DOMContentLoaded', function() { renderTopicTags('topicTagSelection'); });
        // ÁºñËæëÂºπÁ™óÊâìÂºÄÊó∂Ê∏≤ÊüìÁºñËæëË°®ÂçïËØùÈ¢òÊ†áÁ≠æ
        // Âú®editBlogÂáΩÊï∞‰∏≠Ë∞ÉÁî®renderTopicTags('editTopicTagSelection', blog.topics||[]);
        // Ë°®ÂçïÊèê‰∫§Êó∂Êî∂ÈõÜÂ∑≤ÈÄâËØùÈ¢ò
        // ÂèëÂ∏É
        const blogPostForm = document.getElementById('blogPostForm');
        if (blogPostForm) {
            blogPostForm.onsubmit = async function(e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÂÆ†Áâ©IDÂàóË°®
                const selectedPetTags = document.querySelectorAll('#petSelection .pet-tag.selected');
                const petIds = Array.from(selectedPetTags).map(tag => tag.dataset.petId).filter(id => id);
                if (petIds.length > 0) {
                    formData.append('pet_ids', JSON.stringify(petIds));
                }
                // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑËØùÈ¢òÊ†áÁ≠æ
                const selectedTopics = Array.from(document.querySelectorAll('#topicTagSelection .topic-tag.selected')).map(tag => tag.dataset.value);
                if (selectedTopics.length > 0) {
                    formData.append('topics', JSON.stringify(selectedTopics));
                }
                // ...ÂéüÊúâÊèê‰∫§ÈÄªËæë...
                try {
                    const res = await fetch('/petblog/api/blogs/add', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await res.json();
                    if (result.success) {
                        alert('ÂèëÂ∏ÉÊàêÂäüÔºÅ');
                        hidePostModal();
                        loadBlogs();
                    } else {
                        alert(result.message || 'ÂèëÂ∏ÉÂ§±Ë¥•');
                    }
                } catch (err) {
                    console.error('ÂèëÂ∏ÉÂ§±Ë¥•:', err);
                    alert('ÂèëÂ∏ÉÂ§±Ë¥•');
                }
            };
        }
        // ÁºñËæë
        const blogEditForm = document.getElementById('blogEditForm');
        if (blogEditForm) {
            blogEditForm.onsubmit = async function(e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const blogId = document.getElementById('editBlogId').value;
                // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÂÆ†Áâ©IDÂàóË°®
                const selectedPetTags = document.querySelectorAll('#editPetSelection .pet-tag.selected');
                const petIds = Array.from(selectedPetTags).map(tag => tag.dataset.petId).filter(id => id);
                if (petIds.length > 0) {
                    formData.append('pet_ids', JSON.stringify(petIds));
                }
                // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑËØùÈ¢òÊ†áÁ≠æ
                const selectedTopics = Array.from(document.querySelectorAll('#editTopicTagSelection .topic-tag.selected')).map(tag => tag.dataset.value);
                if (selectedTopics.length > 0) {
                    formData.append('topics', JSON.stringify(selectedTopics));
                }
                try {
                    const res = await fetch(`/petblog/api/blogs/${blogId}`, {
                        method: 'PUT',
                        body: formData
                    });
                    const result = await res.json();
                    if (result.success) {
                        alert('ÂçöÂÆ¢Êõ¥Êñ∞ÊàêÂäüÔºÅ');
                        hideEditModal();
                        loadBlogs();
                    } else {
                        alert(result.message || 'Êõ¥Êñ∞Â§±Ë¥•');
                    }
                } catch (err) {
                    console.error('Êõ¥Êñ∞Â§±Ë¥•:', err);
                    alert('Êõ¥Êñ∞Â§±Ë¥•');
                }
            };
        }

        // ÁªëÂÆöËØùÈ¢òÊ†áÁ≠æÁÇπÂáª‰∫ã‰ª∂ÔºåÊã¶Êà™Ë∑≥ËΩ¨Âπ∂Âà∑Êñ∞ÂçöÂÆ¢Âå∫
        function bindTopicAsideLinks() {
            document.querySelectorAll('.topic-aside-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Ëé∑ÂèñËØùÈ¢òÂêçÔºà‰ªédata-topicÂ±ûÊÄßËé∑ÂèñÔºåÊõ¥ÂèØÈù†Ôºâ
                    const topicName = this.getAttribute('data-topic') || this.textContent.trim();
                    loadBlogsByTopic(topicName);
                });
            });
        }
        // È°µÈù¢Âä†ËΩΩÊó∂ÁªëÂÆö
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', bindTopicAsideLinks);
        } else {
            bindTopicAsideLinks();
        }

        // Âä†ËΩΩÊåáÂÆöËØùÈ¢ò‰∏ãÁöÑÂçöÂÆ¢
        async function loadBlogsByTopic(topic) {
            const blogList = document.getElementById('blogList');
            blogList.innerHTML = '<div style="text-align:center;color:#888;padding:40px;">Âä†ËΩΩ‰∏≠...</div>';
            try {
                const res = await fetch(`/petblog/api/blogs/by-topic?topic=${encodeURIComponent(topic)}`);
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                const blogs = await res.json();
                if (!blogs || blogs.length === 0) {
                    blogList.innerHTML = '<div style="text-align:center;color:#888;padding:40px;">ÊöÇÊó†ËØ•ËØùÈ¢òÁöÑÂçöÂÆ¢</div>';
                    return;
                }
                // Â§çÁî®loadBlogsÁöÑÊ∏≤ÊüìÈÄªËæë
                blogList.innerHTML = '';
                blogs.forEach(blog => {
                    const card = document.createElement('div');
                    card.className = 'blog-card';
                    card.style.cursor = 'pointer';
                    card.onclick = (e) => {
                        // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÊåâÈíÆ„ÄÅÈìæÊé•ÔºåÊàñËæìÂÖ•Ê°ÜÔºàËØÑËÆ∫ËæìÂÖ•ÔºâÔºå‰∏çË∑≥ËΩ¨
                        if (
                            e.target.tagName === 'BUTTON' ||
                            e.target.closest('button') ||
                            e.target.tagName === 'A' ||
                            e.target.tagName === 'INPUT' ||
                            (e.target.classList && (e.target.classList.contains('comment-input') || e.target.classList.contains('comment-submit-btn')))
                        ) {
                            return;
                        }
                        // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØËØÑËÆ∫Âå∫ÂüüÔºå‰∏çË∑≥ËΩ¨
                        if (e.target.closest('.comments-section') || e.target.closest('.comment-item')) {
                            return;
                        }
                        window.location.href = `/petblog/blog-detail.html?id=${blog.blogId}`;
                    };
                    // Â§ÑÁêÜÈôÑ‰ª∂ÊòæÁ§∫
                    let attachmentHtml = '';
                    if (blog.attachments && blog.attachments.length > 0) {
                        attachmentHtml = '<div class="blog-attachment">';
                        blog.attachments.forEach(file => {
                            attachmentHtml += `<a href="${file.file_path}" target="_blank">${file.file_name}</a><br>`;
                        });
                        attachmentHtml += '</div>';
                    }
                    // ËÆæÁΩÆÁÇπËµûÊåâÈíÆÁöÑÂàùÂßãÁä∂ÊÄÅ
                    const likeBtnClass = blog.is_liked ? 'like-btn liked' : 'like-btn';
                    // ËÆæÁΩÆÊî∂ËóèÊåâÈíÆÁöÑÂàùÂßãÁä∂ÊÄÅ
                    const favoriteBtnClass = blog.is_favorited ? 'favorite-btn favorited' : 'favorite-btn';
                    // ËÆæÁΩÆËΩ¨ÂèëÊåâÈíÆÁöÑÂàùÂßãÁä∂ÊÄÅ
                    const repostBtnClass = blog.is_reposted ? 'repost-btn reposted' : 'repost-btn';
                    // ËÆæÁΩÆÂÖ≥Ê≥®ÊåâÈíÆÁöÑÂàùÂßãÁä∂ÊÄÅ
                    const followBtnClass = blog.is_followed ? 'follow-btn followed' : 'follow-btn';
                    card.innerHTML = `
                        <div class="blog-header">
                            <img class="blog-avatar" src="${normalizeAvatarPath(blog.userAvatarPath)}" alt="Â§¥ÂÉè">
                            <div class="blog-user-info">
                                <div style="display:flex;align-items:center;justify-content:space-between;">
                                <span class="blog-user-name">${blog.userName}</span>
                                    ${window.currentUser && window.currentUser.userId === blog.userId ? `
                                        <button class="delete-blog-btn" onclick="event.stopPropagation(); deleteBlog(${blog.blogId}, this)" style="margin-left:10px; background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; z-index: 10; position: relative;" title="Âà†Èô§ÂçöÂÆ¢">
                                            üóëÔ∏è Âà†Èô§
                                        </button>
                                    ` : `
                                        <button class="${followBtnClass}" data-user-id="${blog.userId}" onclick="event.stopPropagation(); toggleFollow(${blog.userId}, this)" style="margin-left:10px; z-index: 10; position: relative;">
                                            <span class="follow-icon">üë§</span>
                                            <span>${blog.is_followed ? 'Â∑≤ÂÖ≥Ê≥®' : 'ÂÖ≥Ê≥®'}</span>
                                        </button>
                                    `}
                                </div>
                                <div class="blog-user-stats">
                                    <span class="blog-time">${new Date(blog.blogCreateTime).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                        <div class="blog-title">${blog.blogTitle}</div>
                        <div class="blog-content">${processImageContent(blog.blogContent || '')}</div>
                        ${blog.pets && blog.pets.length > 0 ? `
                            <div class="blog-pets">
                                <div class="blog-pets-title">ÊèêÂà∞ÁöÑÁãóÁãóÔºö</div>
                                <div class="blog-pet-list">
                                    ${blog.pets.map(pet => `
                                        <div class="blog-pet-item">
                                            <img src="${pet.pet_avatar_path || '/images/default-pet.png'}" alt="${pet.pet_name}" onerror="this.src='/images/default-pet.png'">
                                            <span>${pet.pet_name}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        ${attachmentHtml}
                        ${blog.column_name ? `<span class="blog-column">${blog.column_name}</span>` : ''}
                        <div class="blog-topics">
                            ${(blog.topics||[]).map(t=>`<span class="blog-topic">#${t}</span>`).join('')}
                        </div>
                        <div class="blog-actions">
                            <button class="${likeBtnClass}" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); toggleLike(${blog.blogId}, this)">
                                <span class="like-icon">üëç</span>
                                <span class="like-count">${blog.like_count || 0}</span>
                            </button>
                            <button class="${favoriteBtnClass}" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); toggleFavorite(${blog.blogId}, this)">
                                <span class="favorite-icon">‚≠ê</span>
                                <span class="favorite-count">${blog.favorite_count || 0}</span>
                            </button>
                            <button class="${repostBtnClass}" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); toggleRepost(${blog.blogId}, this)">
                                <span class="repost-icon">üîÑ</span>
                                <span class="repost-count">${blog.repost_count || 0}</span>
                            </button>
                            <button class="comment-btn" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); toggleComments(${blog.blogId}, this)">
                                <span class="comment-icon">üí¨</span>
                                <span class="comment-count">${blog.comment_count || 0}</span>
                            </button>
                            ${window.currentUser && window.currentUser.userId !== blog.userId ? `
                                <button class="action-btn report-btn" onclick="event.stopPropagation(); showReportModal(${blog.blogId})" style="color:#e74c3c; z-index: 10; position: relative;">
                                    <span>üö©</span> ‰∏æÊä•
                                </button>
                            ` : ''}
                            ${(() => {
                                return window.currentUser && window.currentUser.userId === blog.userId ? `
                                    <button class="edit-btn" data-blog-id="${blog.blogId}" onclick="event.stopPropagation(); editBlog(${blog.blogId})" style="z-index: 10; position: relative;">
                                        <span class="edit-icon">‚úèÔ∏è</span>
                                        <span>ÁºñËæë</span>
                                    </button>
                                    <button class="participate-challenge-btn" onclick="event.stopPropagation(); showChallengeSelectModal(${blog.blogId})" style="margin-left:10px;background:#ff9800;color:#fff;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px; z-index: 10; position: relative;">
                                        üèÜ ÂèÇ‰∏éÊåëÊàò
                                    </button>
                                ` : '';
                            })()}
                        </div>
                        <div class="comments-section" id="comments-${blog.blogId}">
                            <div class="comment-input-area">
                                <input type="text" class="comment-input" placeholder="ÂÜô‰∏ã‰Ω†ÁöÑËØÑËÆ∫..." maxlength="500">
                                <button class="comment-submit-btn" onclick="event.stopPropagation(); submitComment(${blog.blogId}, this)">ÂèëË°®</button>
                            </div>
                            <div class="comments-list" id="comments-list-${blog.blogId}"></div>
                        </div>
                    `;
                    blogList.appendChild(card);
                });
            } catch (e) {
                blogList.innerHTML = '<div style="text-align:center;color:#e74c3c;padding:40px;">Âä†ËΩΩÂ§±Ë¥•</div>';
            }
        }

        // Ëá™Âä®Ê∏≤ÊüìËØùÈ¢òÂπøÂú∫Ê†áÁ≠æ
        async function renderAsideTopics() {
            const asideList = document.querySelector('.topic-aside-list');
            if (!asideList) return;
            asideList.innerHTML = '<li style="color:#888">Âä†ËΩΩ‰∏≠...</li>';
            try {
                const res = await fetch('/petblog/api/topics/all');
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                const topics = await res.json();
                if (Array.isArray(topics) && topics.length > 0) {
                    asideList.innerHTML = topics.map(t => {
                        // Â§ÑÁêÜÂ≠óÊÆµÂêçÊò†Â∞ÑÔºàÂêéÁ´ØÂèØËÉΩËøîÂõûÈ©ºÂ≥∞ÂëΩÂêçÔºåÂâçÁ´ØÊúüÊúõ‰∏ãÂàíÁ∫øÂëΩÂêçÔºâ
                        const topicName = t.topic_name || t.topicName || '';
                        const icon = getTopicIcon(topicName);
                        return `<li><a class="topic-aside-link" href="#" data-topic="${topicName}"><span>${icon}</span>${topicName}</a></li>`;
                    }).join('');
                    bindTopicAsideLinks(); // ÈáçÊñ∞ÁªëÂÆöÁÇπÂáª‰∫ã‰ª∂
                } else {
                    asideList.innerHTML = '<li style="color:#888">ÊöÇÊó†ËØùÈ¢ò</li>';
                }
            } catch (e) {
                console.error('Âä†ËΩΩËØùÈ¢òÂ§±Ë¥•:', e);
                asideList.innerHTML = '<li style="color:#e74c3c">Âä†ËΩΩÂ§±Ë¥•: ' + (e.message || 'Êú™Áü•ÈîôËØØ') + '</li>';
            }
        }
        document.addEventListener('DOMContentLoaded', renderAsideTopics);

        // Ê†πÊçÆËØùÈ¢òÂêçÁß∞Ëé∑ÂèñÂêàÈÄÇÁöÑÂõæÊ†á
        function getTopicIcon(topicName) {
            const iconMap = {
                // ÁãóÁãóÁõ∏ÂÖ≥ËØùÈ¢ò
                'ÁãóÁãóÊó•Â∏∏': 'üêï',
                'ÁãóÁãóÂÅ•Â∫∑': 'üè•',
                'ÁãóÁãóËÆ≠ÁªÉ': 'üéæ',
                'ÁãóÁãóÁæéÂÆπ': '‚úÇÔ∏è',
                'ÁãóÁãóÈ•ÆÈ£ü': 'üçñ',
                'ÁãóÁãóÁé©ÂÖ∑': 'ü¶¥',
                'ÁãóÁãóÂá∫Ë°å': 'üöó',
                'ÁãóÁãóÁ§æ‰∫§': 'üêæ',
                'ÁãóÁãóÂìÅÁßç': 'üêï‚Äçü¶∫',
                'ÁãóÁãóÊä§ÁêÜ': 'üõÅ',
                
                // ÊÉÖÊÑüÂàÜ‰∫´
                'ËêåÂÆ†Êó•Â∏∏': 'üòä',
                'ÊöñÂøÉÁû¨Èó¥': 'üíï',
                'ÊêûÁ¨ëÁû¨Èó¥': 'üòÇ',
                'ÊÑü‰∫∫ÊïÖ‰∫ã': 'ü•∫',
                'ÊàêÈïøËÆ∞ÂΩï': 'üìà',
                'Èô™‰º¥Êó∂ÂÖâ': '‚è∞',
                
                // Ê¥ªÂä®Áõ∏ÂÖ≥
                'ÂÆ†Áâ©ËÅö‰ºö': 'üéâ',
                'Êà∑Â§ñÊ¥ªÂä®': 'üèûÔ∏è',
                'ÂÆ†Áâ©ÊØîËµõ': 'üèÜ',
                'ÂÖ¨ÁõäÊ¥ªÂä®': '‚ù§Ô∏è',
                'È¢ÜÂÖª‰ø°ÊÅØ': 'üè†',
                
                // Áü•ËØÜÂàÜ‰∫´
                'ÂÖªÂÆ†ÁªèÈ™å': 'üìö',
                'ÂÖΩÂåªÂª∫ËÆÆ': 'üë®‚Äç‚öïÔ∏è',
                'Ë°å‰∏∫Ëß£ËØª': 'üîç',
                'Ëê•ÂÖªÁü•ËØÜ': 'ü•ó',
                'ÊÄ•ÊïëÁü•ËØÜ': 'üö®',
                
                // ÁîüÊ¥ªÁõ∏ÂÖ≥
                'ÂÆ†Áâ©Áî®ÂìÅ': 'üõí',
                'ÂÆ†Áâ©ÊëÑÂΩ±': 'üì∏',
                'ÂÆ†Áâ©ÁªòÁîª': 'üé®',
                'ÂÆ†Áâ©ÊâãÂ∑•': '‚úÇÔ∏è',
                'ÂÆ†Áâ©ÁîµÂΩ±': 'üé¨',
                
                // ÈªòËÆ§ÂõæÊ†á
                'default': 'üè∑Ô∏è'
            };
            
            // ÈÅçÂéÜËØùÈ¢òÂêçÁß∞ÔºåÊü•ÊâæÂåπÈÖçÁöÑÂõæÊ†á
            for (const [key, icon] of Object.entries(iconMap)) {
                if (topicName.includes(key) || key.includes(topicName)) {
                    return icon;
                }
            }
            
            // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÔºåÊ†πÊçÆËØùÈ¢òÂêçÁß∞ÁöÑÂÖ≥ÈîÆËØçËøîÂõûÂêàÈÄÇÁöÑÂõæÊ†á
            if (topicName.includes('Áãó') || topicName.includes('Áä¨')) return 'üêï';
            if (topicName.includes('Áå´')) return 'üê±';
            if (topicName.includes('ÂÅ•Â∫∑') || topicName.includes('ÂåªÁñó')) return 'üè•';
            if (topicName.includes('ËÆ≠ÁªÉ') || topicName.includes('ÊïôËÇ≤')) return 'üéæ';
            if (topicName.includes('ÁæéÂÆπ') || topicName.includes('ÈÄ†Âûã')) return '‚úÇÔ∏è';
            if (topicName.includes('È£üÁâ©') || topicName.includes('È•ÆÈ£ü') || topicName.includes('Ëê•ÂÖª')) return 'üçñ';
            if (topicName.includes('Áé©ÂÖ∑') || topicName.includes('Ê∏∏Êàè')) return 'ü¶¥';
            if (topicName.includes('Âá∫Ë°å') || topicName.includes('ÊóÖË°å')) return 'üöó';
            if (topicName.includes('Á§æ‰∫§') || topicName.includes('ÊúãÂèã')) return 'üêæ';
            if (topicName.includes('ÂìÅÁßç') || topicName.includes('Ë°ÄÁªü')) return 'üêï‚Äçü¶∫';
            if (topicName.includes('Êä§ÁêÜ') || topicName.includes('Ê∏ÖÊ¥Å')) return 'üõÅ';
            if (topicName.includes('Êó•Â∏∏') || topicName.includes('ÁîüÊ¥ª')) return 'üòä';
            if (topicName.includes('ÊöñÂøÉ') || topicName.includes('ÊÑüÂä®')) return 'üíï';
            if (topicName.includes('ÊêûÁ¨ë') || topicName.includes('ÊúâË∂£')) return 'üòÇ';
            if (topicName.includes('ÊïÖ‰∫ã') || topicName.includes('ÁªèÂéÜ')) return 'ü•∫';
            if (topicName.includes('ÊàêÈïø') || topicName.includes('ÂèòÂåñ')) return 'üìà';
            if (topicName.includes('Èô™‰º¥') || topicName.includes('Êó∂ÂÖâ')) return '‚è∞';
            if (topicName.includes('ËÅö‰ºö') || topicName.includes('Ê¥ªÂä®')) return 'üéâ';
            if (topicName.includes('Êà∑Â§ñ') || topicName.includes('Ëá™ÁÑ∂')) return 'üèûÔ∏è';
            if (topicName.includes('ÊØîËµõ') || topicName.includes('Á´ûÊäÄ')) return 'üèÜ';
            if (topicName.includes('ÂÖ¨Áõä') || topicName.includes('Áà±ÂøÉ')) return '‚ù§Ô∏è';
            if (topicName.includes('È¢ÜÂÖª') || topicName.includes('Êî∂ÂÖª')) return 'üè†';
            if (topicName.includes('ÁªèÈ™å') || topicName.includes('ÂàÜ‰∫´')) return 'üìö';
            if (topicName.includes('ÂÖΩÂåª') || topicName.includes('ÂåªÁîü')) return 'üë®‚Äç‚öïÔ∏è';
            if (topicName.includes('Ë°å‰∏∫') || topicName.includes('ÂøÉÁêÜ')) return 'üîç';
            if (topicName.includes('Ëê•ÂÖª') || topicName.includes('È£üÁâ©')) return 'ü•ó';
            if (topicName.includes('ÊÄ•Êïë') || topicName.includes('Á¥ßÊÄ•')) return 'üö®';
            if (topicName.includes('Áî®ÂìÅ') || topicName.includes('Ë£ÖÂ§á')) return 'üõí';
            if (topicName.includes('ÊëÑÂΩ±') || topicName.includes('ÊãçÁÖß')) return 'üì∏';
            if (topicName.includes('ÁªòÁîª') || topicName.includes('Ëâ∫ÊúØ')) return 'üé®';
            if (topicName.includes('ÊâãÂ∑•') || topicName.includes('DIY')) return '‚úÇÔ∏è';
            if (topicName.includes('ÁîµÂΩ±') || topicName.includes('ËßÜÈ¢ë')) return 'üé¨';
            
            return iconMap.default;
        }

        // Ëá™Âä®Ê∏≤ÊüìËØùÈ¢òÂπøÂú∫Ê†áÁ≠æ

        // Âä†ËΩΩÊú™ËØªÈÄöÁü•Êï∞Èáè
        async function loadUnreadNotificationCount() {
            try {
                const response = await fetch('/petblog/api/notifications/unread-count');
                const result = await response.json();
                const badge = document.getElementById('notification-badge');
                if (badge) {
                    if (result.count > 0) {
                        badge.textContent = result.count > 99 ? '99+' : result.count;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Ëé∑ÂèñÊú™ËØªÈÄöÁü•Êï∞ÈáèÂ§±Ë¥•:', error);
            }
        }

        // Êü•ÁúãÁî®Êà∑‰∏™‰∫∫‰∏ªÈ°µ
        window.viewUserProfile = function(userId) {
            window.location.href = `/user-profile.html?id=${userId}`;
        };

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadUnreadNotificationCount();
        });

        // ÁæéÂåñÁâàÔºöÂä®ÊÄÅÂπøÂú∫Ê∏≤ÊüìÔºåÈ£éÊ†º‰∏éÁÉ≠Èó®ÊåëÊàò‰∏ÄËá¥
        (function(){
            const dynamicDiv = document.getElementById('dynamicSquareList');
            if (!dynamicDiv) {
                alert('Êâæ‰∏çÂà∞ dynamicSquareList ÂÆπÂô®ÔºÅ');
                return;
            }
            fetch('/petblog/api/dynamic-square').then(res => res.json()).then(result => {
                console.log('Âä®ÊÄÅÂπøÂú∫Êé•Âè£ËøîÂõûÔºö', result);
                if (result && result.success && Array.isArray(result.data) && result.data.length > 0) {
                    dynamicDiv.innerHTML = `
                        <div class="hot-challenges dynamic-square-card" style="margin-bottom:30px;max-width:700px;margin:0 auto;padding:22px 18px 14px 18px;width:100%;box-sizing:border-box;">
                            <div class="hot-challenges-header" style="margin-bottom:14px;">
                                <span class="hot-challenges-icon" style="font-size:1.5rem;">üåü</span>
                                <h3 class="hot-challenges-title" style="font-size:1.3rem;">Âä®ÊÄÅÂπøÂú∫</h3>
                            </div>
                            <div style="display:flex;flex-direction:column;gap:10px;">
                                ${result.data.map((item, idx) => `
                                    <div style="
                                        display:flex;
                                        align-items:center;
                                        background: #fff;
                                        border-radius: 13px;
                                        box-shadow: 0 2px 8px rgba(74, 155, 142, 0.08);
                                        border: 1px solid #e0e0e0;
                                        padding: 8px 14px 8px 12px;
                                        min-width: 0;
                                        font-size: 16px;
                                        font-weight: 500;
                                        ">
                                        <span style="background:linear-gradient(135deg,#a8c8da,#eaf6ff);color:#3d8b7e;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-weight:bold;margin-right:8px;font-size:14px;">${idx+1}</span>
                                        <span style="color:#3498db;font-weight:600;margin-right:8px;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:160px;">${item.title}</span>
                                        <span style="background:#eaf6ff;color:#3498db;border-radius:10px;padding:2px 10px;font-size:13px;margin-right:8px;">${item.type}</span>
                                        <span style="color:#888;font-size:13px;white-space:nowrap;">${new Date(item.time).toLocaleString()}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else if (result && result.success && Array.isArray(result.data) && result.data.length === 0) {
                    dynamicDiv.innerHTML = '<div class="hot-challenges dynamic-square-card" style="text-align:center;color:#888;padding:30px 0;max-width:700px;margin:0 auto;width:100%;box-sizing:border-box;">Âä®ÊÄÅÂπøÂú∫ÊöÇÊó†ÂÜÖÂÆπ</div>';
                } else {
                    dynamicDiv.innerHTML = '<div class="hot-challenges dynamic-square-card" style="text-align:center;color:red;padding:30px 0;max-width:700px;margin:0 auto;width:100%;box-sizing:border-box;">Âä®ÊÄÅÂπøÂú∫Âä†ËΩΩÂ§±Ë¥•</div>';
                }
            }).catch(e => {
                dynamicDiv.innerHTML = '<div class="hot-challenges dynamic-square-card" style="text-align:center;color:red;padding:30px 0;max-width:700px;margin:0 auto;width:100%;box-sizing:border-box;">Âä®ÊÄÅÂπøÂú∫Êé•Âè£ÂºÇÂ∏∏Ôºö' + e + '</div>';
            });
        })();

        let _participateBlogId = null;
        let _selectedChallengeId = null;
        let _selectedPetId = null;
        function showChallengeSelectModal(blogId) {
            _participateBlogId = blogId;
            _selectedChallengeId = null;
            _selectedPetId = null;
            document.getElementById('challengeSelectModal').style.display = 'flex';
            loadChallengeAndPetList();
        }
        function hideChallengeSelectModal() {
            document.getElementById('challengeSelectModal').style.display = 'none';
        }
        async function loadChallengeAndPetList() {
            const challengeDiv = document.getElementById('challengeList');
            const petDiv = document.getElementById('challengePetList');
            challengeDiv.innerHTML = '<div class="select-section-title">ÈÄâÊã©ÊåëÊàò</div><div class="select-list">Âä†ËΩΩ‰∏≠...</div>';
            petDiv.innerHTML = '<div class="select-section-title">ÈÄâÊã©ÁãóÁãó</div><div class="select-list">Âä†ËΩΩ‰∏≠...</div>';
            let challenges = [], pets = [];
            try {
                const cres = await fetch('/petblog/api/challenges');
                challenges = await cres.json();
            } catch (e) {
                challengeDiv.innerHTML = '<div class="select-section-title">ÈÄâÊã©ÊåëÊàò</div><div style="color:#e74c3c;">Âä†ËΩΩÊåëÊàòÂ§±Ë¥•</div>';
            }
            try {
                const pres = await fetch('/petblog/api/pets/my');
                pets = await pres.json();
            } catch (e) {
                petDiv.innerHTML = '<div class="select-section-title">ÈÄâÊã©ÁãóÁãó</div><div style="color:#e74c3c;">Âä†ËΩΩÁãóÁãóÂ§±Ë¥•</div>';
            }
            // ÊåëÊàòÂå∫
            const now = new Date();
            const ongoing = challenges.filter(ch => {
                const start = new Date(ch.challenge_start_time);
                const end = new Date(ch.challenge_end_time);
                return now >= start && now <= end;
            });
            if (ongoing.length === 0) {
                challengeDiv.innerHTML = '<div class="select-section-title">ÈÄâÊã©ÊåëÊàò</div><div style="color:#888;">ÊöÇÊó†Ê≠£Âú®ËøõË°å‰∏≠ÁöÑÊåëÊàò</div>';
            } else {
                challengeDiv.innerHTML = '<div class="select-section-title">ÈÄâÊã©ÊåëÊàò</div>' +
                    '<div class="select-list">' +
                    ongoing.map(ch => `
                        <div class="challenge-card${_selectedChallengeId==ch.challenge_id?' selected':''}" onclick="selectChallenge(${ch.challenge_id}, this)">
                            <span class="challenge-title">${ch.challenge_title}</span>
                            <span class="challenge-time">${new Date(ch.challenge_start_time).toLocaleDateString()} ~ ${new Date(ch.challenge_end_time).toLocaleDateString()}</span>
                        </div>
                    `).join('') +
                    '</div>';
            }
            // ÁãóÁãóÂå∫
            if (!pets || pets.length === 0) {
                petDiv.innerHTML = '<div class="select-section-title">ÈÄâÊã©ÁãóÁãó</div><div style="color:#888;">ÊöÇÊó†ÁãóÁãóÔºåËØ∑ÂÖàÊ∑ªÂä†</div>';
            } else {
                petDiv.innerHTML = '<div class="select-section-title">ÈÄâÊã©ÁãóÁãó</div>' +
                    '<div class="select-list">' +
                    pets.map(pet => `
                        <div class="pet-card${_selectedPetId==pet.pet_id?' selected':''}" onclick="selectPetForChallenge(${pet.pet_id}, this)">
                            <img class="pet-avatar" src="${pet.pet_avatar_path || '/images/default-pet.png'}" alt="${pet.pet_name}" onerror="this.src='/images/default-pet.png'">
                            <span class="pet-name">${pet.pet_name}</span>
                        </div>
                    `).join('') +
                    '</div>';
            }
            updateChallengeConfirmBtn();
        }
        function selectChallenge(challengeId, el) {
            _selectedChallengeId = challengeId;
            document.querySelectorAll('#challengeList .challenge-item').forEach(item => item.style.background = '');
            el.style.background = '#eaf6ff';
            updateChallengeConfirmBtn();
        }
        function selectPetForChallenge(petId, el) {
            _selectedPetId = petId;
            document.querySelectorAll('#challengePetList .pet-item').forEach(item => item.style.background = '');
            el.style.background = '#eaf6ff';
            updateChallengeConfirmBtn();
        }
        function updateChallengeConfirmBtn() {
            const btn = document.getElementById('confirmChallengeBtn');
            btn.disabled = !(_selectedChallengeId && _selectedPetId);
        }
    </script>
    <!-- ÊåëÊàòÈÄâÊã©ÂºπÁ™ó -->
    <div id="challengeSelectModal" class="modal" style="display:none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈÄâÊã©ÊåëÊàò‰∏éÁãóÁãó</h2>
          <span class="close" onclick="hideChallengeSelectModal()">&times;</span>
        </div>
        <div id="challengeList" style="margin-bottom:12px;">Âä†ËΩΩ‰∏≠...</div>
        <div id="challengePetList" style="margin-bottom:18px;">Âä†ËΩΩ‰∏≠...</div>
        <div class="form-actions">
          <button onclick="hideChallengeSelectModal()" style="background:#ccc;color:#666;">ÂèñÊ∂à</button>
          <button id="confirmChallengeBtn" style="background:#ff9800;color:#fff;" disabled>Á°ÆËÆ§</button>
        </div>
      </div>
    </div>
    <!-- ÁãóÁãóÈÄâÊã©ÂºπÁ™ó -->
    <div id="petSelectModal" class="modal" style="display:none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈÄâÊã©ÁãóÁãóÂèÇ‰∏éÊåëÊàò</h2>
          <span class="close" onclick="hidePetSelectModal()">&times;</span>
        </div>
        <div id="petList" style="margin-bottom:18px;">Âä†ËΩΩ‰∏≠...</div>
        <div class="form-actions">
          <button onclick="hidePetSelectModal()" style="background:#ccc;color:#666;">ÂèñÊ∂à</button>
          <button id="confirmPetBtn" style="background:#3d8b7e;color:#fff;" disabled>ÂèÇ‰∏éÊåëÊàò</button>
        </div>
      </div>
    </div>
    <script>
        // ÈÄÄÂá∫ÁôªÂΩï
        function logout() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
                sessionStorage.removeItem('currentUser');
                sessionStorage.removeItem('currentAuditor');
                window.location.href = '/petblog/login.html';
            }
        }
    </script>
</body>
</html>