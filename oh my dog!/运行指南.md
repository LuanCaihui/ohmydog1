# 项目运行指南

这是一个基于 **Jakarta Servlet** 的传统 Java Web 项目（宠物博客系统）。

## 环境要求

1. **JDK 21** 或更高版本
2. **Maven 3.6+**
3. **MySQL 8.0+** 数据库
4. **Tomcat 10+** 或 **Jetty 11+**（支持 Jakarta Servlet 6.0）

## 运行步骤

### 1. 配置数据库

编辑 `src/main/resources/META-INF/persistence.xml`，修改数据库连接信息：

```xml
<!-- 修改数据库名称 -->
<property name="jakarta.persistence.jdbc.url"
          value="jdbc:mysql://localhost:3306/你的数据库名?serverTimezone=UTC&amp;useSSL=false&amp;allowPublicKeyRetrieval=true"/>

<!-- 修改数据库用户名和密码 -->
<property name="jakarta.persistence.jdbc.user" value="root"/>
<property name="jakarta.persistence.jdbc.password" value="你的密码"/>
```

### 2. 创建数据库

在 MySQL 中创建数据库（数据库名与 persistence.xml 中配置的一致）：

```sql
CREATE DATABASE 你的数据库名 CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3. 编译项目

在项目根目录（`oh my dog!`）执行：

```bash
mvn clean compile
```

### 4. 打包项目

```bash
mvn clean package
```

这会在 `target` 目录下生成 `pet-blog-system-1.0-SNAPSHOT.war` 文件。

### 5. 运行项目（三种方式）

#### 方式一：使用 Jetty Maven 插件（最简单，推荐）⭐

项目已配置好 Jetty 插件，直接运行：

```bash
mvn jetty:run
```

启动成功后访问：`http://localhost:8080/petblog/`

#### 方式二：手动部署到 Tomcat

1. 下载并解压 **Tomcat 10.1+**（必须 10.1+，支持 Jakarta Servlet 6.0）
   - 下载地址：https://tomcat.apache.org/download-10.cgi
2. 将生成的 `pet-blog-system-1.0-SNAPSHOT.war` 复制到 Tomcat 的 `webapps` 目录
3. 启动 Tomcat：
   - Windows: 运行 `bin/startup.bat`
   - Linux/Mac: 运行 `bin/startup.sh`
4. 访问：`http://localhost:8080/pet-blog-system-1.0-SNAPSHOT/`

#### 方式三：使用 IDE 运行

**IntelliJ IDEA:**
1. 右键 `pom.xml` → Maven → Reload Project
2. 添加运行配置：Run → Edit Configurations → 添加 Maven
3. Command line: `jetty:run`
4. 运行即可

**Eclipse:**
1. 右键项目 → Run As → Maven build...
2. Goals: `jetty:run`
3. 运行即可

## 访问项目

启动成功后，访问：
- 登录页面：`http://localhost:8080/petblog/login.html`
- 注册页面：`http://localhost:8080/petblog/register.html`
- 审核员登录：`http://localhost:8080/petblog/auditor_login.html`

## API 端点

项目使用 `@WebServlet` 注解配置，主要 API 端点：
- `/api/users/*` - 用户相关
- `/api/blogs/*` - 博客相关
- `/api/pets/*` - 宠物相关
- `/api/columns/*` - 专栏相关
- 等等...

## 常见问题

### 1. 数据库连接失败
- 检查 MySQL 服务是否启动
- 检查数据库用户名、密码、数据库名是否正确
- 检查 MySQL 端口是否为 3306

### 2. 端口被占用
- 修改 Tomcat/Jetty 的端口配置
- 或关闭占用端口的程序

### 3. 编译错误
- 确保使用 JDK 21
- 运行 `mvn clean` 后重新编译

### 4. 找不到 Servlet
- 确保使用支持 Jakarta Servlet 6.0 的服务器（Tomcat 10.1+ 或 Jetty 11+）
- 不要使用 Tomcat 9 或更早版本（它们只支持 Java EE，不支持 Jakarta EE）

## 项目结构说明

- `src/main/java` - Java 源代码
- `src/main/resources` - 配置文件（包括 persistence.xml）
- `webcontent` - Web 资源（HTML、图片等）
- `target` - 编译输出目录

## 注意事项

1. **数据库表结构**：项目配置了 `hibernate.hbm2ddl.auto=update`，首次运行会自动创建表结构
2. **字符编码**：确保数据库使用 UTF-8 编码
3. **时区设置**：数据库连接 URL 中已配置 `serverTimezone=UTC`

